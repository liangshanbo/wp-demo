chrome.extension.onRequest.addListener(function(request,sender,sendResponse){
	if(request.qrcode === true){
		console.log('qrcoding');
		create();
		console.log('qrcoded');
	}
});

chrome.extension.sendMessage({ready: true}, function(response) {
  	console.log(response.ready);
});

function isExit(selector){
	return !!document.querySelector(selector);
}
function create(){
	if(isExit('.qrcode_element')){
		sl('.qrcode_element').style.display = "block";
		return false;
	}
	let qrcode_element = document.createElement('div');
	qrcode_element.className = 'qrcode_element';
	qrcode_element.innerHTML = '<div id="qrcode_box"></div>';
	document.body.appendChild(qrcode_element);
	$("#qrcode_box").qrcode({ 
	    render: "canvas", //canvas 
	    width: 200, //宽度 
	    height:200, //高度 
	    text: location.href //任意内容 
	}); 

	qrcode_element.addEventListener('click',function(){
		sl('.qrcode_element').style.display = 'none';
	},false);
}

function sl(selector){
	return document.querySelector(selector);
}