{"version":3,"sources":["utils/async/lazyload.js"],"names":["define","require","exports","module","LazyLoad","defaults","winHeight","window","innerHeight","loading","wapcsspath","lazyImg","_lazyload","_ListenerScroll","options","Object","assign","self","setTimeout","addEventListener","bind","elements","_lazyLoadElement","length","Array","from","_beginLoad","element","document","querySelectorAll","bodyTop","body","scrollTop","currentTop","_changeImgPath","img","Image","path","getAttribute","removeAttribute","onload","setAttribute","src"],"mappings":";;;;;;AAAA;;;;;;AAMAA,OAAO,sBAAP,EAA+B,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AACjEF,SAAQ,uBAAR;AACAA,SAAQ,wBAAR;;AAFiE,KAI3DG,QAJ2D;AAKhE;AACA,sBAAa;AAAA;;AACZ,QAAKC,QAAL,GAAgB;AACfC,eAAWC,OAAOC,WADH;AAEfC,aAASC,aAAa,uBAFP;AAGfC,aAASD,aAAa;AAHP,IAAhB;AAKA,QAAKE,SAAL;AACA,QAAKC,eAAL;AACA;;AAd+D;AAAA;AAAA,wBAe3DC,OAf2D,EAenD;AACZ,SAAKT,QAAL,GAAgBU,OAAOC,MAAP,CAAc,KAAKX,QAAnB,EAA4BS,OAA5B,CAAhB;AACA;AAjB+D;AAAA;AAAA,8BAkBtD;AACT,QAAIG,OAAO,IAAX;AACAC,eAAW,YAAU;AACpBD,UAAKL,SAAL;AACA,KAFD,EAEE,GAFF;AAGA;AAvB+D;AAAA;AAAA,qCAwB/C;AAChBL,WAAOY,gBAAP,CAAwB,QAAxB,EAAiC,KAAKP,SAAL,CAAeQ,IAAf,CAAoB,IAApB,CAAjC,EAA2D,KAA3D;AACA;AA1B+D;AAAA;AAAA,+BA2BrD;AACV,QAAIC,WAAW,KAAKC,gBAAL,EAAf;AAAA,QAAuCL,OAAO,IAA9C;AACA,QAAG,CAACI,QAAD,IAAaA,SAASE,MAAT,KAAoB,CAApC,EAAsC;AACrC;AACA;AACDC,UAAMC,IAAN,CAAWJ,QAAX,EAAoB,mBAAW;AAC9BJ,UAAKS,UAAL,CAAgBC,OAAhB;AACA,KAFD;AAGA;AAnC+D;AAAA;AAAA,sCAoCjC;AAAA,QAAdA,OAAc,uEAAN,KAAM;;AAC9B,WAAOC,SAASC,gBAAT,CAA0BF,UAAQ,YAAlC,KAAmD,KAA1D;AACA;AAtC+D;AAAA;AAAA,8BAuCrDA,OAvCqD,EAuC7C;AAClB,QAAIG,UAAUF,SAASG,IAAT,CAAcC,SAA5B;AAAA,QAAsCC,aAAaN,QAAQK,SAA3D;AACA,QAAGC,aAAaH,OAAb,IAAwB,KAAKzB,QAAL,CAAcC,SAAzC,EAAmD;AAClD,UAAK4B,cAAL,CAAoBP,OAApB;AACA;AACD;AA5C+D;AAAA;AAAA,kCA6CjDA,OA7CiD,EA6CzC;AACtB,QAAIQ,MAAM,IAAIC,KAAJ,EAAV;AAAA,QACCC,OAAOV,QAAQW,YAAR,CAAqB,UAArB,KAAoCX,QAAQW,YAAR,CAAqB,UAArB,CAApC,IAAwEX,QAAQW,YAAR,CAAqB,UAArB,CAAxE,IAA4G,KAAKjC,QAAL,CAAcM,OADlI;AAEAgB,YAAQY,eAAR,CAAwB,UAAxB;AACAJ,QAAIK,MAAJ,GAAa,YAAU;AACtBb,aAAQc,YAAR,CAAqB,KAArB,EAA2BJ,IAA3B;AACA,KAFD;AAGAF,QAAIO,GAAJ,GAAUL,IAAV;AACA;AArD+D;;AAAA;AAAA;;AAuDjElC,QAAOD,OAAP,GAAiB,IAAIE,QAAJ,EAAjB;AAEA,CAzDD","file":"../../../js_es6/utils/async/lazyload.js","sourcesContent":["/*\r\n    name:lazyload.js\r\n    description:数据懒加载\r\n    anthor:wanglonghai\r\n    data:2016-11-19\r\n */\r\ndefine(\"utils/async/lazyload\", function(require, exports, module) {\r\n\trequire('lib/polyfill/array.js');\r\n\trequire('lib/polyfill/object.js');\r\n\r\n\tclass LazyLoad {\r\n\t\t/*懒加载*/\r\n\t\tconstructor(){\r\n\t\t\tthis.defaults = {\r\n\t\t\t\twinHeight: window.innerHeight,\r\n\t\t\t\tloading: wapcsspath + '/images/loading-1.gif',\r\n\t\t\t\tlazyImg: wapcsspath + '/images/default_product.png'\r\n\t\t\t}\r\n\t\t\tthis._lazyload();\r\n\t\t\tthis._ListenerScroll();\r\n\t\t}\r\n\t\tinit(options){\r\n\t\t\tthis.defaults = Object.assign(this.defaults,options);\r\n\t\t}\r\n\t\tlazyload(){\r\n\t\t\tvar self = this;\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tself._lazyload();\r\n\t\t\t},300);\r\n\t\t}\r\n\t\t_ListenerScroll(){\r\n\t\t\twindow.addEventListener('scroll',this._lazyload.bind(this),false);\r\n\t\t}\r\n\t\t_lazyload(){\r\n\t\t\tlet elements = this._lazyLoadElement(),self = this;\r\n\t\t\tif(!elements && elements.length === 0){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tArray.from(elements,element => {\r\n\t\t\t\tself._beginLoad(element);\t\t\t\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t_lazyLoadElement(element='img'){\r\n\t\t\treturn document.querySelectorAll(element+'[data-url]') || false;\r\n\t\t}\r\n\t\t_beginLoad(element){\r\n\t\t\tlet bodyTop = document.body.scrollTop,currentTop = element.scrollTop;\r\n\t\t\tif(currentTop - bodyTop <= this.defaults.winHeight){\r\n\t\t\t\tthis._changeImgPath(element);\r\n\t\t\t}\r\n\t\t}\r\n\t\t_changeImgPath(element){\r\n\t\t\tlet img = new Image(),\r\n\t\t\t\tpath = element.getAttribute('data-url') || element.getAttribute('gome-src') || element.getAttribute('data-src') || this.defaults.lazyImg;\r\n\t\t\telement.removeAttribute('data-url');\r\n\t\t\timg.onload = function(){\r\n\t\t\t\telement.setAttribute('src',path);\r\n\t\t\t}\r\n\t\t\timg.src = path;\r\n\t\t}\r\n\t}\r\n\tmodule.exports = new LazyLoad();\r\n\r\n})\t\t"]}