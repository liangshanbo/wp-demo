{"version":3,"sources":["utils/async/ajax.js"],"names":["define","require","exports","module","alert","Ajax","options","self","df","_init","xmlhttp","ops","Object","assign","defaults","open","type","url","responseType","dataType","onload","status","readyState","res","response","alertSecond","message","success","console","log","ontimeout","data","_formatParams","send","params","callback","_request","query","before","after","formdata","FormData","key","append","XMLHttpRequest"],"mappings":";;;;;;;;AAAA;;;;;;AAMAA,OAAO,kBAAP,EAA2B,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AAC7DF,SAAQ,wBAAR;AACA,KAAIG,QAAQH,QAAQ,oBAAR,CAAZ;;AAF6D,KAIvDI,IAJuD;AAK5D,kBAAc;AAAA;AAEb;;AAP2D;AAAA;AAAA,4BAQnDC,OARmD,EAQ1C;AACjB,QAAIC,OAAO,IAAX;AAAA,QACCC,KAAK,KAAKC,KAAL,EADN;AAAA,QAECC,UAAUF,GAAGE,OAFd;AAAA,QAGCC,MAAMC,OAAOC,MAAP,CAAcL,GAAGM,QAAjB,EAA2BR,OAA3B,CAHP;;AAKAI,YAAQK,IAAR,CAAaJ,IAAIK,IAAjB,EAAuBL,IAAIM,GAA3B,EAAgC,IAAhC;AACAP,YAAQQ,YAAR,GAAuBP,IAAIQ,QAA3B;AACA;AACAT,YAAQU,MAAR,GAAiB,YAAM;AACtB,SAAIV,QAAQW,MAAR,KAAmB,GAAnB,IAA0BX,QAAQY,UAAR,KAAuB,CAArD,EAAwD;AACvD,UAAIC,MAAMb,QAAQc,QAAR,IAAoB,EAA9B;AACA,UAAG,QAAOD,GAAP,yCAAOA,GAAP,OAAe,QAAf,IAA2B,UAAUA,GAArC,IAA4CA,IAAI,MAAJ,MAAgB,GAA/D,EAAmE;AAClEnB,aAAMqB,WAAN,CAAkBF,IAAIG,OAAtB;AACA;AACDf,UAAIgB,OAAJ,CAAYjB,QAAQc,QAApB;AACA,MAND,MAMO;AACNI,cAAQC,GAAR,CAAY,iBAAZ;AACA;AACD,KAVD;AAWAnB,YAAQoB,SAAR,GAAoB,YAAM;AACzBF,aAAQC,GAAR,CAAY,MAAZ;AACA,KAFD;AAGA,QAAIE,OAAO,KAAKC,aAAL,CAAmBrB,GAAnB,CAAX;AACAD,YAAQuB,IAAR,CAAaF,QAAQ,IAArB;AAEA;AAlC2D;AAAA;AAAA,yBAmCtDd,GAnCsD,EAmCjDiB,MAnCiD,EAmCzCC,QAnCyC,EAmC/B;AAC5B,SAAKC,QAAL,CAAc;AACbnB,UAAKA,GADQ;AAEbc,WAAMG,MAFO;AAGbP,cAASQ;AAHI,KAAd;AAKA;AAzC2D;AAAA;AAAA,wBA0CvDlB,GA1CuD,EA0ClDiB,MA1CkD,EA0C1CC,QA1C0C,EA0ChC;AAC3B,SAAKE,KAAL,CAAWpB,GAAX,EAAgBiB,MAAhB,EAAwBC,QAAxB;AACA;AA5C2D;AAAA;AAAA,4BA6CnDlB,GA7CmD,EA6C9CiB,MA7C8C,EA6CtCC,QA7CsC,EA6C5BG,MA7C4B,EA6CpBC,KA7CoB,EA6Cb;AAC9C,SAAKF,KAAL,CAAWpB,GAAX,EAAgBiB,MAAhB,EAAwB,UAASH,IAAT,EAAe;AACtCO;AACAH,iBAAYA,SAASJ,IAAT,CAAZ;AACAQ,cAASA,OAAT;AACA,KAJD;AAKA;AAnD2D;AAAA;AAAA,iCAoD9C5B,GApD8C,EAoDzC;AAClB,QAAI6B,WAAW,IAAIC,QAAJ,EAAf;AACA,SAAK,IAAIC,GAAT,IAAgB/B,IAAIoB,IAApB,EAA0B;AACzBS,cAASG,MAAT,CAAgBD,GAAhB,EAAqB/B,IAAIoB,IAAJ,CAASW,GAAT,CAArB;AACA;AACD,WAAOF,QAAP;AACA;AA1D2D;AAAA;AAAA,2BA2DpD;AACP,WAAO;AACN9B,cAAS,IAAIkC,cAAJ,EADH;AAEN9B,eAAU;AACTE,YAAM,MADG;AAETG,gBAAU,MAFD;AAGTQ,eAAS,mBAAW,CAAE,CAHb;AAITI,YAAM;AAJG;AAFJ,KAAP;AASA;AArE2D;;AAAA;AAAA;;AAwE7D5B,QAAOD,OAAP,GAAiB,IAAIG,IAAJ,EAAjB;AACA,CAzED","file":"../../../js_es6/utils/async/ajax.js","sourcesContent":["/*\r\n    name:ajax.js\r\n    description:ajax请求\r\n    anthor:luoxiaowei\r\n    data:2016-11-08\r\n */\r\ndefine(\"utils/async/ajax\", function(require, exports, module) {\r\n\trequire('lib/polyfill/object.js');\r\n\tlet alert = require('UI/dialog/alert.js');\r\n\r\n\tclass Ajax {\r\n\t\tconstructor() {\r\n\r\n\t\t}\r\n\t\t_request(options) {\r\n\t\t\tlet self = this,\r\n\t\t\t\tdf = this._init(),\r\n\t\t\t\txmlhttp = df.xmlhttp,\r\n\t\t\t\tops = Object.assign(df.defaults, options);\r\n\r\n\t\t\txmlhttp.open(ops.type, ops.url, true);\r\n\t\t\txmlhttp.responseType = ops.dataType;\r\n\t\t\t// xmlhttp.timeout = 3000;\r\n\t\t\txmlhttp.onload = () => {\r\n\t\t\t\tif (xmlhttp.status === 200 && xmlhttp.readyState === 4) {\r\n\t\t\t\t\tlet res = xmlhttp.response || {};\r\n\t\t\t\t\tif(typeof res === 'object' && 'code' in res && res['code'] === 401){\r\n\t\t\t\t\t\talert.alertSecond(res.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tops.success(xmlhttp.response);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('request is fail');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\txmlhttp.ontimeout = () => {\r\n\t\t\t\tconsole.log('请求超时');\r\n\t\t\t}\r\n\t\t\tlet data = this._formatParams(ops);\r\n\t\t\txmlhttp.send(data || null);\r\n\r\n\t\t}\r\n\t\tquery(url, params, callback) {\r\n\t\t\tthis._request({\r\n\t\t\t\turl: url,\r\n\t\t\t\tdata: params,\r\n\t\t\t\tsuccess: callback\r\n\t\t\t});\r\n\t\t}\r\n\t\tpost(url, params, callback) {\r\n\t\t\tthis.query(url, params, callback);\r\n\t\t}\r\n\t\tloadmore(url, params, callback, before, after) {\r\n\t\t\tthis.query(url, params, function(data) {\r\n\t\t\t\tbefore();\r\n\t\t\t\tcallback && callback(data);\r\n\t\t\t\tafter && after();\r\n\t\t\t});\r\n\t\t}\r\n\t\t_formatParams(ops) {\r\n\t\t\tlet formdata = new FormData();\r\n\t\t\tfor (let key in ops.data) {\r\n\t\t\t\tformdata.append(key, ops.data[key]);\r\n\t\t\t}\r\n\t\t\treturn formdata;\r\n\t\t}\r\n\t\t_init() {\r\n\t\t\treturn {\r\n\t\t\t\txmlhttp: new XMLHttpRequest(),\r\n\t\t\t\tdefaults: {\r\n\t\t\t\t\ttype: 'post',\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tsuccess: function() {},\r\n\t\t\t\t\tdata: null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.exports = new Ajax();\r\n})"]}