{"version":3,"sources":["mods/login/index.js"],"names":["define","require","exports","module","appInterface","Cookie","login","callback","errback","getLoginStatus","data","code","gotoLogin","call","saveLogin","rmLogin","setCookie","id","loginToken","device_id","removeCookie"],"mappings":";;AAAA;;;;;;;AAOAA,OAAO,kBAAP,EAA2B,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AAC1D,QAAIC,eAAeH,QAAQ,oBAAR,CAAnB;AACA,QAAII,SAASJ,QAAQ,qBAAR,CAAb;AACA;;;AAGA,QAAIK,QAAQ,SAARA,KAAQ,CAACC,QAAD,EAAWC,OAAX,EAAuB;AAC/BC,uBAAe,UAASC,IAAT,EAAe;AAC1B,gBAAIA,KAAKC,IAAL,KAAc,GAAlB,EAAuB;AACnBJ,yBAASG,IAAT;AACH,aAFD,MAEO;AACHE,0BAAUL,QAAV,EAAoBC,OAApB;AACH;AACJ,SAND;AAOH,KARD;;AAUA;;;AAGA,QAAIC,iBAAiB,SAAjBA,cAAiB,CAACF,QAAD,EAAuC;AAAA,YAA5BC,OAA4B,uEAAlB,YAAW,CAAE,CAAK;;AACxDJ,qBAAaS,IAAb,CAAkB,wBAAlB,EAA4C,UAASH,IAAT,EAAe;AACvD,gBAAIA,KAAKC,IAAL,KAAc,GAAlB,EAAuB;AACnBG,0BAAUJ,KAAKA,IAAf;AACAH,yBAASG,IAAT;AACH,aAHD,MAGO;AACHK;AACAP,wBAAQE,IAAR;AACH;AACJ,SARD;AASH,KAVD;;AAYA;;;AAGA,QAAIE,YAAY,SAAZA,SAAY,CAACL,QAAD,EAAuC;AAAA,YAA5BC,OAA4B,uEAAlB,YAAW,CAAE,CAAK;;AACnDJ,qBAAaS,IAAb,CAAkB,eAAlB,EAAmC,UAASH,IAAT,EAAe;AAC9C,gBAAIA,KAAKC,IAAL,IAAa,GAAjB,EAAsB;AAClBG,0BAAUJ,KAAKA,IAAf;AACAH,yBAASG,IAAT;AACH,aAHD,MAGO;AACHK;AACAP;AACH;AACJ,SARD;AASH,KAVD;;AAYA;;;;;AAKA,QAAIM,YAAY,SAAZA,SAAY,CAACJ,IAAD,EAAU;AACtBL,eAAOW,SAAP,CAAiB,iBAAjB,EAAoCN,KAAKO,EAAzC,EAA6C,CAA7C;AACAZ,eAAOW,SAAP,CAAiB,oBAAjB,EAAuCN,KAAKQ,UAA5C,EAAwD,CAAxD;AACAb,eAAOW,SAAP,CAAiB,mBAAjB,EAAsCN,KAAKS,SAA3C,EAAsD,CAAtD;AACH,KAJD;;AAMA;;;AAGA,QAAIJ,UAAU,SAAVA,OAAU,GAAM;AAChBV,eAAOe,YAAP,CAAoB,iBAApB;AACAf,eAAOe,YAAP,CAAoB,oBAApB;AACAf,eAAOe,YAAP,CAAoB,mBAApB;AACH,KAJD;;AAMAjB,WAAOD,OAAP,GAAiB;AACbI,oBADa;AAEbM,4BAFa;AAGbE,4BAHa;AAIbL;AAJa,KAAjB;AAMH,CAxED","file":"../../../../mods/login/index.js","sourcesContent":["/**\r\n * @title: 登录的公共处理\r\n * @time:  2017-03-04\r\n * @author: wangchunpeng\r\n * 参数：callback             [必填] \r\n *       errback： 失败的回调 [选填]\r\n */\r\ndefine(\"mods/login/index\", function(require, exports, module) {\r\n    let appInterface = require(\"utils/appInterface\");\r\n    let Cookie = require(\"mods/storage/cookie\");\r\n    /**\r\n     * @title:判断是否是登录状态：1.不是去登录，拿到数据 2.是，直接拿到数据\r\n     */\r\n    let login = (callback, errback) => {\r\n        getLoginStatus(function(data) {\r\n            if (data.code === 200) {\r\n                callback(data);\r\n            } else {\r\n                gotoLogin(callback, errback);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @title: 获取用户是否是登录状态\r\n     */\r\n    let getLoginStatus = (callback, errback = function() {}) => {\r\n        appInterface.call(\"/common/getLoginStatus\", function(data) {\r\n            if (data.code === 200) {\r\n                saveLogin(data.data);\r\n                callback(data);\r\n            } else {\r\n                rmLogin();\r\n                errback(data);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @title: 直接去登录，不判断\r\n     */\r\n    let gotoLogin = (callback, errback = function() {}) => {\r\n        appInterface.call(\"/common/login\", function(data) {\r\n            if (data.code == 200) {\r\n                saveLogin(data.data);\r\n                callback(data);\r\n            } else {\r\n                rmLogin();\r\n                errback();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @title: 将userId计入cookie\r\n     * data: {id,loginToken}\r\n     * user cookie都是记录一个小时\r\n     */\r\n    let saveLogin = (data) => {\r\n        Cookie.setCookie(\"gomeplus-userid\", data.id, 1);\r\n        Cookie.setCookie(\"gomeplus-usertoken\", data.loginToken, 1);\r\n        Cookie.setCookie(\"gomeplus-deviceid\", data.device_id, 1);\r\n    }\r\n\r\n    /**\r\n     * @title: 删除cookie的登录用户信息\r\n     */\r\n    let rmLogin = () => {\r\n        Cookie.removeCookie(\"gomeplus-userid\");\r\n        Cookie.removeCookie(\"gomeplus-usertoken\");\r\n        Cookie.removeCookie(\"gomeplus-deviceid\");\r\n    }\r\n\r\n    module.exports = {\r\n        login,\r\n        gotoLogin,\r\n        saveLogin,\r\n        getLoginStatus\r\n    }\r\n});\r\n"]}