{"version":3,"sources":["utils/appInterface.js"],"names":["define","require","exports","module","AppInterface","url","params","callback","arguments","length","internal","joinurl","do","msg","timeout","call","href","location","host","h5url","indexOf","encodeURIComponent","target","ajaxs","obj","item","includes","abort","xhr","XMLHttpRequest","open","responseType","onload","readyState","status","res","response","JSON","parse","console","log","send"],"mappings":"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","file":"../../../utils/appInterface.js","sourcesContent":["/**\r\n * @title: H5与App沟通协议\r\n * @time:  2017-02-28\r\n * @author: wangchunpeng\r\n */\r\ndefine(\"utils/appInterface\", function(require, exports, module) {\r\n    require(\"lib/polyfill/string\");\r\n\r\n    class AppInterface {\r\n        /**\r\n         * @title: 客户端通信\r\n         * @param  {[type]}   url      [description] 客户端通信url           [必填]\r\n         * @param  {[type]}   params   [description] 给客户端传递参数        [选填]\r\n         * @param  {Function} callback [description] 客户端触发H5的回调函数  [必填]\r\n         */\r\n        call(url, params, callback) {\r\n            if (arguments.length === 2) {\r\n                callback = params;\r\n                params = {};\r\n            }\r\n            url = internal.joinurl(url, params);\r\n            internal.do(url, callback);\r\n        }\r\n        toast(msg, timeout = 2000) {\r\n                this.call(\"/common/toast\", {\r\n                    msg: msg,\r\n                    timeout: timeout\r\n                }, function() {})\r\n            }\r\n            /**\r\n             * title: 内嵌页面调起另一个内嵌页面\r\n             */\r\n        callWebView(url, callback) {\r\n                let href = location.host,\r\n                    h5url = href.indexOf(\"-pre\") > 0 ? \"https://h5-pre.gomeplus.in\" : \"https://h5.gomeplus.in\";\r\n                h5url = encodeURIComponent(h5url + url);\r\n                this.call(\"/nativeCall\", {\r\n                    target: \"gomeplusos://os.mx.com/hybrid/webViewOpen?url=\" + h5url\r\n                }, callback);\r\n            }\r\n            /**\r\n             * @title: 内嵌页面调起app页面\r\n             */\r\n        callApp(url, callback) {\r\n            this.call(\"/nativeCall\", {\r\n                target: \"gomeplusos://os.mx.com\" + url\r\n            }, callback);\r\n        }\r\n    }\r\n\r\n    let ajaxs = {};\r\n    let internal = {\r\n        joinurl(url, obj) {\r\n            let params = \"_mobile_bridge=1\";\r\n            for (let item in obj) {\r\n                params += `&${item}=${encodeURIComponent(obj[item])}`;\r\n            }\r\n            url += (url.includes(\"?\") ? \"&\" : \"?\") + params;\r\n            return url;\r\n        },\r\n        do(url, callback) {\r\n            if (ajaxs[url]) {\r\n                ajaxs[url].abort();\r\n                delete ajaxs[url];\r\n            }\r\n            let xhr = new XMLHttpRequest();\r\n            xhr.open(\"GET\", url, true);\r\n            xhr.timeout = 0;\r\n            xhr.responseType = \"json\";\r\n            ajaxs[url] = xhr;\r\n            xhr.onload = () => {\r\n                if (xhr.readyState === 4) {\r\n                    if (xhr.status === 200) {\r\n                        let res = xhr.response;\r\n                        res = (typeof res == \"string\") ? JSON.parse(res) : res;\r\n                        callback(res);\r\n                    } else {\r\n                        console.log('request is fail');\r\n                    }\r\n                    delete ajaxs[url];\r\n                }\r\n\r\n            }\r\n            xhr.send(null);\r\n        }\r\n    }\r\n\r\n    module.exports = new AppInterface();\r\n});\r\n"]}