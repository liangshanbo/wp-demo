{"version":3,"sources":["mods/send_verification.js"],"names":["define","require","exports","module","UI","ajax","timer","stoken","checkPhone","dom","obj","time","callback","post","url","data","success","code","removeClass","smsToken","_countDown","addClass","alertSecond","message","location","assign","$","val","error","times","html","setInterval","clearTimer","clearInterval"],"mappings":";;AAAA;;;;;;AAMAA,OAAO,2BAAP,EAAoC,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AACpE,QAAMC,KAAKH,QAAQ,oBAAR,CAAX;AAAA,QACII,OAAOJ,QAAQ,qBAAR,CADX;AAEAA,YAAQ,GAAR;AACA,QAAIK,cAAJ;AAAA,QAAUC,eAAV;AACA;AACA,aAASC,UAAT,CAAoBC,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAmCC,QAAnC,EAA6C;AACzCP,aAAKQ,IAAL,CAAU;AACNC,iBAAK,eADC;AAENC,kBAAML,GAFA;AAGNM,qBAAS,iBAAUD,IAAV,EAAgB;AACrB,oBAAIE,OAAOF,KAAKE,IAAhB;AACA,oBAAIA,SAAS,GAAb,EAAkB;AACdR,wBAAIS,WAAJ,CAAgB,qBAAhB;AACAN,gCAAYA,SAASG,KAAKA,IAAL,CAAUI,QAAnB,CAAZ;AACAC,+BAAWX,GAAX,EAAgBE,IAAhB;AACH,iBAJD,MAIO;AACHF,wBAAIY,QAAJ,CAAa,qBAAb;AACAjB,uBAAGkB,WAAH,CAAeP,KAAKQ,OAApB,EAA6B,YAAY;AACrC,4BAAIN,SAAS,GAAb,EAAkB;AACdO,qCAASC,MAAT,CAAgB,kBAAkBC,EAAE,WAAF,EAAeC,GAAf,EAAlC;AACH;AACJ,qBAJD,EAIG,IAJH;AAKH;AACJ,aAjBK;AAkBNC,mBAAO,eAAUb,IAAV,EAAgB,CAEtB;AApBK,SAAV;AAsBH;AACD;AACA,aAASK,UAAT,CAAoBX,GAApB,EAAyBE,IAAzB,EAA+B;AAC3B,YAAIkB,QAAQlB,IAAZ;AACAF,YAAIqB,IAAJ,CAASD,KAAT;AACAvB,gBAAQyB,YAAY,YAAY;AAC5BF;AACApB,gBAAIqB,IAAJ,CAASD,KAAT;AACA,gBAAIA,SAAS,CAAb,EAAgB;AACZG;AACAvB,oBAAIqB,IAAJ,CAAS,MAAT;AACArB,oBAAIY,QAAJ,CAAa,qBAAb;AACAQ,wBAAQlB,IAAR;AACH;AACJ,SATO,EASL,IATK,CAAR;AAUH;AACD,aAASqB,UAAT,GAAqB;AACjBC,sBAAc3B,KAAd;AACH;AACDH,WAAOD,OAAP,GAAiB,EAACM,sBAAD,EAAYwB,sBAAZ,EAAjB;AACH,CAjDD","file":"../../../mods/send_verification.js","sourcesContent":["/**\n * 发送验证码倒计时公共脚本\n * @author 黄奕海\n * @date 20170220\n * 页面引用\n */\ndefine('mods/send_verification.js', function (require, exports, module) {\n    const UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js');\n    require('$');\n    let timer,stoken;\n    //发送验证码\n    function checkPhone(dom, obj, time,callback) {\n        ajax.post({\n            url: '/api/user/sms',\n            data: obj,\n            success: function (data) {\n                let code = data.code;\n                if (code === 200) {\n                    dom.removeClass('verification-active');\n                    callback && callback(data.data.smsToken);\n                    _countDown(dom, time);\n                } else {\n                    dom.addClass('verification-active');\n                    UI.alertSecond(data.message, function () {\n                        if (code === 409) {\n                            location.assign(\"/login?phone=\" + $('#username').val());\n                        }\n                    }, 1000)\n                }\n            },\n            error: function (data) {\n\n            }\n        })\n    }\n    //倒计时\n    function _countDown(dom, time) {\n        let times = time;\n        dom.html(times);\n        timer = setInterval(function () {\n            times--;\n            dom.html(times);\n            if (times <= 0) {\n                clearTimer();\n                dom.html(\"Send\");\n                dom.addClass('verification-active');\n                times = time;\n            }\n        }, 1000)\n    }\n    function clearTimer(){\n        clearInterval(timer);\n    }\n    module.exports = {checkPhone,clearTimer}\n});\n\n"]}