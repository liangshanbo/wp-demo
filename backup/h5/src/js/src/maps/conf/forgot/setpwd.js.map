{"version":3,"sources":["conf/forgot/setpwd.js"],"names":["define","require","exports","module","check","UI","ajax","storage","pwd","$","pwd1","confirm","isHigh","init","bindEvents","on","val","replace","length","confirmHigh","password","alertSecond","pwdVal","pwdVal1","children","hasClass","confirmSetpwd","removeClass","addClass","stoken","Date","getItem","removeItem","obj","smsToken","confirmedPassword","put","url","data","success","code","phone","location","assign","message","error"],"mappings":"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","file":"../../../../conf/forgot/setpwd.js","sourcesContent":["/**\n * 忘记密码设置密码脚本\n * @author 黄奕海\n * @date 20170220\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/forgot/setpwd.js\">\n </script>\n */\ndefine('conf/forgot/setpwd.js', function (require, exports, module) {\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        storage = require('mods/storage/storage');\n    require('$');\n    let pwd = $('#password'),\n        pwd1 = $('#password1'),\n        confirm = $('#confirm'),\n        isHigh = {pwd: false, pwd1: false};\n    init();\n    function init() {\n        bindEvents();\n    }\n\n    function bindEvents() {\n        pwd.on('input', function () {\n            let val = pwd.val();\n            pwd.val(val.replace(/[<> \\&]/g,\"\"));\n            isHigh.pwd = val.length >= 6 ? true : false;\n            confirmHigh();\n        }).on('blur', function () {\n            let val = pwd.val();\n            if (!check.password(val)) {\n                UI.alertSecond('Please enter a password for 6-20 bit letters, numbers, or symbols');\n            }\n        });\n        pwd1.on('input', function () {\n            let val = pwd1.val();\n            pwd1.val(val.replace(/[<> \\&]/g,\"\"));\n            isHigh.pwd1 = val.length >= 6 ? true : false;\n            confirmHigh();\n        }).on('blur', function () {\n            let val = pwd1.val();\n            if (!check.password(val)) {\n                UI.alertSecond('Please enter a password for 6-20 bit letters, numbers, or symbols');\n            }\n        });\n        confirm.on('click', function () {\n            let pwdVal = pwd.val(),\n                pwdVal1 = pwd1.val();\n            if (confirm.children('a').hasClass('disabled')) {\n                return;\n            }\n            if (pwdVal !== pwdVal1) {\n                UI.alertSecond('Password two input is not consistent, please re-ente');\n                return;\n            }\n            confirmSetpwd();\n        })\n    }\n\n    //confirm按钮高亮\n    function confirmHigh() {\n        if (isHigh.pwd && isHigh.pwd1) {\n            confirm.children('a').removeClass('disabled');\n        } else {\n            confirm.children('a').addClass('disabled');\n        }\n    }\n\n    //重置密码提交\n    function confirmSetpwd() {\n        let stoken;\n        if(new Date() * 1 - storage.getItem('ssttime') <= 600000){\n            stoken = storage.getItem('sst');\n        }else{\n            storage.removeItem(\"sst\");\n            storage.removeItem(\"ssttime\");\n        }\n        let obj = {\n            smsToken: stoken,\n            password: pwd.val(),\n            confirmedPassword: pwd1.val()\n        };\n        ajax.put({\n            url: '/api/user/password',\n            data: obj,\n            success:function(data){\n                if(data.code === 200){\n                    UI.alertSecond('Successful operation',function(){\n                        let phone = storage.getItem('fphone');\n                        storage.removeItem('sst');\n                        storage.removeItem('ssttime');\n                        location.assign(\"/login?phone=\"+phone);\n                    },500)\n                }else{\n                    UI.alertSecond(data.message);\n                }\n            },\n            error:function(){\n\n            }\n        })\n    }\n});\n"]}