{"version":3,"sources":["conf/pro/detail.js"],"names":["define","require","exports","module","login","UI","ajax","storage","Swiper","cookie","share","init","g_detail","btns","buy","$","like","layerBtn","layer","closeLayer","params","getParams","fns","pagination","paginationClickable","slidesPerView","getCookie","collect","attr","alertSecond","setCookie","collection","id","bindEvent","on","isLogin","url","userId","location","assign","pathname","search","cancelCollection","hasLogin","removeItem","removeBox","layer_show","setItem","amount","show","hide","dom","post","success","data","code","children","addClass","error","message","delete","itemId","removeClass","obj","test","substr","arr","split","i","l","length","res"],"mappings":"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","file":"../../../../conf/pro/detail.js","sourcesContent":["/**\n * title: 商品详情\n * author: wangchunpeng\n * time: 2017-02-20 \n */\ndefine('conf/pro/detail.js', function(require, exports, module) {\n\trequire('$');\n\tconst login = require('mods/login');\n\tconst UI = require('UI/dialog/alert');\n\tconst ajax = require('utils/async/ajax');\n\tconst storage = require('mods/storage/storage');\n\tconst Swiper = require('mods/swiper.js');\n\tconst cookie = require('mods/storage/cookie.js');\n\t//require('utils/async/lazyload.js');\n\tconst share = require('mods/share/shareDialog');\n\tshare.init();\n\tconst g_detail = {\n\t\tbtns: {\n\t\t\tbuy: $('#buy'),\n\t\t\tlike: $('#like'),\n\t\t\tshare: $('#share'),\n\t\t\tlayerBtn: $('#proDetailLayer'),\n\t\t\tlayer: $('#goodDetailLayer'),\n\t\t\tcloseLayer:$('#closeLayer')\n\t\t},\n\t\tparams:getParams(),\n\t\tfns: {\n\t\t\tinit: init\n\t\t}\n\t};\n\n\tg_detail.fns.init();\n\n\tfunction init() {\n\t\tnew Swiper('.hot',{\n\t\t\tpagination: '.pagination',\n\t\t\tpaginationClickable: true,\n\t\t\tslidesPerView: 'auto'\n\t\t});\n\t\t//处理未登录收藏的逻辑\n\t\tif(cookie.getCookie('collect') === \"1\"){\n\t\t\tvar collect = g_detail.btns.like.attr('collect');\n\t\t\tif(collect == \"1\"){\n\t\t\t\tUI.alertSecond(\"Collection success\");\n\t\t\t\tcookie.setCookie('collect',\"0\",1/(24*10*6));\n\t\t\t}else{\n\t\t\t\tcollection(g_detail.params.id,g_detail.btns.like);\n\t\t\t}\n\t\t}\n\t\tbindEvent();\n\t}\n\n\tfunction bindEvent() {\n\t\tg_detail.btns.buy.on('click', () => {\n\t\t\tlogin.isLogin(() => {\n\t\t\t\tlet url = g_detail.btns.buy.attr('data-url') + '&affExtParam1='+userId;\n\t\t\t\tlocation.assign(url || '/');\n\t\t\t},g_detail.btns.buy.attr('data-url'),\"&type=buy\");\n\t\t});\n\t\tg_detail.btns.like.on('click', () => {\n\t\t\tvar collect = g_detail.btns.like.attr('collect'),\n\t\t\t\turl = location.pathname+location.search;\n\t\t\tlogin.isLogin(() => {\n\t\t\t\tif(collect === \"0\"){\n\t\t\t\t\tcollection(g_detail.params.id,g_detail.btns.like)\n\t\t\t\t}else{\n\t\t\t\t\tcancelCollection(g_detail.params.id,g_detail.btns.like)\n\t\t\t\t}\n\t\t\t},url,\"&type=collect\");\n\t\t});\n\t\tg_detail.btns.share.on('click', () => {\n\t\t\tif(hasLogin){\n\t\t\t\tstorage.removeItem('share_login');\n\t\t\t\tshare.init().removeBox();\n\t\t\t\tshare.init().layer_show();\n\t\t\t}else{\n\t\t\t\tstorage.setItem('share_login','true');\n\t\t\t\tlogin.isLogin();\n\t\t\t}\n\t\t});\n\t\tg_detail.btns.layerBtn.on('click', () => {\n\t\t\tvar amount = g_detail.btns.layerBtn.attr('amount');\n\t\t\tif(amount>100){\n\t\t\t\tg_detail.btns.layer.show();\n\t\t\t}\n\t\t});\n\t\tg_detail.btns.closeLayer.on('click', () => {\n\t\t\tg_detail.btns.layer.hide();\n\t\t});\n\t}\n\tfunction collection(id,dom){\n\t\tajax.post({\n\t\t\turl: '/api/user/item?itemId=' + id,\n\t\t\tsuccess: function (data) {\n\t\t\t\tif(data.code === 200){\n\t\t\t\t\tdom.attr('collect','1').children('i').addClass('active');\n\t\t\t\t\tUI.alertSecond(\"Collection success\")\n\t\t\t\t}\n\t\t\t},\n\t\t\terror:function(data){\n\t\t\t\tUI.alertSecond(data.message)\n\t\t\t}\n\t\t})\n\t}\n\tfunction cancelCollection(id,dom){\n\t\tajax.delete({\n\t\t\turl: '/api/user/item',\n\t\t\tdata: {itemId: id},\n\t\t\tsuccess: function (data) {\n\t\t\t\tif(data.code === 200){\n\t\t\t\t\tdom.attr('collect','0').children('i').removeClass('active');\n\t\t\t\t\tUI.alertSecond(\"Cancel collection success\")\n\t\t\t\t}\n\t\t\t},\n\t\t\terror:function(data){\n\t\t\t\tUI.alertSecond(data.message)\n\t\t\t}\n\t\t})\n\t}\n\tfunction getParams(url) { //获取url传递的参数*/\n\t\tvar obj = {};\n\t\turl = url || location.search;\n\t\turl = /^\\?.*/i.test(url) ? url.substr(1) : url;\n\t\tvar arr = url.split(\"&\");\n\t\tfor (var i = 0, l = arr.length; i < l; i++) {\n\t\t\tvar res = arr[i].split(\"=\");\n\t\t\tobj[res[0]] = res[1]\n\t\t}\n\t\treturn obj;\n\n\t}\n});"]}