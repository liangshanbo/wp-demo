{"version":3,"sources":["conf/invite/regist.js"],"names":["define","require","exports","module","$","Vue","ajax","check","UI","sendVerification","storage","el","data","phone","getParams","location","search","verification","agree","stoken","timer","isShow","init","_this","code","getItem","countryCode","val","addClass","html","click","hide","show","on","attr","find","removeClass","methods","hideTS","dom","$this","currentTarget","showTS","type","countryList","isNext","send","length","_nextHigh","isAgree","hasClass","getCode","obj","checkPhone","params","callback","token","setItem","Date","nextStep","ga","source","invitationCode","removeItem","mobile","smsCode","smsToken","put","url","success","href","alertSecond","message","error","decodeURI","test","substr","arr","split","i","l","res"],"mappings":"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","file":"../../../js_es6/conf/invite/regist.js","sourcesContent":["/**\n * 邀请好友\n * @author wangming\n * @date 20170314\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/invite/regist.js\">\n </script>\n */\ndefine('conf/invite/regist.js', function (require, exports, module) {\n    const $ = require('$'),\n        Vue = require(\"vue\"),\n        ajax = require('utils/async/ajax.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage.js');\n    require('mods/country_area.js');       \n    new Vue({\n        el: \"body\",\n        data: {\n            phone: getParams(location.search).phone ? true : false,\n            verification: false,\n            agree: true,\n            stoken: \"\",\n            timer: \"\",\n            isShow: false\n        },\n        init: function() {\n            let phone = getParams(location.search).phone;\n            let _this = this,\n                code = storage.getItem('code' + phone),\n                countryCode = storage.getItem('countryCode' + phone);\n            if(phone && phone >= 7) {\n                $(\"#username\").val(phone);\n                $(\"#send\").addClass('verification-active');\n                if(code) {\n                    if(code != \"undefined\") {\n                        this.code = storage.getItem('code' + phone);\n                        this.countryCode = storage.getItem('countryCode' + phone);\n                        $(\"#countryNum\").html(this.code +\" \" + this.countryCode);\n                    } else {\n                        $(\"#countryNum\").html(\"IN +91\");\n                    }\n                }\n                \n            }\n            $(\"#area_cancel\").click(function(){\n                _this.isShow = false;\n                $(\"#area\").hide();\n                $(\"#regist\").show();\n            });\n            $(\".country\").on(\"click\", \"dd\", function() {\n                _this.code = $(this).attr(\"code\");\n                _this.countryCode = $(this).attr(\"countrycode\");\n                $(\"#countryNum\").html(_this.code +\" \" + _this.countryCode);\n                _this.isShow = false;\n                $(\"#area\").hide();\n                $(\"#regist\").show();\n                $('#country').find('dt').removeClass('fixed');\n            });\n        },\n        methods: {\n            hideTS: function (dom) {\n                let $this = $(dom.currentTarget);\n                $this.attr(\"placeholder\", \"\");\n            },\n            showTS: function (dom, type) { // type: 1、手机号   2、验证码\n                let $this = $(dom.currentTarget);\n                if(type === 1) {\n                    $this.attr(\"placeholder\", \"Mobile No\");\n                } else {\n                    $this.attr(\"placeholder\", \"SMS verification code\");\n                }\n            },\n            countryList: function() {\n                if(this.isShow) {\n                    $(\"#area\").hide();\n                    $(\"#regist\").show();\n                } else {\n                    $(\"#area\").show();\n                    $(\"#regist\").hide();\n                }\n                this.show = !this.show;\n            },\n            isNext: function(dom, type) {\n                let $this = $(dom.currentTarget),\n                    val = $this.val(),\n                    send = $(\"#send\");\n                if(type === 1) {\n                    if(val.length >= 7) {\n                        this.phone = true;\n                        if(send.html() == \"SEND\") {\n                            send.addClass('verification-active');\n                        }\n                    } else {\n                        this.phone =  false;\n                        send.removeClass('verification-active');\n                    }\n                } else {\n                    this.verification = val.length >= 6 ? true : false;\n                }\n                this._nextHigh();\n            },\n            isAgree: function(dom) {\n                let $this = $(dom.currentTarget);\n                if($this.hasClass(\"register-agreement-active\")) {\n                    $this.removeClass(\"register-agreement-active\");\n                    this.agree = true;\n                } else {\n                    $this.addClass(\"register-agreement-active\");\n                    this.agree = false;\n                }\n                this._nextHigh();\n            },\n            getCode: function(dom) {\n                const phone = $(\"#username\").val(),\n                    obj = {\n                        \"countryCode\" : this.countryCode ? this.countryCode : \"+91\",\n                        \"mobile\" : phone,\n                        \"type\" : \"INVITE_REGISTER\"\n                    },\n                    $this = $(dom.currentTarget),\n                    _this = this;\n                if (!$this.hasClass('verification-active')) {\n                    return;\n                }\n                $this.removeClass('verification-active');\n                sendVerification.checkPhone({\n                    dom:$(\"#send\"),\n                    params:obj,\n                    type:1,\n                    callback:function(token){\n                        _this.stoken = token;//获取手机验证码token;\n                        storage.setItem(\"inv\"+phone,token);//register stoken\n                        storage.setItem(\"invtime\",new Date()*1);//register time\n                    }\n                });\n                /*ajax.post({\n                    url: '/api/user/sms',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code,\n                            token = data.data.smsToken;\n                        if (code === 200) {\n                           \n                        } else {\n                            $this.addClass('verification-active');\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })*/\n            },\n            nextStep: function(dom) {\n                //埋点\n             \n                ga('send', 'event', 'login/sign', 'invite_sign_next_btn_click');\n                let $this = $(dom.currentTarget),\n                    phone = $(\"#username\").val(),\n                    verification = $(\"#verification\").val(),\n                    params = getParams(location.search),\n                    source = params.source,\n                    _this = this,\n                    invitationCode = params.invitationCode;\n                if($this.hasClass(\"disabled\")) {\n                    return;\n                }\n                if(new Date() * 1 - storage.getItem('invtime') <= 600000 && storage.getItem('inv'+phone)){\n                    this.stoken = storage.getItem('inv'+phone);\n                } else {\n                    storage.removeItem(\"inv\"+phone);\n                    storage.removeItem(\"invtime\");\n                }\n                let obj = {\n                    countryCode : this.countryCode ? this.countryCode : \"+91\",\n                    mobile: phone,\n                    smsCode: verification,\n                    smsToken: this.stoken\n                };\n                ajax.put({\n                    url: '/api/user/sms',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code,\n                            token = data.data.smsToken;\n                        if (code === 200) {\n                            storage.setItem('invitetime', new Date() * 1);\n                            storage.setItem('invitesst', token);\n                            if(_this.code) {\n                                storage.setItem('code' + phone, _this.code);\n                                storage.setItem('countryCode' + phone, _this.countryCode);\n                            }\n                            location.href = \"/invite/setPassword?invitationCode=\" + invitationCode + \"&phone=\" + phone + \"&source=\" + source;\n                        } else {\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })\n            },\n            _nextHigh: function() {\n                if(this.phone && this.verification &&  this.agree) {\n                    $('#register').removeClass(\"disabled\");\n                } else {\n                    $('#register').addClass(\"disabled\");\n                }\n            },\n            /*_countDown: function(dom, time) {\n                let times = time,\n                    _this = this;\n                dom.html(times + \"s\");\n                _this.timer = setInterval(function () {\n                    times--;\n                    dom.html(times + \"s\");\n                    if (times <= 0) {\n                        _this.clearTimer();\n                        dom.html(\"Send\");\n                        dom.addClass('verification-active');\n                        times = time;\n                    }\n                }, 1000)\n            },\n            clearTimer: function(){\n                let _this = this;\n                clearInterval(_this.timer);\n            }*/\n        }\n    });\n\n    function getParams(url) {\n        let obj = {};\n        url = url || location.search;\n        url = decodeURI(url);\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        let arr = url.split(\"&\");\n        for (let i = 0, l = arr.length; i < l; i++) {\n            let res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n    }\n\n});\n"]}