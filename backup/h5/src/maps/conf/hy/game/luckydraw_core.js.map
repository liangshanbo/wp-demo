{"version":3,"sources":["conf/hy/game/luckydraw_core.js"],"names":["define","require","exports","module","Storage","Ajax","internal","dates","loading","date_now","Date","valueOf","$pre","$","$next","$list","$nolist","$date","date_storage","begintime","endtime","DrawCore","init","self","ajaxData","bindEvents","on","share","_toggle_date","$dom","type","parent","hasClass","now","data","bounses","str","l","Math","min","length","i","boun","html","show","hide","descr","description","split","find","timestamp","date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","miu","getMinutes","seconds","getSeconds","$now","_get_date","$begin","$end","$rnow","bPre","_get_timestamp","bNext","removeClass","addClass","dd","storage","getItem","join","query","url","queryDate","success","code","result","_handle_data","toast","message","_show_data","beginTime","entTime","bonusTime","_set_btn"],"mappings":"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","file":"../../../../js_es6/conf/hy/game/luckydraw_core.js","sourcesContent":["/**\n * @title: 幸运大抽奖--核心部分\n * @time:  2017-04-26\n * @author: wangchunpeng\n */\ndefine(\"conf/hy/game/luckydraw_core\", function(require, exports, module) {\n    require(\"$\");\n    let Storage = require(\"mods/storage/storage\"),\n        Ajax = require(\"utils/async/ajax\");\n\n    let internal = {\n        dates: [\"Apr\", \"May\"],\n        loading: false, //是否正在加载list\n        date_now: new Date().valueOf(), //当前显示的哪天的数据\n        $pre: $(\".pre\"),\n        $next: $(\".next\"),\n        $list: $(\".main .list\"),\n        $nolist: $(\".main .nolist\"),\n        $date: $(\".main .date\"),\n        date_storage: \"\",\n        begintime: \"\", //活动开始时间\n        endtime: \"\" //结束时间\n    }\n    class DrawCore {\n        constructor() {\n            this.init();\n        }\n        init() {\n            let self = this;\n            self.ajaxData();\n            self.bindEvents();\n        }\n        bindEvents() {\n            let self = this;\n            $(\".share,.share0\").on(\"click\", function() {\n                self.share();\n            });\n            internal.$pre.on(\"click\", function() {\n                self._toggle_date(internal.$pre, \"pre\");\n            });\n            internal.$next.on(\"click\", function() {\n                self._toggle_date(internal.$next, \"next\");\n            });\n        }\n        _toggle_date($dom, type) {\n            if ($dom.parent().hasClass(\"disabled\") || internal.loading) {\n                return;\n            }\n            let now = internal.date_now,\n                self = this;\n            if (type == \"next\") {\n                now += 24 * 60 * 60 * 1000;\n            } else {\n                now -= 24 * 60 * 60 * 1000;\n            }\n            internal.date_now = now;\n            self.ajaxData();\n        }\n        _show_data(data) {\n            let bounses = data.bounses;\n            if (bounses) {\n                let str = \"\",\n                    l = Math.min(10, bounses.length);\n                for (var i = 0; i < l; i++) {\n                    let boun = bounses[i];\n                    str += (boun[\"isMe\"] ? \"<li class='active'>\" : \"<li>\") +\n                        \"<a href='javascript:void(0)' class='clearfix'>\" +\n                        `<span class='uname'>${boun['nickname']}</span>` +\n                        `<span class='phone'>${boun['mobile']}</span>` +\n                        \"</li>\";\n                }\n                internal.$list.html(str).show();\n                internal.$nolist.hide();\n            } else {\n                let descr = data.description.split(\".\");\n                internal.$nolist.find(\".tip1\").html(descr[0]);\n                internal.$nolist.find(\".tip2\").html(descr[1]);\n                internal.$list.hide();\n                internal.$nolist.show();\n            }\n        }\n        _get_date(timestamp) {\n            let date = new Date(timestamp),\n                year = date.getFullYear(),\n                month = date.getMonth() + 1,\n                day = date.getDate(),\n                hour = date.getHours(),\n                miu = date.getMinutes(),\n                seconds = date.getSeconds();\n            month = month > 9 ? month : \"0\" + month;\n            day = day > 9 ? day : \"0\" + day;\n            hour = hour > 9 ? hour : \"0\" + hour;\n            miu = miu > 9 ? miu : \"0\" + miu;\n            seconds = seconds > 9 ? seconds : \"0\" + seconds;\n\n            return { year, month, day, hour, miu, seconds };\n        }\n\n        /**\n         * @title:设置next pre是否disable\n         * bPre： 大于开始时间的第二天\n         * bNext：小于结束时间&&小于当前时间\n         */\n        _set_btn() {\n            if (internal.begintime && internal.endtime) {\n                let self = this,\n                    $now = self._get_date(internal.date_now),\n                    $begin = self._get_date(internal.begintime),\n                    $end = self._get_date(internal.endtime),\n                    $rnow = self._get_date(new Date().valueOf());\n\n                let bPre = self._get_timestamp($now) > self._get_timestamp($begin),\n                    bNext = self._get_timestamp($now) < Math.min(self._get_timestamp($end), self._get_timestamp($rnow));\n\n                if (bPre) {\n                    internal.$pre.parent().removeClass(\"disabled\");\n                } else {\n                    internal.$pre.parent().addClass(\"disabled\");\n                }\n                if (bNext) {\n                    internal.$next.parent().removeClass(\"disabled\");\n                } else {\n                    internal.$next.parent().addClass(\"disabled\");\n                }\n            }\n        }\n        _get_timestamp($date) {\n            return new Date($date.year + \"/\" + $date.month + \"/\" + $date.day).valueOf()\n        }\n        ajaxData() {\n            let self = this;\n\n            internal.$list.hide();\n            internal.$nolist.find(\".tip\").html(\"\");\n            internal.$nolist.show();\n\n            let dd = self._get_date(internal.date_now),\n                storage = Storage.getItem(\"luckydraw_\" + internal.date_storage);\n            dd = [dd.year, dd.month, dd.day, dd.hour, dd.miu, dd.seconds].join(\"\");\n            if (storage) { //优先拿本地存储的数据\n                //self._handle_data(storage); //TODO\n                //return;\n            }\n            internal.loading = true;\n            Ajax.query({\n                url: \"/api/activity/luckydraw/bonuses\",\n                data: {\n                    queryDate: dd\n                },\n                success: function(data) {\n                    if (data.code === 200) {\n                        let result = data.data;\n                        self._handle_data(result);\n                        if (result.bounses) {\n                            //Storage.setItem(\"luckydraw_\" + internal.date_storage, JSON.stringify(result)); //TODO\n                        }\n                    } else {\n                        self.toast(data.message);\n                    }\n                    internal.loading = false;\n                }\n            });\n        }\n        _handle_data(result) {\n            let self = this;\n            self._show_data(result);\n            internal.begintime = result.beginTime;\n            internal.endtime = result.entTime;\n            if(result.bonusTime) {\n                internal.date_now = new Date(result.bonusTime).valueOf();\n            }\n            self._set_btn();\n            let date = self._get_date(internal.date_now),\n                str = \"\";\n            str += date.month == \"04\" ? internal[\"dates\"][0] : internal[\"dates\"][1];\n            str += \".\" + date.day;\n            internal.$date.find(\"span\").html(str);\n        }\n    }\n    module.exports = DrawCore;\n});\n"]}