{"version":3,"sources":["conf/hy/op/newgift.js"],"names":["define","require","exports","module","dlApp","Share","Ajax","Login","$mask","$","$modal","userId","hasLogin","userinfo","window","shareFB","picture","wapcsspath","href","location","replace","pathname","shareType","type","NewGift","bindEvents","_init","self","_getRed","on","internal","isLogin","share","login","dl","show","find","hide","showRedPacket","url","indexOf","query","data","status","pageNum","pageSize","success","code","orders","length","cashback","html","flag","$redclose","siblings","callback","errback","layer_show"],"mappings":"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","file":"../../../../js_es6/conf/hy/op/newgift.js","sourcesContent":["/**\n * @title:新人礼\n * @time:  2017-05-04\n */\ndefine(\"conf/hy/op/newgift\", function(require, exports, module) {\n    require(\"$\");\n    let dlApp = require(\"utils/dlApp\"),\n        Share = require('mods/share/shareDialog'),\n        Ajax = require(\"utils/async/ajax\"),\n        Login = require(\"mods/login\");\n\n    let $mask = $(\".mask\"),\n        $modal = $(\".modal\");\n    let userId = \"\",\n        hasLogin = false;\n    if (userinfo) {\n        userId = userinfo[\"user\"][\"id\"];\n        hasLogin = true;\n    }\n    window.userId = userId;\n    window.hasLogin = hasLogin;\n    let shareFB = new Share({\n        picture: wapcsspath + \"/images/game/luckydraw/share.jpg\",\n        href: location.href.replace(location.pathname, \"/invite/regist\"),\n        shareType: \"gameShare\",\n        type: \"gif\"\n    });\n    class NewGift {\n        constructor() {\n            this.bindEvents();\n            this._init();\n        }\n        _init() {\n            let self = this;\n            self._getRed();\n        }\n        bindEvents() {\n            let self = this;\n            $(\".btn01\").on(\"click\", function() {\n                internal.isLogin(function() {\n                    internal.share();\n                }, function() {\n                    Login.login();\n                });\n            });\n            $(\".btn02\").on(\"click\", function() {\n                dlApp.dl();\n            });\n            $(\".view a\").on(\"click\", function() {\n                $modal.show();\n            });\n            $modal.find(\".close\").on(\"click\", function() {\n                $modal.hide();\n            });\n            $mask.find(\".close\").on(\"click\", function() {\n                $mask.hide();\n            });\n            $mask.find(\".red-close\").on(\"click\", function() {\n                self.showRedPacket();\n            });\n            $mask.find(\".btn-more\").on(\"click\", function() {\n                $mask.hide();\n                internal.share();\n            });\n        }\n        _getRed() {\n            let self = this;\n            internal.isLogin(function() {\n                let url = location.href;\n                if (url.indexOf(\"source=banner\") < 0) {\n                    self.showRedPacket(1);\n                }\n                Ajax.query({\n                    url: \"/api/ext/cashback/details\",\n                    data: {\n                        status: \"ALL\",\n                        pageNum: 1,\n                        pageSize: 10,\n                        type: \"USERREGISTER\"\n                    },\n                    success: function(data) {\n                        if (data.code === 200 && data.data.orders) {\n                            let orders = data.data.orders;\n                            if (orders && orders.length) {\n                                let cashback = orders[0][\"cashBackAmount\"];\n                                $mask.find(\".money\").html(cashback[\"symbol\"] + cashback[\"amount\"] / 100);\n                            }\n                        }\n                    }\n                });\n            }, function() {});\n        }\n\n        /**\n         * @title: 打开红包弹框\n         * @param: flag 是否直接是打开的状态\n         */\n        showRedPacket(flag) {\n            let $redclose = $mask.find(\".red-close\");\n            if (flag) {\n                $mask.find(\".close\").hide();\n                $redclose.show().siblings().hide();\n            } else {\n                $mask.find(\".close\").show();\n                $redclose.hide().siblings().show();\n            }\n            $mask.show();\n        }\n    }\n    let internal = {\n        isLogin: function(callback, errback) {\n            if (userinfo) {\n                callback();\n            } else {\n                errback();\n            }\n        },\n        share: function() {\n            shareFB.layer_show();\n        }\n    }\n\n    new NewGift();\n});\n"]}