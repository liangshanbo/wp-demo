{"version":3,"sources":["conf/register/index.js"],"names":["define","require","exports","module","$","ajax","check","UI","sendVerification","storage","regist","phone","verification","agree","pwd","area","areaPhone","content","cancel","send","register","agreement","stoken","init","on","ga","bindEvents","document","getElementById","addEventListener","event","val","length","html","addClass","removeClass","setTimeout","registerHigh","replace","hasClass","obj","countryCode","split","checkPhone","dom","params","callback","token","setItem","Date","children","checkVerification","show","hide","country","attr","find","getItem","removeItem","smsCode","smsToken","mobile","password","alertSecond","post","url","data","success","code","query","planId","plan","planStatus","location","assign","message","error"],"mappings":"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","file":"../../../js_es6/conf/register/index.js","sourcesContent":["/**\n * 注册脚本\n * @author 黄奕海\n * @date 20170215\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/register/index.js\">\n </script>\n */\ndefine('conf/register/index.js', function(require, exports, module) {\n    const $ = require('$'),\n        ajax = require('utils/async/ajax.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage.js');\n    require('mods/country_area.js');\n    const regist = { phone: false, verification: false, agree: true, pwd: false };\n    let area = {\n        areaPhone: $('#register_area'),\n        area: $('#area'),\n        content: $('#content'),\n        cancel: $('#area_cancel')\n    };\n    let send = $('#send'),\n        phone = $('#username'),\n        verification = $('#verification'),\n        pwd = $('#password'),\n        agree = $('#agree'),\n        register = $('#register'),\n        agreement=$('.register-agreement-href'),\n        stoken;\n    init();\n    agreement.on(\"click\",function(){\n    //埋点\n    ga('send', 'event', 'login/sign', 'sign_protocol_click');\n    })\n    function init() {\n        bindEvents();\n    }\n\n    function bindEvents() {\n        document.getElementById('username').addEventListener('input', function(event) {\n            let val = phone.val();\n            if (val.length >= 7) {\n                regist.phone = true;\n                if (send.html() == \"SEND\") {\n                    send.addClass('verification-active');\n                }\n            } else {\n                regist.phone = false;\n                send.removeClass('verification-active');\n            }\n            if (val === \"\") { //苹果手机删除问题\n                setTimeout(function() {\n                    phone.val(\"\")\n                }, 50)\n            }\n            registerHigh();\n        }, false);\n        document.getElementById('verification').addEventListener('input', function(event) {\n            let val = verification.val();\n            regist.verification = val.length >= 6 ? true : false;\n            if (val === \"\") { //苹果手机删除问题\n                setTimeout(function() {\n                    verification.val(\"\")\n                }, 50)\n            }\n            registerHigh();\n        }, false);\n        document.getElementById('password').addEventListener('input', function(event) {\n            let val = pwd.val();\n            pwd.val(val.replace(/[<> \\&]/g, \"\"));\n            regist.pwd = val.length >= 6 ? true : false;\n            if (val === \"\") { //苹果手机删除问题\n                setTimeout(function() {\n                    pwd.val(\"\")\n                }, 50)\n            }\n            registerHigh();\n        }, false);\n        agree.on('click', function() {\n            if (agree.hasClass('no-select')) {\n                agree.removeClass('no-select');\n                regist.agree = true;\n            } else {\n                agree.addClass('no-select');\n                regist.agree = false;\n            }\n            registerHigh();\n        });\n        send.on('click', function () {\n       //埋点\n        ga('send', 'event', 'login/sign', 'sendSMScode_btn_click');\n            const obj = {\n                \"mobile\": phone.val(),\n                \"type\": \"REGIST\",\n                countryCode: \"+\" + area.areaPhone.html().split('+')[1]\n            };\n            if (!send.hasClass('verification-active')) {\n                return;\n            }\n            /*  if(!check.isMobile(phone.val())){\n                  UI.alertSecond('Phone number format error');\n                  return;\n              }*/\n            send.removeClass('verification-active');\n            sendVerification.checkPhone({\n                dom: send,\n                params: obj,\n                callback: function(token) {\n                    stoken = token; //获取手机验证码token;\n                    storage.setItem(\"rst\" + phone.val(), token); //register stoken\n                    storage.setItem(\"rsttime\", new Date() * 1); //register time\n                }\n            });\n        });\n        register.on('click',function(){\n        //埋点\n        ga('send', 'event', 'login/sign', 'sign_comfirm_btn_click');\n            if(register.children(\"a\").hasClass('disabled')){\n                return ;\n            }\n            checkVerification();\n        });\n        /*区域手机号*/\n        area.areaPhone.on('click', function() {\n            area.area.show();\n            area.content.hide();\n        });\n        area.area.on('click', 'dd', function() {\n            let country = $(this).attr('countryCode'),\n                countryCode = $(this).attr('code');\n            area.areaPhone.html(countryCode + \" \" + country);\n            area.area.hide();\n            area.content.show();\n            $('#country').find('dt').removeClass('fixed');\n        });\n        area.cancel.on('click', function() {\n            area.area.hide();\n            area.content.show();\n        })\n    }\n\n    //注册按钮高亮\n    function registerHigh() {\n        if (regist.phone && regist.pwd && regist.verification && regist.agree) {\n            register.children(\"a\").removeClass('disabled');\n        } else {\n            register.children(\"a\").addClass('disabled');\n        }\n    }\n    //验证手机验证码和密码\n    function checkVerification() {\n        if (new Date() * 1 - storage.getItem('rsttime') <= 600000 && storage.getItem('rst' + phone.val())) {\n            stoken = storage.getItem('rst' + phone.val());\n        } else {\n            storage.removeItem(\"rst\" + phone.val());\n            storage.removeItem(\"rsttime\");\n        }\n        let obj = {};\n        obj.smsCode = verification.val();\n        obj.smsToken = stoken;\n        obj.mobile = phone.val();\n        obj.password = pwd.val();\n        obj.countryCode = \"+\" + area.areaPhone.html().split('+')[1];\n        /* if(!check.isMobile(obj.mobile)){\n             UI.alertSecond('Phone number format error');\n             return;\n         }*/\n        if (!check.password(obj.password)) {\n            UI.alertSecond('Please enter a password with 6 to 20 digits, including letters, digitals or symbols.');\n            return;\n        }\n        ajax.post({\n            url: '/api/user/user',\n            data: obj,\n            success: function(data) {\n                if (data.code == 200) {\n                    UI.alertSecond(\"SIGN UP success\", function() {\n                        storage.removeItem(\"rst\" + phone.val());\n                        storage.removeItem(\"rsttime\");\n                        /**\n                         * @title: 注册有礼活动\n                         * @time:  2017-05-09\n                         * @author: wangchunpeng\n                         */\n                        ajax.query({\n                            url: \"/api/cashback/plan\",\n                            data: {\n                                planId: \"PLAN_1493806065175\"\n                            },\n                            success: function(data) {\n                                if (data.code === 200 && data.data.plan && data.data.plan.planStatus == \"OPEN\") {\n                                    location.assign('/hy/op/newgift');\n                                } else {\n                                    location.assign('/');\n                                }\n                            }\n                        });\n                    }, 500)\n                } else {\n                    verification.val(\"\");\n                    UI.alertSecond(data.message);\n                }\n            },\n            error: function() {\n\n            }\n        });\n    }\n});\n"]}