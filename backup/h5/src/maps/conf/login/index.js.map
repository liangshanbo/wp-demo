{"version":3,"sources":["conf/login/index.js"],"names":["define","require","exports","module","check","UI","ajax","storage","cookie","log","$","Mobile","password","mobileDel","regist","forgot","area","areaPhone","content","cancel","params","getParams","light","phone","psd","window","onload","val0","val","length","loginHigh","init","removeItem","getItem","html","document","getElementById","addEventListener","event","show","hide","setTimeout","on","focus","replace","country","attr","countryCode","find","removeClass","ga","isLogin","obj","mobile","split","post","url","data","success","code","redirect","decodeURIComponent","type","setCookie","user","id","location","alertSecond","message","error","navigator","onLine","trim","addClass","search","test","substr","arr","i","l","res"],"mappings":"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","file":"../../../js_es6/conf/login/index.js","sourcesContent":["/**\n * 登录脚本\n * @author guodanying\n * @date 20170216\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/login/index.js\">\n </script>\n */\ndefine('conf/login/index.js', function (require, exports, module) {\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        storage = require('mods/storage/storage'),\n        cookie = require('mods/storage/cookie');\n    require('$');\n    require('/conf/login/fbLog.js');\n    require('/conf/login/googleLog.js');\n    require('mods/country_area.js');\n    let log = $(\"#log\");\n    let Mobile = $(\"#username\");\n    let password = $(\"#password\");\n    let mobileDel = $('#login-phone-del');\n    let regist=$('.btn-border');\n    let forgot =$(\".login-input-forgot\");\n    let area = {\n        areaPhone:$('#login_area'),\n        area:$('#area'),\n        content:$('#content'),\n        cancel:$('#area_cancel')\n    };\n    let params = getParams();\n    const light = {phone: false, psd: false};\n    window.onload=function(){\n       //浏览器缓存\n        let val0 = Mobile.val();\n       /* let val1=[];\n            $(\"input[type=password]\").each(function(){\n                val1.push($(this).val());\n            });*/\n        if (val0.length >= 7) {\n            light.phone = true;\n            light.psd = true;\n            loginHigh();\n        }  \n    }\n   \n    init();\n    function init() {\n        //注册和忘记密码token;\n        storage.removeItem(\"fst\");\n        storage.removeItem(\"fsttime\");\n        storage.removeItem('sst');\n        storage.removeItem('ssttime');\n        if (Mobile.val() !== \"\") {\n            light.phone = true;\n        }\n        if(!!storage.getItem('area')){\n            area.areaPhone.html(storage.getItem('area'));\n            storage.removeItem(\"area\");\n        }\n        document.getElementById('username').addEventListener('input', function(event) {\n            let val = Mobile.val();\n            if(val!==\"\"){\n                mobileDel.show();\n            }else{\n                mobileDel.hide();\n            }\n            light.phone = val.length >= 7 ? true : false;\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    Mobile.val(\"\")\n                },50)\n            }\n            loginHigh();\n        }, false);\n        mobileDel.on('click',function(){\n            Mobile.val(\"\");\n            mobileDel.hide();\n            Mobile.focus();\n        });\n        document.getElementById('password').addEventListener('input', function(event) {\n            let val = password.val();\n            password.val(val.replace(/[<> \\&]/g,\"\"));\n            light.psd = val.length >= 6 ? true : false;\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    password.val(\"\")\n                },50)\n            }\n            loginHigh();\n        }, false);\n        /*区域手机号*/\n        area.areaPhone.on('click',function(){\n            area.area.show();\n            area.content.hide();\n        });\n        area.area.on('click','dd',function(){\n            let country = $(this).attr('countryCode'),\n                countryCode = $(this).attr('code');\n            area.areaPhone.html(countryCode+\" \"+country);\n            area.area.hide();\n            area.content.show();\n            $('#country').find('dt').removeClass('fixed');\n        });\n        area.cancel.on('click',function(){\n            area.area.hide();\n            area.content.show();\n        })\n    }\n    log.on(\"click\", function () {\n        //埋点\n        ga('send', 'event', 'login/sign', 'login_btn_click');\n        if ($(\"#log\").attr(\"disabled\") == \"true\") {\n            return false;\n            if (!isLogin()) {\n                return;\n            }\n        }\n        let obj = {\n            mobile: Mobile.val(),\n            password: password.val(),\n            countryCode:\"+\"+area.areaPhone.html().split('+')[1]\n        };\n        ajax.post({\n            url: '/api/user/login',\n            data: obj,\n            success: function (data) {\n                if (data.code === 200) {\n                    //type 记录回跳下一个页面。\n                    if(params && params.redirect){\n                        var redirect = decodeURIComponent(params.redirect);\n                        if(params.type){\n                            if(params.type === \"collect\"){\n                                cookie.setCookie(\"collect\",1,1/(24*10));\n                            }else if(params.type === \"buy\"){\n                                redirect+=\"&affExtParam1=\"+data.data.user.id;\n                            }\n                        }\n                        location.replace(redirect);\n                    }else{\n                        location.replace('/');\n                    }\n                } else {\n                     UI.alertSecond(data.message);\n                     return false;\n                }\n            },\n            error: function (data) {\n                UI.alertSecond(data.message);\n                return false;\n            }\n        })\n    })\n    regist.on(\"click\",function(){\n      //埋点\n        \n        ga('send', 'event', 'login/sign', 'sign_btn_click');\n    })\n    forgot.on(\"click\",function(){\n         //埋点\n        \n        ga('send', 'event', 'login/sign', 'forgotpassword_click');\n    })\n    function isLogin() {\n        if ('onLine' in navigator && !navigator.onLine) {\n            UI.alertSecond('Unable to access server. Please check network.');\n            return false;\n        }\n        ;\n      /*  if (!check.isMobile(Mobile.val().trim())) {\n            UI.alertSecond(\"User name or password is incorrect, please re-enter\");\n            return false;\n        }*/\n        ;\n        if (!check.password(password.val().trim())) {\n            UI.alertSecond(\"User name or password is incorrect, please re-enter\");\n            return false;\n        }\n        ;\n        return true;\n    }\n\n    function loginHigh() {\n        if (light.phone && light.psd) {\n            $(\"#log\").attr(\"disabled\", false).removeClass(\"disabled\");\n        } else {\n            $(\"#log\").attr(\"disabled\", true).addClass(\"disabled\");\n\n        }\n\n    }\n\n    function getParams(url) { //获取url传递的参数*/\n        var obj = {};\n        url = url || location.search;\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        var arr = url.split(\"&\");\n        for (var i = 0, l = arr.length; i < l; i++) {\n            var res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n        \n    }\n\n});\n"]}