{"version":3,"sources":["conf/login/associated.js"],"names":["define","require","exports","module","check","UI","ajax","sendVerification","storage","phone","$","send","verification","next","isHigh","stoken","area","areaPhone","content","cancel","bindEvents","document","getElementById","addEventListener","event","val","length","text","addClass","removeClass","setTimeout","nextHigh","on","obj","html","split","hasClass","checkPhone","dom","params","callback","token","setItem","Date","ga","getItem","removeItem","mobile","userInfo","thirdPartyAccountType","id","name","facePicUrl","fblogSub","show","hide","country","attr","countryCode","children","post","url","data","success","console","log","code","alertSecond","location","replace","message","error"],"mappings":"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","file":"../../../js_es6/conf/login/associated.js","sourcesContent":["/**\n * 第三方注册绑定手机号\n * @author lixuefeng\n * @date 20170228\n * 页面引用\n * <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/login/associated.js\">\n </script>\n*/\n\ndefine('conf/login/associated.js', function (require, exports, module) {\n    'use strict';\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage');\n    require('$');\n    require('mods/country_area.js');\n    let phone = $('#username'),\n        send = $('#send'),\n        verification = $('#verification'),\n        next = $('#next'),\n        isHigh = { phone: false, verification: false },\n        stoken = void 0;\n    let area = {\n        areaPhone:$('#register_area'),\n        area:$('#area'),\n        content:$('#content'),\n        cancel:$('#area_cancel')\n    };\n    let bindEvents = () => {\n        document.getElementById('username').addEventListener('input', function(event) {\n            var val = phone.val();\n            if (val.length >= 7) {\n                isHigh.phone = true;\n                if(send.text()=== \"SEND\"){\n                    send.addClass('verification-active'); //bgcolor:#FFF\n                }\n            } else {\n                isHigh.phone = false;\n                send.removeClass('verification-active');\n            }\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    phone.val(\"\")\n                },50)\n            }\n            nextHigh();\n        }, false);\n        document.getElementById('verification').addEventListener('input', function(event) {\n            let val = verification.val();\n            if (val.length >= 6) {\n                isHigh.verification = true;\n            } else {\n                isHigh.verification = false;\n            }\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    verification.val(\"\")\n                },50)\n            }\n            nextHigh();\n        }, false);\n        send.on('click',  () => {\n            const obj = {\n                \"mobile\": phone.val(),\n                \"type\": \"BINDPHONE\",\n                \"countryCode\":\"+\"+area.areaPhone.html().split('+')[1]\n            };\n            if (!send.hasClass('verification-active')) {\n                return;\n            };\n            /*if (!check.isMobile(phone.val())) {\n                UI.alertSecond('Phone number format error');\n                return;\n            };*/\n            send.removeClass('verification-active');\n            sendVerification.checkPhone({\n                dom:send,\n                params:obj,\n                callback:function (token) {\n                    stoken = token;\n                    storage.setItem(\"asc\" + phone.val(), token);\n                    storage.setItem(\"asctime\", new Date() * 1);\n                }\n            });\n        });\n        next.on('click', () => {\n        //埋点\n        \n        ga('send', 'event', 'login/sign', 'sign_mobilephone_relevance_confirm');\n            if (new Date() * 1 - storage.getItem('asctime') <= 600000 && storage.getItem('asc' + phone.val())) {\n                stoken = storage.getItem(\"asc\" + phone.val());\n            } else {\n                storage.removeItem(\"asc\" + phone.val());\n                storage.removeItem(\"asctime\");\n            }\n            let mobile = phone.val();\n            let userInfo = storage.getItem('ascToken');\n            const obj = {\n                \"mobile\": mobile,\n                \"smsCode\": verification.val(),\n                \"smsToken\": stoken,\n                \"countryCode\":\"+\"+area.areaPhone.html().split('+')[1],\n                \"thirdParty\":{\n                    \"type\":userInfo.thirdPartyAccountType,\n                    \"id\":userInfo.id,\n                    \"name\":userInfo.name,\n                    \"facePicUrl\":userInfo.facePicUrl\n\n\n                    /*\"facePicUrl\":userInfo.picture.data.url*/\n                }\n            };\n           /* if (!check.isMobile(mobile)) {\n                UI.alertSecond('Phone number format error');\n                return;\n            }*/\n            fblogSub(obj);\n        });\n        /*区域手机号*/\n        area.areaPhone.on('click',function(){\n            area.area.show();\n            area.content.hide();\n        });\n        area.area.on('click','dd',function(){\n            let country = $(this).attr('countryCode'),\n                countryCode = $(this).attr('code');\n            area.areaPhone.html(countryCode+\" \"+country);\n            area.area.hide();\n            area.content.show();\n        });\n        area.cancel.on('click',function(){\n            area.area.hide();\n            area.content.show();\n        })\n    }\n    //下一步按钮高亮\n    let nextHigh = () => {\n        if (isHigh.phone && isHigh.verification) {\n            next.children('a').removeClass('disabled');\n        } else {\n            next.children('a').addClass('disabled');\n        }\n    }\n    //提交注册信息\n    let fblogSub = (obj) => {\n        ajax.post({\n            url:'/api/user/thirdPartyAccountRegister',\n            data: obj,\n            success: (data) => {\n                console.log(data);\n                if (data.code === 200) {\n                    UI.alertSecond('Associated success', function () {\n                        location.replace('/');\n                    }, 1000);\n                } else {\n                    UI.alertSecond(data.message);\n                }\n            },\n            error: () => {}\n        })\n    }\n    bindEvents();\n});"]}