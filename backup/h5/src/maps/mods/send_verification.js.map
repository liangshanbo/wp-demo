{"version":3,"sources":["mods/send_verification.js"],"names":["define","require","exports","module","UI","ajax","storage","timer","stoken","checkPhone","obj","dom","params","time","callback","type","post","url","data","success","code","alertSecond","removeClass","smsToken","_countDown","addClass","message","$","setItem","html","location","assign","val","error","times","setInterval","clearTimer","clearInterval"],"mappings":";;AAAA;;;;;;AAMAA,OAAO,2BAAP,EAAoC,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AACpE,QAAMC,KAAKH,QAAQ,oBAAR,CAAX;AAAA,QACII,OAAOJ,QAAQ,qBAAR,CADX;AAAA,QAEIK,UAAUL,QAAQ,yBAAR,CAFd;AAGAA,YAAQ,GAAR;AACA,QAAIM,cAAJ;AAAA,QAAUC,eAAV;AACA;AACA,aAASC,UAAT,CAAoBC,GAApB,EAAyB;AACrB;AADqB,YAEhBC,GAFgB,GAEwBD,GAFxB,CAEhBC,GAFgB;AAAA,YAEZC,MAFY,GAEwBF,GAFxB,CAEZE,MAFY;AAAA,wBAEwBF,GAFxB,CAELG,IAFK;AAAA,YAELA,IAFK,6BAEA,EAFA;AAAA,YAEGC,QAFH,GAEwBJ,GAFxB,CAEGI,QAFH;AAAA,wBAEwBJ,GAFxB,CAEYK,IAFZ;AAAA,YAEYA,IAFZ,6BAEmB,CAFnB;;AAGrBV,aAAKW,IAAL,CAAU;AACNC,iBAAK,eADC;AAENC,kBAAMN,MAFA;AAGNO,qBAAS,iBAAUD,IAAV,EAAgB;AACrB,oBAAIE,OAAOF,KAAKE,IAAhB;AACA,oBAAIA,SAAS,GAAb,EAAkB;AACdhB,uBAAGiB,WAAH,CAAe,kBAAf;AACAV,wBAAIW,WAAJ,CAAgB,qBAAhB;AACAR,gCAAYA,SAASI,KAAKA,IAAL,CAAUK,QAAnB,CAAZ;AACAC,+BAAWb,GAAX,EAAgBE,IAAhB;AACH,iBALD,MAKO;AACHF,wBAAIc,QAAJ,CAAa,qBAAb;AACArB,uBAAGiB,WAAH,CAAeH,KAAKQ,OAApB,EAA6B,YAAY;AACrC,4BAAIN,SAAS,GAAT,IAAgBL,SAAS,CAA7B,EAAgC;AAC5B,gCAAGY,EAAE,gBAAF,CAAH,EAAuB;AACnBrB,wCAAQsB,OAAR,CAAgB,MAAhB,EAAuBD,EAAE,gBAAF,EAAoBE,IAApB,EAAvB;AACH;AACDC,qCAASC,MAAT,CAAgB,kBAAkBJ,EAAE,WAAF,EAAeK,GAAf,EAAlC;AACH;AACJ,qBAPD,EAOGjB,QAAQ,CAAR,GAAY,IAAZ,GAAmB,IAPtB;AAQH;AACJ,aArBK;AAsBNkB,mBAAO,eAAUf,IAAV,EAAgB,CAEtB;AAxBK,SAAV;AA0BH;AACD;AACA,aAASM,UAAT,CAAoBb,GAApB,EAAyBE,IAAzB,EAA+B;AAC3B,YAAIqB,QAAQrB,IAAZ;AACAF,YAAIkB,IAAJ,CAASK,QAAQ,GAAjB;AACA3B,gBAAQ4B,YAAY,YAAY;AAC5BD;AACAvB,gBAAIkB,IAAJ,CAASK,QAAQ,GAAjB;AACA,gBAAIA,SAAS,CAAb,EAAgB;AACZE;AACAzB,oBAAIkB,IAAJ,CAAS,MAAT;AACAlB,oBAAIc,QAAJ,CAAa,qBAAb;AACAS,wBAAQrB,IAAR;AACH;AACJ,SATO,EASL,IATK,CAAR;AAUH;AACD,aAASuB,UAAT,GAAqB;AACjBC,sBAAc9B,KAAd;AACH;AACDJ,WAAOD,OAAP,GAAiB,EAACO,sBAAD,EAAY2B,sBAAZ,EAAjB;AACH,CAxDD","file":"../../js_es6/mods/send_verification.js","sourcesContent":["/**\n * 发送验证码倒计时公共脚本\n * @author 黄奕海\n * @date 20170220\n * 页面引用\n */\ndefine('mods/send_verification.js', function (require, exports, module) {\n    const UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        storage = require('mods/storage/storage.js');\n    require('$');\n    let timer,stoken;\n    //发送验证码\n    function checkPhone(obj) {\n        //type type = 1 是从邀请注册\n        let {dom,params,time=60,callback,type = 0} = obj;\n        ajax.post({\n            url: '/api/user/sms',\n            data: params,\n            success: function (data) {\n                let code = data.code;\n                if (code === 200) {\n                    UI.alertSecond(\"Sms Send succeed\");\n                    dom.removeClass('verification-active');\n                    callback && callback(data.data.smsToken);\n                    _countDown(dom, time);\n                } else {\n                    dom.addClass('verification-active');\n                    UI.alertSecond(data.message, function () {\n                        if (code === 409 && type === 0) {\n                            if($('#register_area')){\n                                storage.setItem('area',$('#register_area').html());\n                            }\n                            location.assign(\"/login?phone=\" + $('#username').val());\n                        }\n                    }, type == 0 ? 1000 : 3000)\n                }\n            },\n            error: function (data) {\n\n            }\n        })\n    }\n    //倒计时\n    function _countDown(dom, time) {\n        let times = time;\n        dom.html(times + \"s\");\n        timer = setInterval(function () {\n            times--;\n            dom.html(times + \"s\");\n            if (times <= 0) {\n                clearTimer();\n                dom.html(\"SEND\");\n                dom.addClass('verification-active');\n                times = time;\n            }\n        }, 1000)\n    }\n    function clearTimer(){\n        clearInterval(timer);\n    }\n    module.exports = {checkPhone,clearTimer}\n});\n\n"]}