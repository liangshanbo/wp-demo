{"version":3,"sources":["mods/buried_point.js"],"names":["define","require","exports","module","$","ajax","cookie","point","SendPoint","defaults","dom","pdPos","pType","num","offset","move","data","listTop","options","self","Object","assign","_bindEvents","_touchEnd","find","length","parseFloat","position","top","itemHeight","eq","height","document","addEventListener","_touchStart","bind","_touchMove","event","touches","clientY","scrollTop","Math","ceil","window","screen","i","item","attr","push","post","url","ts","Date","act","auid","getCookie","agent","navigator","userAgent","_getPos","_getType","success","type","obj"],"mappings":";;;;;;AAAA;AACAA,OAAO,sBAAP,EAA+B,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AAC/D,QAAMC,IAAIH,QAAQ,GAAR,CAAV;AAAA,QACII,OAAOJ,QAAQ,qBAAR,CADX;AAAA,QAEIK,SAASL,QAAQ,wBAAR,CAFb;AAGA,QAAIM,QAAQ,EAAZ;;AAJ+D,QAKzDC,SALyD;AAM3D,6BAAc;AAAA;;AACV,iBAAKC,QAAL,GAAgB;AACZC,qBAAK,YADO;AAEZC,uBAAO,CAFK;AAGZC,uBAAO,CAHK;AAIZC,qBAAI;AAJQ,aAAhB;AAMA,iBAAKC,MAAL,GAAc,CAAd;AACA,iBAAKC,IAAL,GAAY,CAAZ;AACA,iBAAKC,IAAL,GAAY,EAAZ;AACA,iBAAKC,OAAL,GAAe,CAAf;AACH;;AAjB0D;AAAA;AAAA,iCAmBtDC,OAnBsD,EAmB7C;AACV,oBAAIC,OAAO,IAAX;AACAA,qBAAKV,QAAL,GAAgBW,OAAOC,MAAP,CAAcF,KAAKV,QAAnB,EAA6BS,OAA7B,CAAhB;AACAC,qBAAKG,WAAL;AACAH,qBAAKI,SAAL;AACH;AAxB0D;AAAA;AAAA,0CA0B7C;AACV,oBAAIJ,OAAO,IAAX;AACA,oBAAGf,EAAEe,KAAKV,QAAL,CAAcC,GAAhB,EAAqBc,IAArB,CAA0B,IAA1B,EAAgCC,MAAhC,IAAwC,CAA3C,EAA6C;AACzC;AACH;AACDN,qBAAKF,OAAL,GAAeS,WAAWtB,EAAEe,KAAKV,QAAL,CAAcC,GAAhB,EAAqBiB,QAArB,GAAgCC,GAA3C,CAAf;AACAT,qBAAKU,UAAL,GAAkBzB,EAAEe,KAAKV,QAAL,CAAcC,GAAhB,EAAqBc,IAArB,CAA0B,IAA1B,EAAgCM,EAAhC,CAAmC,CAAnC,EAAsCC,MAAtC,EAAlB;AACAC,yBAASC,gBAAT,CAA0B,YAA1B,EAAwCd,KAAKe,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAxC,EAAqE,KAArE;AACAH,yBAASC,gBAAT,CAA0B,WAA1B,EAAuCd,KAAKiB,UAAL,CAAgBD,IAAhB,CAAqB,IAArB,CAAvC,EAAmE,KAAnE;AACAH,yBAASC,gBAAT,CAA0B,UAA1B,EAAsCd,KAAKI,SAAL,CAAeY,IAAf,CAAoB,IAApB,CAAtC,EAAiE,KAAjE;AACH;AApC0D;AAAA;AAAA,wCAsC/CE,KAtC+C,EAsCxC;AACf,oBAAIlB,OAAO,IAAX;AACAA,qBAAKL,MAAL,GAAcuB,MAAMC,OAAN,CAAc,CAAd,EAAiBC,OAA/B;AACH;AAzC0D;AAAA;AAAA,uCA2ChDF,KA3CgD,EA2CzC;AACd,oBAAIlB,OAAO,IAAX;AACAA,qBAAKJ,IAAL,GAAYI,KAAKL,MAAL,GAAcuB,MAAMC,OAAN,CAAc,CAAd,EAAiBC,OAA3C;AACH;AA9C0D;AAAA;AAAA,wCAgD/C;AACR,oBAAIpB,OAAO,IAAX;AACA,oBAAGf,EAAEe,KAAKV,QAAL,CAAcC,GAAhB,EAAqBc,IAArB,CAA0B,IAA1B,EAAgCC,MAAhC,IAAwC,CAA3C,EAA6C;AACzC;AACH;AACD,oBAAIe,YAAYpC,EAAE,MAAF,EAAUoC,SAAV,EAAhB;AAAA,oBACI3B,MAAM4B,KAAKC,IAAL,CAAU,CAAChB,WAAWiB,OAAOC,MAAP,CAAcb,MAAzB,IAAiCS,SAAjC,GAA6CrB,KAAKF,OAAnD,IAA8DE,KAAKU,UAA7E,CADV;AAEA,oBAAIH,WAAWiB,OAAOC,MAAP,CAAcb,MAAzB,IAAiCS,SAAjC,GAA6CrB,KAAKF,OAAlD,GAA4D,CAA5D,IAAiEE,KAAKV,QAAL,CAAcI,GAAd,GAAoBA,GAAzF,EAA8F;AAC1F,yBAAK,IAAIgC,IAAI1B,KAAKV,QAAL,CAAcI,GAA3B,EAAgCgC,IAAIhC,GAApC,EAAyCgC,GAAzC,EAA8C;AAC1C,4BAAIC,OAAO1C,EAAEe,KAAKV,QAAL,CAAcC,GAAhB,EAAqBc,IAArB,CAA0B,IAA1B,EAAgCM,EAAhC,CAAmCe,CAAnC,EAAsCE,IAAtC,CAA2C,YAA3C,CAAX;AACA,4BAAGD,IAAH,EAAQ;AACJ3B,iCAAKH,IAAL,CAAUgC,IAAV,CAAeF,IAAf;AACH;AACJ;AACD;AACA,wBAAG3B,KAAKH,IAAL,CAAUS,MAAV,GAAiB,CAApB,EAAsB;AAClBpB,6BAAK4C,IAAL,CAAU;AACLC,iCAAI,gBADC;AAELlC,kCAAK;AACDA,sCAAKG,KAAKH,IADT;AAEDmC,oCAAG,IAAIC,IAAJ,KAAS,CAFX;AAGDC,qCAAI,SAHH;AAIDC,sCAAKhD,OAAOiD,SAAP,CAAiB,KAAjB,CAJJ;AAKDC,uCAAMb,OAAOc,SAAP,CAAiBC,SALtB;AAMD/C,uCAAMQ,KAAKwC,OAAL,CAAaxC,KAAKV,QAAL,CAAcE,KAA3B,CANL;AAODC,uCAAMO,KAAKyC,QAAL,CAAczC,KAAKV,QAAL,CAAcG,KAA5B;AAPL,6BAFA;AAWLiD,qCAAQ,mBAAU,CAEjB;AAbI,yBAAV;AAeH;AACJ;AACD1C,qBAAKV,QAAL,CAAcI,GAAd,GAAoBA,GAApB;AACAM,qBAAKH,IAAL,GAAY,EAAZ;AACAG,qBAAKJ,IAAL,GAAY,CAAZ;AACH;AApF0D;AAAA;AAAA,oCAsFnD+C,IAtFmD,EAsF7C;AACV,oBAAI,CAACA,IAAL,EAAW;AACP,2BAAO,EAAP;AACH;AACD,oBAAIC,MAAM;AACN,yBAAK,cADC,EACc;AACpB,yBAAK,cAFC,EAEc;AACpB,yBAAK,cAHC,CAGa;AAHb,iBAAV;AAKA,uBAAOA,IAAID,IAAJ,CAAP;AACH;AAhG0D;AAAA;AAAA,qCAkGlDA,IAlGkD,EAkG5C;AACX,oBAAI,CAACA,IAAL,EAAW;AACP,2BAAO,SAAP;AACH;AACD,oBAAIC,MAAM;AACN,yBAAK,SADC,EACS;AACf,yBAAK,SAFC,EAES;AACf,yBAAK,SAHC,EAGS;AACf,yBAAK,SAJC,EAIS;AACf,yBAAK,SALC,EAKS;AACf,yBAAK,SANC,EAMS;AACf,yBAAK,SAPC,EAOS;AACf,yBAAK,SARC,EAQS;AACf,yBAAK,SATC,CASQ;AATR,iBAAV;AAWA,uBAAOA,IAAID,IAAJ,CAAP;AACH;AAlH0D;;AAAA;AAAA;;AAoH/D3D,WAAOD,OAAP,GAAiB,IAAIM,SAAJ,EAAjB;AACH,CArHD","file":"../../js_es6/mods/buried_point.js","sourcesContent":["/*商品列表发送埋点  huangyihai  17/04/01*/\ndefine('mods/buried_point.js', function (require, exports, module) {\n    const $ = require(\"$\"),\n        ajax = require('utils/async/ajax.js'),\n        cookie = require('mods/storage/cookie.js');\n    let point = {};\n    class SendPoint {\n        constructor() {\n            this.defaults = {\n                dom: '#goodsList',\n                pdPos: 0,\n                pType: 0,\n                num:0\n            };\n            this.offset = 0;\n            this.move = 0;\n            this.data = [];\n            this.listTop = 0;\n        }\n\n        init(options) {\n            let self = this;\n            self.defaults = Object.assign(self.defaults, options);\n            self._bindEvents();\n            self._touchEnd();\n        }\n\n        _bindEvents() {\n            let self = this;\n            if($(self.defaults.dom).find('li').length<=0){\n                return;\n            }\n            self.listTop = parseFloat($(self.defaults.dom).position().top);\n            self.itemHeight = $(self.defaults.dom).find('li').eq(0).height();\n            document.addEventListener('touchstart', self._touchStart.bind(this), false);\n            document.addEventListener('touchmove', self._touchMove.bind(this), false);\n            document.addEventListener('touchend', self._touchEnd.bind(this), false);\n        }\n\n        _touchStart(event) {\n            let self = this;\n            self.offset = event.touches[0].clientY;\n        }\n\n        _touchMove(event) {\n            let self = this;\n            self.move = self.offset - event.touches[0].clientY;\n        }\n\n        _touchEnd() {\n            var self = this;\n            if($(self.defaults.dom).find('li').length<=0){\n                return;\n            }\n            let scrollTop = $('body').scrollTop(),\n                num = Math.ceil((parseFloat(window.screen.height)+scrollTop - self.listTop) / self.itemHeight);\n            if (parseFloat(window.screen.height)+scrollTop - self.listTop > 0 && self.defaults.num < num) {\n                for (let i = self.defaults.num; i < num; i++) {\n                    let item = $(self.defaults.dom).find('li').eq(i).attr('point-data');\n                    if(item){\n                        self.data.push(item);\n                    }\n                }\n                //console.log(self.data);\n                if(self.data.length>0){\n                    ajax.post({\n                         url:'/api/recom/log',\n                         data:{\n                             data:self.data,\n                             ts:new Date*1,\n                             act:\"display\",\n                             auid:cookie.getCookie('uid'),\n                             agent:window.navigator.userAgent,\n                             pdPos:self._getPos(self.defaults.pdPos),\n                             pType:self._getType(self.defaults.pType)\n                         },\n                         success:function(){\n\n                         }\n                     })\n                }\n            }\n            self.defaults.num = num;\n            self.data = [];\n            self.move = 0;\n        }\n\n        _getPos(type) {\n            if (!type) {\n                return \"\";\n            }\n            let obj = {\n                \"0\": \"BaP0001M0004\",//home list\n                \"1\": \"BaP0011M0002\",//分享成功list\n                \"2\": \"BaP0001M0004\"//home手动推荐list\n            };\n            return obj[type];\n        }\n\n        _getType(type) {\n            if (!type) {\n                return \"BaP0001\";\n            }\n            let obj = {\n                \"0\": \"BaP0001\",//home\n                \"1\": \"BaP0003\",//类目结果\n                \"2\": \"BaP0011\",//分享成功条跳转页\n                \"3\": \"BaP0009\",//搜索 list\n                \"4\": \"AcP0009\",//收藏\n                \"5\": \"BaP0005\",//mall 热销\n                \"6\": \"BaP0012\",//mall 超级返利\n                \"7\": \"BaP0006\",//mall 超低折扣\n                \"8\": \"BaP0004\"//mall 白菜价\n            };\n            return obj[type];\n        }\n    }\n    module.exports = new SendPoint();\n});"]}