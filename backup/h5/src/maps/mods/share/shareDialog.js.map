{"version":3,"sources":["mods/share/shareDialog.js"],"names":["define","require","exports","module","UI","dialog_com","login","storage","ajax","dialogStr","$shareLayer","$","$mask","$dom","shareFacebook","find","shareTwitter","shareWhatsapp","copyLink","shareDialog","param","img_Format","src","arr","index","indexOf","i","substring","parseInt","Share","options","picSet","bindTarget","bindEvent","undefined","shareType","shareId","shareTarget","type","btnType","sendData","picture","method","display","link","href","location","userId","title","text","description","hashtag","quote","mobile_iframe","caption","success","fb_success","failed","fb_failed","share_show","_self","hasLogin","removeItem","remove_box","layer_show","setItem","isLogin","init","window","fbAsyncInit","FB","appId","xfbml","version","AppEvents","logPageView","d","s","id","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","document","FB_init","hide","share_login","getItem","script","async","appendChild","onload","attr","clipboard","Clipboard","on","e","layer_hide","alertSecond","clearSelection","share_btn","show","animate","obj","siblings","remove","parent","parents","addClass","length","addElement","slotCancel","slotGo","origin","encodeURIComponent","msg","data","post","url","textStatus","request","code","console","log","error","getAttribute","ui","response","res","time","Date","getTime","uploadData","error_code","error_message","fb_upload","getLoginStatus","status","accessToken","authResponse","FB_userId","userID","fb_share","scope","open","fb_getAuthor","twitter_btn","whatsapp_btn","copy_btn","event_mask"],"mappings":"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","file":"../../../js_es6/mods/share/shareDialog.js","sourcesContent":["/**\n * 分享弹层\n * @author lixuefeng\n * @date 20170306\n * 页面引用\n * \"疲疲瞎！我们走！\"\n *\t<% include ../public/shareDialog.ejs %>\n *\tlet Share = require('mods/share/shareDialog');\n *\tlet share = new Share(options);\n *\toptions {\n \tbindEvent\t\t/node\t\t分享按钮 或调用 share.share_show() 弹出分享组件\n \t\tnew Share({bindEvent:[your share btn],options...});\n \t\tor new Share();share.share_show(options);\n\tmethod  \t\t/string\t\t分享类型\n\tdisplay\t\t\t/string\t\t分享模组类型\n\tmobile_iframe\t/boolen\t\ttrue：弹层分享/false:新页面分享 默认false;\n\thref\t\t\t/string\t\t链接\n\tpicture\t\t\t/string\t\t图片地址完整路径\n\ttitle \t\t\t/string\t\t标题\n\tdescription\t\t/string\t\t描述\n\tcaption \t\t/string\t\t来源\n\tquote \t\t\t/string\t\t引用\n\thashtag \t\t/string\t\t标签\n\tsuccess \t\t/function\t成功时回调\n\tfailed \t\t\t/function\t失败时回调\n\n\tshareType \t\t/string\t\t分享类型//用于数据上报接口 //\"productInfoShare\"\n\tshareId \t\t/string\t\t分享商品ID//用于数据上报与分享成功接口//\"\"\n\tshareTarget \t/string\t\t分享方式//用于数据上报接口//\"FACEBOOK\"\n *\t}\n *\tshare.layer_show();\n *\tshare.layer_hide();\t展开/隐藏 分享组件\n *\tshare.add_box();\n *\tshare.remove_box();\t显示/移除 成功toast\n*/\ndefine('mods/share/shareDialog.js', function (require, exports, module) {\n\trequire('$');\n\trequire(\"lib/zeptojs/fx\");\n\tconst  UI = require('UI/dialog/alert.js'),\n\t    dialog_com = require('UI/dialog/dialog_com.js'),\n\t    login = require('mods/login'),\n\t    storage = require('mods/storage/storage'),\n\t    ajax = require('utils/async/ajax.js'),\n\t    dialogStr = \"<header class='slot_header'><div class='slot_header_content' id='slot_cancel'>Shared Successfully!<em>X</em></div></header><article class='slot_main'><div class='slot_main_texts'><p>Play the slot machine to win rupee!</p></div><div class='slot_main_confirm'><a href='' id='slot_go'>GO</a></div></article>\";\n\tconst $shareLayer = $('#share_layer'),\n\t\t$mask = $(\"#share_mark\"),\n\t    $dom = {\n\t\t\tshareFacebook:$shareLayer.find('#share_facebook'),\n\t\t\tshareTwitter:$shareLayer.find('#share_twitter'),\n\t\t\tshareWhatsapp:$shareLayer.find(\"#share_whatsapp\"),\n\t\t\tcopyLink:$shareLayer.find('#share_copylink'),\n\t\t\tshareDialog:$shareLayer.find('#share_dialog')\n\t\t\t// shareExit:$shareLayer.find('#share_exit')\n\t\t};\n\tlet param = {},\n\timg_Format = (src) => {\n\t\tlet arr = [],\n\t\tindex = 0;\n\t\tarr[src.indexOf('jpg')] = 1;\n\t\tarr[src.indexOf('png')] = 1;\n\t\tarr[src.indexOf('gif')] = 1;\n\t\tfor( let i in arr ){\n\t\t\tif( arr[i] === 1 ){\n\t\t\t\tindex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\tif( index == -1 ){\n\t\t\treturn src+'.jpg.600x315zf.jpg';\n\t\t}\n\t\treturn src.substring(0,parseInt(index)+3)+'.600x315zf.jpg';\n\t};\n\tclass Share{\n\t\tconstructor(options){\n\t\t\tthis.picSet = false;\n\t\t\tthis.bindTarget = options&&options.bindEvent?options.bindEvent:undefined;\n\t\t\tthis.shareType = options&&options.shareType?options.shareType:\"productInfoShare\";\n\t\t\tthis.shareId = options&&options.shareId?options.shareId:\"\";\n\t\t\tthis.shareTarget = options&&options.shareTarget?options.shareTarget:\"FACEBOOK\";\n\t\t\tthis.type = options&&options.type?options.type:undefined;\n\t\t\tthis.btnType = options&&options.btnType?options.btnType:undefined; // 只有一个分享按钮时,传参facebook twitter whatsapp copylink\n\t\t\tthis.sendData = {};\n\t\t\tif( options&&options.picture ){\n\t\t\t\tthis.sendData.picture = options.picture;\n\t\t\t\tthis.picSet = true;\n\t\t\t}\n\t\t\tthis.sendData.method = options&&options.method?options.method:'feed';\n\t\t\tthis.sendData.display = options&&options.display?options.display:'touch';\n\t\t\tthis.sendData.link = options&&options.href?options.href:location.href.indexOf('?') === -1?location.href+'?&uerId='+userId:location.href+'&uerId='+userId;\n\t\t\tthis.sendData.title = options&&options.title?options.title:$('title').text();\n\t\t\tthis.sendData.description = options&&options.description?options.description:' ';\n\t\t\tthis.sendData.hashtag = options&&options.hashtag?options.hashtag:null;\n\t\t\tthis.sendData.quote = options&&options.quote?options.quote:null;\n\t\t\tthis.sendData.mobile_iframe = true;\n\t\t\tthis.sendData.caption = options&&options.caption?options.caption:'gomeplus.in';\n\t\t\tthis.success = options&&options.success?options.success:this.fb_success;\n\t\t\tthis.failed = options&&options.failed?options.failed:this.fb_failed;\n\t\t\tthis.share_show = () => {\n\t\t\t\tlet _self = this;\n\t\t\t\tif(hasLogin){\n\t\t\t\t\tstorage.removeItem('share_login');\n\t\t\t\t\t_self.remove_box();\n\t\t\t\t\t_self.layer_show();\n\t\t\t\t}else{\n\t\t\t\t\tstorage.setItem('share_login','true');\n\t\t\t\t\tlogin.isLogin();\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.init();\n\t\t}\n\t\tFB_init(){\n\t\t\twindow.fbAsyncInit = function() {\n\t\t        FB.init({\n\t\t            appId      : '125552021295455',\n\t\t            xfbml      : true,\n\t\t            version    : 'v2.8'\n\t\t        });\n\t\t        FB.AppEvents.logPageView();\n\t\t    };\n\t\t    (function(d, s, id){\n\t\t        var js, fjs = d.getElementsByTagName(s)[0];\n\t\t        if (d.getElementById(id)) {return;}\n\t\t        js = d.createElement(s); js.id = id;\n\t\t        js.src = \"https://drl8vxuq8vzq2.cloudfront.net/public/overseasJS/src/plugs/third/v1/fbsdk.js\";\n\t\t        fjs.parentNode.insertBefore(js, fjs);\n\t\t    }(document, 'script', 'facebook-jssdk'));\n\t\t}\n\t\tinit(){\n\t\t\tlet _self = this;\n\t\t\t_self.FB_init();\n\t\t\t$shareLayer.hide();\n\t\t\tlet share_login = storage.getItem('share_login');\n\t\t\tif( hasLogin && share_login && share_login === 'true'){\n\t\t\t\tstorage.removeItem('share_login');\n\t\t\t\t// _self.fb_getAuthor({data:_self});\n\t\t\t}\n\t\t\t_self.bindEvent();\n\t\t\t$(function() {\n\t\t\t\t// 暂时用cdn上的clipboard.js\n\t\t\t\tlet script = document.createElement('script');\n\t\t\t\tscript.async = \"async\";\n\t\t\t\tscript.src = 'https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js';\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(script);\n\t\t\t\tscript.onload = function() {\n\t\t\t\t\t$dom.copyLink.attr('data-clipboard-text',location.href+'&userId='+userId);\n\t\t\t\t\t// require('utils/clipboard.js');\n\t\t\t\t\tlet clipboard = new Clipboard('#share_copylink');\n\t\t\t\t\tclipboard.on('success', function(e) {\n\t\t\t\t\t\t_self.layer_hide();\n\t\t\t\t\t\tUI.alertSecond(\"copied\");\n\t\t\t\t\t\te.clearSelection();\n\t\t\t\t\t});\n\t\t\t\t\tclipboard.on('error', function(e) {\n\t\t\t\t\t\t_self.layer_hide();\n\t\t\t\t\t\tUI.alertSecond(\"Copy link failed,Please retry in the address bar\");\n\t\t\t\t\t});\n\t\t\t\t\tif( _self.type === \"gif\" || _self.type === \"video\" ){\n\t\t\t\t\t\tparam = {\n\t\t\t\t\t\t\tmethod:_self.sendData.method,\n\t\t\t\t\t\t\tdisplay:_self.sendData.display,\n\t\t\t\t\t\t\tlink:_self.sendData.link,\n\t\t\t\t\t\t\tcaption:_self.sendData.caption,\n\t\t\t\t\t\t\ttitle:_self.sendData.title\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_self.share_btn($dom.shareFacebook);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparam = _self.sendData;\n\t\t\t\t\t\t// $('head').append('<meta property=\"og:image:width\" content=\"1080\"><meta property=\"og:image:height\" content=\"576\">');\n\t\t\t\t\t};\n\t\t\t\t\tif(_self.btnType === \"facebook\"){\n\t\t\t\t\t\t_self.share_btn($dom.shareFacebook);\n\t\t\t\t\t}  else if(_self.btnType === \"twitter\") {\n\t\t\t\t\t\t_self.share_btn($dom.shareTwitter);\n\t\t\t\t\t} else if(_self.btnType === \"whatsapp\") {\n\t\t\t\t\t\t_self.share_btn($dom.shareWhatsapp);\n\t\t\t\t\t} else if(_self.btnType === \"copylink\"){\n\t\t\t\t\t\t_self.share_btn($dom.copyLink);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//\n\t\t\t});\n\t\t}\n\t\tlayer_show(){\n\t\t\t$shareLayer.show();\n\t\t\t$dom.shareDialog.animate({'bottom':'0px'},200);\n\t\t\treturn this;\n\t\t}\n\t\tlayer_hide(e){\n\t\t\t$shareLayer.hide();\n\t\t\treturn this;\n\t\t}\n\t\tshare_btn(obj){\n\t\t\tobj.siblings(\"li\").remove();\n\t\t\tobj.parent('ul').siblings(\"ul\").remove();\n\t\t\tobj.parents(\".share-dialog\").addClass(\"on\");\n\t\t}\n\t\tevent_mask(e){\n\t\t\t$dom.shareDialog.animate({'bottom':'-250px'},200,$shareLayer.hide());\n\t\t}\n\t\tadd_box(){\n\t\t\tlet _self = this;\n\t\t\tif($('#dialog_slot').length === 0){\n\t\t\t\tdialog_com.addElement(dialogStr,'slot','dialog_slot')\n\t\t\t\tlet slotCancel = $('#slot_cancel'),\n\t\t\t\t\tslotGo = $('#slot_go');\n\t\t\t\tslotCancel.on('click',_self.remove_box);\n\t\t\t\tslotGo.attr('href','/');\n\t\t\t};\n\t\t\treturn this;\n\t\t}\n\t\tremove_box(){\n\t\t\tif($('#dialog_slot').length>0){\n\t\t\t\tdialog_com.remove('#dialog_slot');\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\t\tcopy_btn(){\n\n\t\t}\n\n\t\tfb_success(){\n\t\t\tlet _self = this;\n\t\t\twindow.location.href = location.origin+\"/shareSuccess?backUrl=\"+encodeURIComponent(location.href)+\"&itemId=\"+encodeURIComponent(_self.shareId);\n\t\t}\n\t\tfb_failed(msg){\n\t\t\tif( msg&&msg!=undefined ){\n\t\t\t\tUI.alertSecond(msg);\n\t\t\t}else{\n\t\t\t\tUI.alertSecond('Failed');\n\t\t\t}\n\t\t}\n\t\tfb_upload(data){\n\t\t\tlet _self = this;\n\t\t\tajax.post({\n\t            url:'/api/user/shareAction',\n\t            data:data,\n\t            success:function(data, textStatus, request){\n\t                if(data.code == 200){\n\t                \tconsole.log(\"Report completed\");\n\t                \t// _self.success();\n\t                }else{\n\t                \tconsole.log('shareActionFailed');\n\t                }\n\t            },\n\t            error:function(){\n\t            \tconsole.log('shareActionError');\n\t            }\n\t        });\n\t\t}\n\t\tfb_share(){\n\t\t\tlet _self = this;\n\t\t\tif( !_self.picSet && _self.type != \"gif\" && _self.type != \"video\"){\n\t\t\t\t_self.sendData.picture = img_Format($('img')[0].getAttribute('src'));\n\t\t\t}\n\t\t\tFB.ui(param, function (response,res){\n\t\t\t\t$shareLayer.hide();\n\t\t\t\tstorage.removeItem('share_login');\n\t\t\t\tlet time = new Date().getTime(),\n\t\t    \tuploadData = {\n\t\t    \t\t\"shareType\":_self.shareType,\n\t\t    \t\t\"data\":{\n\t\t    \t\t\t\"id\":_self.shareId\n\t\t    \t\t},\n\t\t    \t\t\"target\":_self.shareTarget,\n\t\t    \t\t\"shareTime\":time\n\t\t    \t};\n\t\t\t\tif (response && response!= undefined ) {\n\t\t\t\t\tif( response.error_code != undefined ){\n\t\t\t\t\t\tif( response.error_message.indexOf('canceled') > -1 ){\n\t\t\t\t\t\t\t_self.failed('Cancelled');\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t_self.failed();\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\t_self.fb_upload(uploadData);\n\t\t\t\t\t\t_self.success();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_self.failed();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfb_getAuthor(e){\n\t\t\tlet _self = e?e.data:this;\n\t\t\tif(FB.length === 0){\n\t\t\t\tUI.alertSecond('Failed');\n\t\t\t}\n\t\t\tFB.getLoginStatus(function (response){\n\t\t\t\tif( response.status === 'connected' ){\n\t\t\t\t\tlet accessToken = response.authResponse.accessToken,//response from getLoginStatus\n\t\t\t\t\tFB_userId = response.authResponse.userID;\n\t\t\t\t\t_self.fb_share(accessToken,FB_userId);\n\t\t\t\t}else {\n\t\t\t\t\tFB.login(function(response){\n\t\t\t\t\tlet accessToken = response.authResponse.accessToken,//response from login\n\t\t\t\t\t\tFB_userId = response.authResponse.userID;\n\t\t\t\t\t  _self.fb_share(accessToken,FB_userId);\n\t\t\t\t\t},{scope:\"publish_actions,user_posts\"});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\ttwitter_btn(e){\n\t\t\tlet _self = e?e.data:this,\n\t\t\t\turl = 'https://twitter.com/intent/tweet?text='+_self.sendData.title+'&url='+encodeURIComponent(_self.sendData.link);\n\t\t\twindow.open(url,'share');\n\t\t}\n\n\t\twhatsapp_btn(e){\n\t\t\tlet _self = e?e.data:this;\n\t\t\tlocation.href = \"whatsapp://send?text= \" + _self.sendData.title + \"     \" + encodeURIComponent(_self.sendData.link);\n\t\t}\n\n\t\tbindEvent(){\n\t\t\tlet _self = this;\n\t\t\tif( _self.bindTarget != undefined ){\n\t\t\t\tif( _self.bindTarget instanceof $ ){\n\t\t\t\t\t_self.bindTarget.on( 'click',_self.share_show );\n\t\t\t\t}else{\n\t\t\t\t\t$(_self.bindTarget).on( 'click',_self.share_show );\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t$dom.shareFacebook.on('click',_self,_self.fb_getAuthor);\n\t\t\t$dom.shareTwitter.on('click',_self,_self.twitter_btn);\n\t\t\t$dom.shareWhatsapp.on('click',_self,_self.whatsapp_btn);\n\t\t\t$dom.copyLink.on('click',_self.copy_btn);\n\t\t\t// $dom.shareExit.on('click',_self.layer_hide);\n\t\t\t$mask.on('click',_self.event_mask);\n\t\t}\n\t}\n\n\tmodule.exports = Share;\n});\n"]}