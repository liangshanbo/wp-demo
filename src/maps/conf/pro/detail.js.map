{"version":3,"sources":["conf/pro/detail.js"],"names":["define","require","exports","module","login","UI","ajax","Swiper","cookie","Share","g_detail","btns","buy","$","like","share","layerBtn","layer","closeLayer","showList","select","confirm","thirdParty","params","getParams","fns","init","skus","bindEvent","shareId","attr","title","text","hashtag","getCookie","collect","alertSecond","setCookie","collection","id","children","length","loop","lazyLoading","pagination","onInit","autoplay","on","isLogin","url","userId","location","assign","show","pathname","search","cancelCollection","amount","hide","isShow","find","each","index","hasClass","removeClass","addClass","dom","post","success","data","code","error","message","delete","itemId","obj","test","substr","arr","split","i","l","res"],"mappings":"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","file":"../../../js_es6/conf/pro/detail.js","sourcesContent":["/**\n * title: 商品详情\n * author: wangchunpeng\n * time: 2017-02-20 \n */\ndefine('conf/pro/detail.js', function(require, exports, module) {\n\trequire('$');\n\tconst login = require('mods/login');\n\tconst UI = require('UI/dialog/alert');\n\tconst ajax = require('utils/async/ajax');\n\tconst Swiper = require('mods/swiper.js');\n\tconst cookie = require('mods/storage/cookie.js');\n\tconst Share = require('mods/share/shareDialog');\n\tconst g_detail = {\n\t\tbtns: {\n\t\t\tbuy: $('#buy'),\n\t\t\tlike: $('#like'),\n\t\t\tshare: $('#share'),\n\t\t\tlayerBtn: $('#proDetailLayer'),\n\t\t\tlayer: $('#goodDetailLayer'),\n\t\t\tcloseLayer:$('#closeLayer'),\n\t\t\tshowList:$('#showList'),\n\t\t\tselect:$('#select'),\n\t\t\tconfirm:$('#confirm')\n\t\t},\n\t\tthirdParty:$('#third_party'),\n\t\tparams:getParams(),\n\t\tfns: {\n\t\t\tinit: init\n\t\t},\n\t\tskus:$('#skus')\n\t};\n\n\tg_detail.fns.init();\n\tlet share = new Share({\n\t\tbindEvent:g_detail.btns.share,\n\t\tshareId:$(\".detail\").attr('data-id'),\n\t\ttitle:$('.detail-title').text(),\n\t\thashtag:'#GOMEPLUS'\n\t});\n\tfunction init() {\n\t\t//处理未登录收藏的逻辑\n\t\tif(cookie.getCookie('collect') === \"1\"){\n\t\t\tvar collect = g_detail.btns.like.attr('collect');\n\t\t\tif(collect == \"1\"){\n\t\t\t\tUI.alertSecond(\"success\");\n\t\t\t\tcookie.setCookie('collect',\"0\",1/(24*10*6));\n\t\t\t}else{\n\t\t\t\tcollection(g_detail.params.id,g_detail.btns.like);\n\t\t\t}\n\t\t}\n\t\tif($('#swiper-banner').children().length>1){\n\t\t\tnew Swiper ('.carousel', {\n\t\t\t\tloop: true,\n\t\t\t\t// 如果需要分页器\n\t\t\t\tlazyLoading:true,//解决轮播到最后再划显示默认图\n\t\t\t\tpagination: '.swiper-pagination',\n\t\t\t\tonInit:function(){\n\t\t\t\t\trequire('utils/async/lazyload.js');\n\t\t\t\t},\n\t\t\t\tautoplay:3000\n\t\t\t});\n\t\t}else{\n\t\t\trequire('utils/async/lazyload.js');\n\t\t}\n\n\t\tbindEvent();\n\t}\n\n\tfunction bindEvent() {\n\t\tg_detail.btns.buy.on('click', () => {\n\t\t\tlogin.isLogin(() => {\n\t\t\t\tif(cookie.getCookie('third_layer')){\n\t\t\t\t\tlet url = g_detail.btns.buy.attr('data-url') + '&affExtParam1='+userId;\n\t\t\t\t\tlocation.assign(url || '/');\n\t\t\t\t}else{\n\t\t\t\t\tg_detail.thirdParty.show();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tg_detail.btns.like.on('click', () => {\n\t\t\tlet collect = g_detail.btns.like.attr('collect'),\n\t\t\t\turl = location.pathname+location.search;\n\t\t\tlogin.isLogin(() => {\n\t\t\t\tif(collect === \"0\"){\n\t\t\t\t\tcollection(g_detail.params.id,g_detail.btns.like);\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\t\t\t\tcancelCollection(g_detail.params.id,g_detail.btns.like)\n\t\t\t},url,\"&type=collect\");\n\t\t});\n\t\t// g_detail.btns.share.on('click',function (){\n\t\t// \tconsole.log(share);\n\t\t// \tshare._show();\n\t\t// });\n\t\tg_detail.btns.layerBtn.on('click', () => {\n\t\t\tlet amount = g_detail.btns.layerBtn.attr('amount');\n\t\t\tif(amount>100){\n\t\t\t\tg_detail.btns.layer.show();\n\t\t\t}\n\t\t});\n\t\tg_detail.btns.closeLayer.on('click', () => {\n\t\t\tg_detail.btns.layer.hide();\n\t\t});\n\t\tif(g_detail.btns.showList.length>0){\n\t\t\tg_detail.btns.showList.on('click', () => {\n\t\t\t\tlet isShow = g_detail.skus.attr(\"isShow\");\n\t\t\t\tif(isShow === \"1\"){\n\t\t\t\t\tg_detail.skus.attr(\"isShow\",\"0\").find('li').each(function(){\n\t\t\t\t\t\tif($(this).children('span').children().length>4){\n\t\t\t\t\t\t\t$(this).children('span').children().each(function(){\n\t\t\t\t\t\t\t\tif($(this).index()>3){\n\t\t\t\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif($(this).index()>3){\n\t\t\t\t\t\t\t$(this).hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\t\t\t\tg_detail.skus.attr(\"isShow\",\"1\").find('li,a,del').show()\n\t\t\t});\n\t\t}\n\t\t/*弹层*/\n\t\tg_detail.btns.select.on('click',function(){\n\t\t\tif($(this).hasClass('active')){\n\t\t\t\t$(this).removeClass('active');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$(this).addClass('active');\n\t\t});\n\t\tg_detail.btns.confirm.on('click',function(){\n\t\t\tlet url = g_detail.btns.buy.attr('data-url') + '&affExtParam1='+userId;\n\t\t\tif(g_detail.btns.select.hasClass('active')){\n\t\t\t\tcookie.setCookie('third_layer',1,9999);\n\t\t\t}\n\t\t\tlocation.assign(url || '/');\n\t\t})\n\t}\n\tfunction collection(id,dom){\n\t\tajax.post({\n\t\t\turl: '/api/user/item?itemId=' + id,\n\t\t\tsuccess: function (data) {\n\t\t\t\tif(data.code === 200){\n\t\t\t\t\tdom.attr('collect','1').children('i').addClass('active');\n\t\t\t\t\tUI.alertSecond(\"success\")\n\t\t\t\t}\n\t\t\t},\n\t\t\terror:function(data){\n\t\t\t\tUI.alertSecond(data.message)\n\t\t\t}\n\t\t})\n\t}\n\tfunction cancelCollection(id,dom){\n\t\tajax.delete({\n\t\t\turl: '/api/user/item',\n\t\t\tdata: {itemId: id},\n\t\t\tsuccess: function (data) {\n\t\t\t\tif(data.code === 200){\n\t\t\t\t\tdom.attr('collect','0').children('i').removeClass('active');\n\t\t\t\t\tUI.alertSecond(\"Cancel success\")\n\t\t\t\t}\n\t\t\t},\n\t\t\terror:function(data){\n\t\t\t\tUI.alertSecond(data.message)\n\t\t\t}\n\t\t})\n\t}\n\tfunction getParams(url) { //获取url传递的参数*/\n\t\tvar obj = {};\n\t\turl = url || location.search;\n\t\turl = /^\\?.*/i.test(url) ? url.substr(1) : url;\n\t\tvar arr = url.split(\"&\");\n\t\tfor (var i = 0, l = arr.length; i < l; i++) {\n\t\t\tvar res = arr[i].split(\"=\");\n\t\t\tobj[res[0]] = res[1]\n\t\t}\n\t\treturn obj;\n\n\t}\n});"]}