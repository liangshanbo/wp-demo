{"version":3,"sources":["conf/goods/catedetail.js"],"names":["define","require","exports","module","Ajax","Vue","UI","laz","BP","cookie","dropload","init","dom","pdPos","pType","component","props","items","type","Array","default","template","cVue","el","data","categoryId","cateId","moreData","num","nav_type","sort_type","sort_criteria","no_result","scrollTop","self","$","scrollArea","window","domDown","domClass","domRefresh","wapcsspath","domUpdate","domLoad","loadDownFn","me","str","query","url","success","setTimeout","resetload","code","length","alertSecond","concat","lazyload","message","methods","click_nav","click_close_filter","click_sort","sort","getItem","click_filter","id","target","currentTarget","addClass","siblings","removeClass","e","i","len","item","ext","imgbed","mainImage","name","sellingPrice","alternative","Math","round","amount","originPrice","discountPercentage","expectedCashBack","source","buy","outerUrl","trim","hide","html","$watch","newVal","unlock","lock","search","test","third","getCookie","userId","encodeURIComponent","size","res","match","isArray"],"mappings":"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","file":"../../../js_es6/conf/goods/catedetail.js","sourcesContent":["/**\n * 商品分类\n * @author huangyihai\n * @date 20170227\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/goods/catedetail.js\">\n </script>\n */\n\ndefine('conf/goods/catedetail.js', function (require, exports, module) {\n    require(\"$\");\n    let Ajax = require(\"utils/async/ajax\"),\n        Vue = require(\"vue\"),\n        UI = require('UI/dialog/alert.js'),\n        laz = require('utils/async/lazyload.js'),\n        BP =  require('mods/buried_point.js'),\n        cookie = require('mods/storage/cookie.js');\n    require('mods/filters/com');\n    require('vendors/dropload.js');\n    let dropload;\n    BP.init({\n        dom:\"#goodList\",\n        pdPos:\"\",\n        pType:\"1\"\n    });//商品list曝光\n    Vue.component(\"listmore\", {\n        props: {\n            items: {\n                type: Array,\n                default: function() {\n                    return []\n                }\n            }\n        },\n        template: \"#details\"\n    });\n    const cVue = new Vue({\n        el: \"#c_result\",\n        data: {\n            categoryId:cateId?cateId:'',\n            moreData: [],\n            num:2,\n            nav_type: 0,\n            sort_type: \"\",\n            sort_criteria:0,\n            no_result: 0,  //0  有结果 1 筛选无结果\n            scrollTop: 0\n        },\n        init: function() {\n            let self = this;\n\n            dropload = $(\"#goodList\").dropload({\n                scrollArea: window,\n                domDown: {\n                    domClass: 'dropload-down',\n                    domRefresh: '<div class=\"dropload-refresh\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                    domUpdate: '<div class=\"dropload-update\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                    domLoad: '<div class=\"dropload-load\"><img src=\"'+wapcsspath+'/images/common/loading.gif\" alt=\"\"/></div>'\n                },\n                loadDownFn: function(me) {\n                    let str = \"\";\n                    if (self.sort_type !== \"\") {\n                        str += \"&sort=\" + self.sort_type;\n                    }\n                    /*&sortCriteria=\" + self.sort_criteria + str+\"*/\n                    Ajax.query({\n                        url: \"/api/ext/item/searchItems?categoryId=\"+self.categoryId+\"&pageNum=\"+(self.num++)+\"&pageSize=10\",\n                        success: function(data) {\n                            setTimeout(function() {\n                                me.resetload();\n                            }, 300);\n                            if (data.code === 200) {\n                                if (!data.data.items.length) {\n                                    UI.alertSecond(\"Data is loaded\");\n                                    return;\n                                }\n                                self.moreData = self.moreData.concat(data.data.items);\n                                laz.lazyload();\n                            } else {\n                                UI.alertSecond(data.message);\n                            }\n                        }\n                    });\n                }\n            });\n        },\n        methods:{\n            click_nav: function (type) {\n                if(this.nav_type === type){\n                    this.click_close_filter();\n                    return ;\n                }\n                this.nav_type = type;\n                this.scrollTop = $('body').scrollTop();\n            },\n            click_sort: function (sort,type) {\n                if(type!==\"\"){\n                    if(this.sort_criteria === sort && this.sort_type === type){\n                        this.click_close_filter();\n                        return ;\n                    }\n                }else{\n                    if(this.sort_criteria === sort){\n                        this.click_close_filter();\n                        return ;\n                    }\n                }\n                this.sort_type = type;\n                this.sort_criteria = sort;\n                this.getItem();\n                this.click_close_filter();\n            },\n            click_filter: function (id, target) {\n                let dom = $(target.currentTarget);\n                dom.addClass(\"active\").siblings().removeClass(\"active\");\n                this.getItem();\n                this.click_close_filter();\n            },\n            getItem: function (e) {\n                let str = \"\",\n                    self = this;\n                if (self.sort_type !== \"\") {\n                    str += \"&sort=\" + self.sort_type;\n                }\n                Ajax.query({\n                    url: \"/api/ext/item/searchItems?categoryId=\" + self.categoryId + \"&pageNum=1&sortCriteria=\" + self.sort_criteria + str+\"&pageSize=10\",\n                    success: function (data) {\n                        if (data.code === 200) {\n                            let str = \"\";\n                            if (data.data && data.data.items && data.data.items.length > 0) {\n                                let items = data.data.items;\n                                for (let i = 0, len = items.length; i < len; i++) {\n                                    var item = items[i].item;\n                                    str += `<li class=\"goods-item\" point-data=\"{ext:'${items[i].ext}',type:'${items[i].type}',id:'${items[i].id}'}\">\n                                       <a href=\"/pro/detail?id=${item.id}&pdtype=6\">\n                                           <span class=\"goods-item-pic\">\n                                                <img gome-src=\"${imgbed(item.mainImage,'180')}\" src=\"${wapcsspath}/images/default_product.png\" alt=\"<%= item.name %>\">\n                                           </span>\n                                           <div class=\"goods-item-cont\">\n                                                <h4 class=\"goods-item-title\">${item.name}</h4>\n                                               <p class=\"goods-item-money\">`;\n                                    if (item.sellingPrice) {\n                                        str += `<strong class=\"current-money\">${item.sellingPrice.alternative}. ${Math.round(item.sellingPrice.amount / 100)}</strong>`\n                                    }\n                                    if (item.originPrice && item.originPrice.amount !== item.sellingPrice.amount) {\n                                        str += `<del class=\"before-money\">${item.originPrice.alternative}. ${Math.round(item.originPrice.amount / 100)}</del>`\n                                    }\n                                    if(item.discountPercentage>0){\n                                        str += `<span class=\"save-money\">${item.discountPercentage}% Off</span></p>`;\n                                    }\n                                    if (item.expectedCashBack.amount > 100) {\n                                        str += `<div class=\"rebate\" v-if=\"item.item.expectedCashBack.amount>100\">\n                                                <em class=\"icon-tag\"></em>\n                                                <p class=\"rebate-para\">Upto ${item.expectedCashBack.alternative}. ${Math.round(item.expectedCashBack.amount / 100)} Cashback</p>\n                                            </div>`\n                                    }\n\n                                    if(item.source.url){\n                                        str += `<div class=\"from\">\n                                                <img gome-src=\"${item.source.url}\" src=\"${wapcsspath}/images/common/default-prolist.png\" alt=\"${item.source.name}\" >\n                                            </div>`\n                                    }\n                                    str += `<a class=\"btn-buy\" href=\"${buy(item.outerUrl,item.name)}\"></a>\n                                            </div>\n                                        </a>\n                                    </li>`.trim();\n                                }\n                            } else {\n                                str = `<div class='null'><img src='${wapcsspath}/images/search/no_result.png' alt=''/><p>Sorry, no results</p><p class='col9'>Please change the filter conditions</p></div>`\n                                $('#s_sort').hide();\n                            }\n                            $('#good-list').html(str);\n                            self.num = 2;\n                            self.moreData = [];\n                            $(\"body\").scrollTop(0);\n                            laz.lazyload();\n                            BP.init({\n                                dom:\"#goodList\",\n                                pdPos:\"\",\n                                pType:\"1\",\n                                num:0//重置\n                            });//商品list曝光\n                        } else {\n                            UI.alertSecond(data.message);\n                        }\n                    }\n                });\n            },\n            click_close_filter: function () {\n                this.nav_type = 0;\n                setTimeout(()=> {\n                    $('body').scrollTop(this.scrollTop);\n                }, 50)\n            }\n        }\n    });\n    cVue.$watch('nav_type', function (newVal) {\n        if (newVal === 0) {\n            $('body,html').removeClass('over');\n            dropload.unlock();\n        } else {\n            $('body,html').addClass('over');\n            dropload.lock();\n        }\n    });\n    function buy(outerUrl,name) {\n        var search = /\\?/.test(outerUrl),\n            third = cookie.getCookie('third_layer');//arr[0] userId  arr[1] cookie\n        if (userId != \"0\") {\n            if (third === \"\") {\n                return \"/pro/third?name=\" + name + \"&loc=\" + encodeURIComponent(outerUrl + (search ? \"&\" : \"?\") + \"affExtParam1=\" + userId);\n            } else {\n                return outerUrl + (search ? \"&\" : \"?\") + \"affExtParam1=\" + userId;\n            }\n        }\n        return \"/login?redirect=\" + encodeURIComponent(\"/pro/third?name=\" + name + \"&loc=\" + outerUrl + (search ? \"&\" : \"?\")) + \"&type=buy\";\n    }\n    function imgbed(url,size){\n        if(typeof url === 'string' && (/\\.(jpg|png|gif)$/i).test(url)){\n            var res = url.match(/(.*)(\\.(jpg|png|gif))/);\n            return res && Array.isArray(res) ? (res[0] + (size ? ('.' +  size) : '') + res[2]) : url;\n        }else{\n            return url;\n        }\n    }\n});"]}