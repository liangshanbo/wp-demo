{"version":3,"sources":["conf/invite/setPassword.js"],"names":["define","require","exports","module","ajax","Vue","storage","check","UI","el","data","password","init","phone","getParams","location","search","$","val","substr","methods","hideTS","dom","$this","currentTarget","attr","showTS","isNext","replace","length","_nextHigh","nextStep","pwd","params","invitationCode","stoken","obj","source","ga","Date","getItem","removeItem","hasClass","alertSecond","accessToken","type","refereeUserId","post","url","success","code","assign","message","error","goback","href","removeClass","addClass","decodeURI","test","arr","split","i","l","res"],"mappings":"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","file":"../../../js_es6/conf/invite/setPassword.js","sourcesContent":["/**\n * 邀请好友 设置密码\n * @author wangming\n * @date 20170315\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/invite/setPassword.js\">\n </script>\n */\n\ndefine('conf/invite/setPassword.js', function (require, exports, module) {\n\trequire(\"$\")\n    const ajax = require(\"utils/async/ajax\"),\n        Vue = require(\"vue\"),\n        storage = require('mods/storage/storage.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js');\n\n    new Vue({\n    \tel: \"body\",\n    \tdata: {\n    \t\tpassword: false\n    \t},\n    \tinit: function(){\n    \t\tlet phone = getParams(location.search).phone;\n    \t\tif(phone) {\n                $(\"#username\").val(phone.substr(0,3) + \"****\" + phone.substr(7));\n            }\n    \t},\n    \tmethods: {\n    \t\thideTS: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget);\n    \t\t\t$this.attr(\"placeholder\", \"\");\n    \t\t},\n    \t\tshowTS: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget);\n    \t\t\t$this.attr(\"placeholder\", \"New  Password\");\n    \t\t},\n    \t\tisNext: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget),\n    \t\t\t\tval = $this.val();\n    \t\t\t$this.val(val.replace(/[<> \\&]/g,\"\"));\n    \t\t\tif(val.length >= 6) {\n    \t\t\t\tthis.password = true;\n    \t\t\t} else {\n    \t\t\t\tthis.password = false;\n    \t\t\t}\n    \t\t\tthis._nextHigh();\n    \t\t},\n            nextStep: function(dom) {\n            \tconst pwd = $(\"#password\").val(),\n                    params = getParams(location.search),\n            \t\tphone = params.phone,\n            \t\tinvitationCode = params.invitationCode,\n            \t\t$this = $(dom.currentTarget);\n            \tlet stoken, obj = {}, source = params.source;\n                 //埋点\n                ga('send', 'event', 'login/sign', 'invite_sign_finish_btn_click');\n            \tif(new Date() * 1 - storage.getItem('invitetime') <= 600000){\n\t\t            stoken = storage.getItem('invitesst');\n\t\t        }else{\n\t\t            storage.removeItem(\"invitesst\");\n\t\t            storage.removeItem(\"invitetime\");\n        \t\t}\n            \tif($this.hasClass(\"disabled\")) {\n                    return;\n                }\n                if(!check.password(pwd)){\n\t\t            UI.alertSecond('Please enter a password with 6 to 20 digits, including letters, digitals or symbols.');\n\t\t            return;\n\t\t        }\n                if(source) {\n                    if(source == \"FB\") {\n                        source = \"FACEBOOK\";\n                    } else {\n                        source = \"SMS\";\n                    }\n                }\n\t\t        obj = {\n\t\t        \tpassword: pwd,\n\t\t        \taccessToken: stoken,\n                    type: source\n\t\t        };\n                if(invitationCode != \"undefined\") {\n                    obj.refereeUserId = invitationCode;\n                }\n\t\t        ajax.post({\n                    url: '/api/user/register',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code;\n                        if (code === 200) {\n                            UI.alertSecond(\"SIGN UP success\",function(){\n\t\t                        storage.removeItem(\"rst\"+phone);\n\t\t                        storage.removeItem(\"rsttime\");\n\t\t                        location.assign('/');\n\t\t                    },500);\n                        } else {\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })\n            },\n            goback: function() {\n            \tlet params = getParams(location.search),\n                    phone = params.phone,\n                    invitationCode = params.invitationCode,\n                    source = params.source;\n            \tlocation.href = \"/invite/regist?phone=\" + phone + \"&invitationCode=\" + invitationCode + \"&source=\" + source;\n            },\n            _nextHigh: function() {\n                if(this.password) {\n                    $('#register').removeClass(\"disabled\");\n                } else {\n                    $('#register').addClass(\"disabled\");\n                }\n            }\n    \t}\n    });\n\n    function getParams(url) {\n\t\tlet obj = {};\n        url = url || location.search;\n        url = decodeURI(url);\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        let arr = url.split(\"&\");\n        for (let i = 0, l = arr.length; i < l; i++) {\n            let res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n\t}\n});"]}