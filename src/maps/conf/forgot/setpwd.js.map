{"version":3,"sources":["conf/forgot/setpwd.js"],"names":["define","require","exports","module","check","UI","ajax","storage","pwd","$","pwd1","confirm","isHigh","init","bindEvents","document","getElementById","addEventListener","event","val","replace","length","setTimeout","confirmHigh","on","password","alertSecond","pwdVal","pwdVal1","children","hasClass","confirmSetpwd","removeClass","addClass","stoken","Date","getItem","removeItem","obj","smsToken","confirmedPassword","put","url","data","success","code","phone","location","assign","message","error"],"mappings":"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","file":"../../../js_es6/conf/forgot/setpwd.js","sourcesContent":["/**\n * 忘记密码设置密码脚本\n * @author 黄奕海\n * @date 20170220\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/forgot/setpwd.js\">\n </script>\n */\ndefine('conf/forgot/setpwd.js', function (require, exports, module) {\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        storage = require('mods/storage/storage');\n    require('$');\n    let pwd = $('#password'),\n        pwd1 = $('#password1'),\n        confirm = $('#confirm'),\n        isHigh = {pwd: false, pwd1: false};\n    init();\n    function init() {\n        bindEvents();\n    }\n\n    function bindEvents() {\n        document.getElementById('password').addEventListener('input', function(event) {\n            let val = pwd.val();\n            pwd.val(val.replace(/[<> \\&]/g,\"\"));\n            isHigh.pwd = val.length >= 6 ? true : false;\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    pwd.val(\"\")\n                },50)\n            }\n            confirmHigh();\n        }, false);\n        document.getElementById('password1').addEventListener('input', function(event) {\n            let val = pwd1.val();\n            pwd1.val(val.replace(/[<> \\&]/g,\"\"));\n            isHigh.pwd1 = val.length >= 6 ? true : false;\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    pwd1.val(\"\")\n                },50)\n            }\n            confirmHigh();\n        }, false);\n        pwd.on('blur', function () {\n            let val = pwd.val();\n            if (!check.password(val)) {\n                UI.alertSecond('Please enter a password with 6 to 20 digits, including letters, digitals or symbols.');\n            }\n        });\n        pwd1.on('blur', function () {\n            let val = pwd1.val();\n            if (!check.password(val)) {\n                UI.alertSecond('Please enter a password with 6 to 20 digits, including letters, digitals or symbols.');\n            }\n        });\n        confirm.on('click', function () {\n            let pwdVal = pwd.val(),\n                pwdVal1 = pwd1.val();\n            if (confirm.children('a').hasClass('disabled')) {\n                return;\n            }\n            if (pwdVal !== pwdVal1) {\n                UI.alertSecond('Password two input is not consistent, please re-ente');\n                return;\n            }\n            confirmSetpwd();\n        })\n    }\n\n    //confirm按钮高亮\n    function confirmHigh() {\n        if (isHigh.pwd && isHigh.pwd1) {\n            confirm.children('a').removeClass('disabled');\n        } else {\n            confirm.children('a').addClass('disabled');\n        }\n    }\n\n    //重置密码提交\n    function confirmSetpwd() {\n        let stoken;\n        if(new Date() * 1 - storage.getItem('ssttime') <= 600000){\n            stoken = storage.getItem('sst');\n        }else{\n            storage.removeItem(\"sst\");\n            storage.removeItem(\"ssttime\");\n        }\n        let obj = {\n            smsToken: stoken,\n            password: pwd.val(),\n            confirmedPassword: pwd1.val()\n        };\n        ajax.put({\n            url: '/api/user/password',\n            data: obj,\n            success:function(data){\n                if(data.code === 200){\n                    UI.alertSecond('Changed successfully',function(){\n                        let phone = storage.getItem('fphone');\n                        storage.removeItem('sst');\n                        storage.removeItem('ssttime');\n                        location.assign(\"/login?phone=\"+phone);\n                    },500)\n                }else{\n                    UI.alertSecond(data.message);\n                }\n            },\n            error:function(){\n\n            }\n        })\n    }\n});\n"]}