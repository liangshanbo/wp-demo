{"version":3,"sources":["conf/forgot/index.js"],"names":["define","require","exports","module","check","UI","ajax","sendVerification","storage","phone","$","send","verification","next","isHigh","stoken","area","areaPhone","content","cancel","init","bindEvents","document","getElementById","addEventListener","event","val","length","html","addClass","removeClass","setTimeout","nextHigh","on","obj","split","hasClass","checkPhone","dom","params","callback","token","setItem","Date","getItem","removeItem","mobile","smsCode","smsToken","countryCode","children","checkVerification","show","hide","country","attr","find","put","url","data","success","code","location","assign","alertSecond","message","error"],"mappings":"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","file":"../../../js_es6/conf/forgot/index.js","sourcesContent":["/**\n * 忘记密码脚本\n * @author 黄奕海\n * @date 20170220\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/forgot/index.js\">\n </script>\n */\ndefine('conf/forgot/index.js',function(require,exports,module) {\n    const check=require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage');\n    require('$');\n    require('mods/country_area.js');\n    let phone = $('#username'),\n        send = $('#send'),\n        verification = $('#verification'),\n        next = $('#next'),\n        isHigh = {phone:false,verification:false},\n        stoken;\n    let area = {\n        areaPhone:$('#forgot_area'),\n        area:$('#area'),\n        content:$('#content'),\n        cancel:$('#area_cancel')\n    };\n    init();\n    function init(){\n        bindEvents();\n    }\n    function bindEvents(){\n        document.getElementById('username').addEventListener('input', function(event) {\n            let val = phone.val();\n            if(val.length >= 7){\n                if(send.html() == \"SEND\"){\n                    send.addClass('verification-active');\n                }\n                isHigh.phone = true;\n            }else{\n                isHigh.phone = false;\n                send.removeClass('verification-active');\n            }\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    phone.val(\"\")\n                },50)\n            }\n            nextHigh();\n        }, false);\n        document.getElementById('verification').addEventListener('input', function(event) {\n            let val = verification.val();\n            if(val.length>=6){\n                isHigh.verification = true;\n            }else{\n                isHigh.verification = false;\n            }\n            if(val === \"\"){//苹果手机删除问题\n                setTimeout(function(){\n                    verification.val(\"\")\n                },50)\n            }\n            nextHigh();\n        }, false);\n        send.on('click', function () {\n            const obj = {\n                \"mobile\" : phone.val(),\n                \"type\" : \"FINDPWD\",\n                \"countryCode\": \"+\"+area.areaPhone.html().split('+')[1]\n            };\n            if (!send.hasClass('verification-active')) {\n                return;\n            }\n            /*if(!check.isMobile(phone.val())){\n                UI.alertSecond('Phone number format error');\n                return;\n            }*/\n            send.removeClass('verification-active');\n            sendVerification.checkPhone({\n                dom:send,\n                params:obj,\n                callback:function(token){\n                    stoken = token;\n                    storage.setItem(\"fst\"+phone.val(),token);//forgot stoken\n                    storage.setItem(\"fsttime\",new Date()*1);//forgot time\n                }\n            });\n        });\n        next.on('click',function(){\n            if(new Date() * 1 - storage.getItem('fsttime') <= 600000 && storage.getItem('fst'+phone.val())){\n                stoken = storage.getItem(\"fst\"+phone.val());\n            }else{\n                storage.removeItem(\"fst\"+phone.val());\n                storage.removeItem(\"fsttime\");\n            }\n            var mobile = phone.val();\n            const obj = {\n                smsCode : verification.val(),\n                smsToken : stoken,\n                mobile : mobile,\n                countryCode: \"+\"+area.areaPhone.html().split('+')[1]\n            };\n            if(next.children('a').hasClass('disabled')){\n                return ;\n            }\n          /*  if (!check.isMobile(mobile)) {\n                UI.alertSecond('Phone number format error');\n                return;\n            }*/\n            checkVerification(obj);\n        })\n        /*区域手机号*/\n        area.areaPhone.on('click',function(){\n            area.area.show();\n            area.content.hide();\n        });\n        area.area.on('click','dd',function(){\n            let country = $(this).attr('countryCode'),\n                countryCode = $(this).attr('code');\n            area.areaPhone.html(countryCode+\" \"+country);\n            area.area.hide();\n            area.content.show();\n            $('#country').find('dt').removeClass('fixed');\n        });\n        area.cancel.on('click',function(){\n            area.area.hide();\n            area.content.show();\n        })\n    }\n    //下一步按钮高亮\n    function nextHigh(){\n        if(isHigh.phone && isHigh.verification){\n            next.children('a').removeClass('disabled');\n        }else{\n            next.children('a').addClass('disabled');\n        }\n    }\n    //校验手机验证码是否正确\n    function checkVerification(obj){\n        ajax.put({\n            url:'/api/user/sms',\n            data:obj,\n            success:function(data){\n                if(data.code === 200){\n                    storage.setItem('fphone',phone.val());\n                    storage.setItem('sst',data.data.smsToken); //setpwd token;\n                    storage.setItem('ssttime',new Date() * 1); //setpwd time;\n                    storage.setItem(\"area\",area.areaPhone.html());\n                    location.assign('/forgot/setpwd');\n                }else{\n                    UI.alertSecond(data.message);\n                }\n            },\n            error:function(){\n\n            }\n        })\n    }\n});\n"]}