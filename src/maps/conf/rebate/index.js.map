{"version":3,"sources":["conf/rebate/index.js"],"names":["define","require","exports","module","$","ajax","UI","Vue","laz","$orderList","$noOrders","pageSize","init","addListeners","setFilters","component","props","orders","type","Array","template","vm","el","data","currentPageNum","orderListData","currentStatus","reqDisabled","dropload","scrollArea","window","domDown","domClass","domRefresh","wapcsspath","domUpdate","domLoad","loadDownFn","me","alertSecond","resetload","query","url","success","res","code","length","concat","lazyload","message","methods","filterOrders","evt","$this","target","undefined","refreshCurrentTab","children","remove","addClass","removeClass","filter","time","separator","date","Date","year","getFullYear","month","getMonth","day","getDate","dateStr","string","amount","toFixed","$body","$helpButton","$helpArea","$closeHelpButton","find","click","css"],"mappings":"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","file":"../../../js_es6/conf/rebate/index.js","sourcesContent":["/**\n * 返利订单列表\n * @author 张恩铭\n * @date 20170301\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/rebate/index.js\">\n </script>\n */\ndefine('conf/rebate/index.js', function(require, exports, module) {\n    const $ = require('$');\n    const ajax = require('utils/async/ajax.js');\n    const UI = require('UI/dialog/alert');\n    const Vue = require('vue');\n    require('mods/filters/com');\n    // 这个插件的文档 https://github.com/ximan/dropload\n    require('vendors/dropload.js');\n    const laz = require('utils/async/lazyload.js');\n\n    let $orderList = $('.orders');\n    let $noOrders = $('.no-orders');\n    let pageSize = 10;\n\n    init();\n\n    function init() {\n        addListeners();\n        setFilters();\n        Vue.component('order-list-more', {\n            props: {\n                orders: {\n                    type: Array,\n                },\n            },\n            template: '#order-list-more-template',\n        });\n        let vm = new Vue({\n            el: 'body',\n            data: {\n                currentPageNum: 1,\n                orderListData: [],\n                currentStatus: 'ALL',\n                pageSize,\n                reqDisabled: false,\n            },\n            init() {\n                $orderList.dropload({\n                    scrollArea: window,\n                    //domUp: {\n                    //domClass: 'dropload-up',\n                    //domRefresh: '<div class=\"dropload-refresh\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                    //domUpdate: '<div class=\"dropload-update\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                    //domLoad: '<div class=\"dropload-load\"><img src=\"'+wapcsspath+'/images/common/loading.gif\" alt=\"\"/></div>'\n                    //},\n                    domDown: {\n                        domClass: 'dropload-down',\n                        domRefresh: '<div class=\"dropload-refresh\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                        domUpdate: '<div class=\"dropload-update\"><img src=\"'+wapcsspath+'/images/common/loading.png\" alt=\"\"/></div>',\n                        domLoad: '<div class=\"dropload-load\"><img src=\"'+wapcsspath+'/images/common/loading.gif\" alt=\"\"/></div>'\n                    },\n                    // loadUpFn(me) {\n                    //     refreshCurrentTab(me);\n                    // },\n                    loadDownFn(me) {\n                        if (vm.reqDisabled) {\n                            UI.alertSecond('No More Orders');\n                            me.resetload();\n                        } else {\n                            ajax.query({\n                                url: `/api/ext/trade/orders?status=${vm.currentStatus}&pageNum=${++vm.currentPageNum}&pageSize=${vm.pageSize}`,\n                                success(res) {\n                                    if (res.code === 200) {\n                                        if (res.data.orders.length > 0) {\n                                            vm.orderListData = vm.orderListData.concat(res.data.orders);\n                                            laz.lazyload();\n                                        } else {\n                                            UI.alertSecond('No More Orders');\n                                            vm.reqDisabled = true;\n                                        }\n                                    } else {\n                                        UI.alertSecond(res.message);\n                                    }\n                                    me.resetload();\n                                },\n                            });\n                        }\n                    },\n                });\n            },\n            methods: {\n                filterOrders(evt) {\n                    let $this = $(evt.target);\n                    let type = $this.data('anchor');\n                    if (type !== undefined) {\n                        this.currentStatus = type;\n                        refreshCurrentTab();\n                    }\n                },\n            },\n        });\n\n        /*\n        刷新当前页面的数据，提供参数时重置 dropload\n        */\n        function refreshCurrentTab(me) {\n            vm.reqDisabled = false;\n            $orderList.children('[data-first-screen]').remove();\n            vm.orderListData = [];\n            vm.currentPageNum = 0;\n            ajax.query({\n                url: `/api/ext/trade/orders?status=${vm.currentStatus}&pageNum=${++vm.currentPageNum}&pageSize=${vm.pageSize}`,\n                success(res) {\n                    if (res.code === 200) {\n                        if (res.data.orders.length > 0) {\n                            $noOrders.addClass('hide');\n                            vm.orderListData = res.data.orders;\n                            laz.lazyload();\n                        } else {\n                            $noOrders.removeClass('hide');\n                        }\n                    } else {\n                        UI.alertSecond(res.message);\n                    }\n                    // 插件文档规定每次数据加载完必须通过 resetload 重置\n                    me !== undefined && me.resetload();\n                },\n            });\n        }\n    }\n\n    function setFilters() {\n        Vue.filter('time', function(time, separator) {\n            var date = new Date(time);\n            var year = date.getFullYear();\n        \tvar month = (date.getMonth() + 1) > 9 ? (date.getMonth() + 1) : '0' + (date.getMonth() + 1);\n        \tvar day = date.getDate() > 9 ? date.getDate() : '0' + date.getDate();\n        \tvar dateStr = '';\n        \tif (separator) {\n        \t\tdateStr += day + separator + month + separator + year;\n        \t} else {\n        \t\tdateStr += day + '/' + month + '/' + year;\n        \t}\n        \treturn dateStr;\n        });\n        Vue.filter('addFullStop', function(string) {\n            return string += '. ';\n        });\n        Vue.filter('to2DigitFloat', function(amount) {\n            return (amount / 100).toFixed(2);\n        });\n    }\n\n    function addListeners() {\n        let $body = $('body');\n        let $helpButton = $('.help-btn');\n        let $helpArea = $('.mask');\n        let $closeHelpButton = $helpArea.find('.close-btn');\n        $helpButton.click(function() {\n            $helpArea.css('display', 'block');\n            $body.css('overflow-y', 'hidden');\n        });\n        $closeHelpButton.click(function() {\n            $helpArea.css('display', 'none');\n            $body.css('overflow-y', 'auto');\n        });\n    }\n\n});\n"]}