{"version":3,"sources":["conf/mall/super.js"],"names":["define","require","exports","module","$","ajax","Vue","UI","laz","dropload","supList","supMore","CateName","component","props","items","type","Array","default","template","filter","buy","sVue","el","data","num","cateId","listData","isMore","scTop","init","self","scrollArea","window","domDown","domClass","domRefresh","wapcsspath","domUpdate","domLoad","loadDownFn","me","query","url","success","setTimeout","resetload","code","length","alertSecond","concat","lazyload","message","lock","methods","click_more_cate","hasClass","scrollTop","close_layer","hide","addClass","removeClass","show","click_render_cate","obj","parseInt","id","html","name","str","i","len","item","imgbed","mainImage","sellingPrice","alternative","Math","round","amount","originPrice","discountPercentage","expectedCashBack","source","outerUrl","trim","search","test","userId","encodeURIComponent","size","res","match","isArray"],"mappings":"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","file":"../../../js_es6/conf/mall/super.js","sourcesContent":["/**\r\n * mall列表 超级返利\r\n * @author huangyihai\r\n * @date 20170216\r\n * 页面引用 入口在首页\r\n *  <script src=\"__PUBLIC__/js/lithe.js\"\r\n data-config=\"config.js\"\r\n data-debug=\"true\"\r\n data-main=\"conf/mall/super.js\">\r\n </script>\r\n */\r\ndefine('conf/mall/super.js', function (require, exports, module) {\r\n    const $ = require('$'),\r\n        ajax = require('utils/async/ajax.js'),\r\n        Vue = require(\"vue\"),\r\n        UI = require('UI/dialog/alert.js'),\r\n        laz = require('utils/async/lazyload.js');\r\n    let dropload,\r\n        supList = $('#supList'),\r\n        supMore = $('#s_more'),\r\n        CateName = $('#CateName');\r\n    require('mods/filters/com');\r\n    require('vendors/dropload.js');\r\n    Vue.component(\"listmore\", {\r\n        props: {\r\n            items: {\r\n                type: Array,\r\n                default: function () {\r\n                    return []\r\n                }\r\n            }\r\n        },\r\n        template: \"#suptemp\"\r\n    });\r\n    Vue.filter('buy', buy);\r\n    const sVue = new Vue({\r\n        el:\"#s_result\",\r\n        data:{\r\n            num:2,\r\n            cateId: cateId,\r\n            listData:[],\r\n            isMore:0,//0 不显示 1显示\r\n            scTop:0\r\n        },\r\n        init: function () {\r\n            let self = this;\r\n            dropload = $(\"#supList\").dropload({\r\n                scrollArea: window,\r\n                domDown: {\r\n                    domClass: 'dropload-down',\r\n                    domRefresh: '<div class=\"dropload-refresh\"><img src=\"' + wapcsspath + '/images/common/loading.png\" alt=\"\"/></div>',\r\n                    domUpdate: '<div class=\"dropload-update\"><img src=\"' + wapcsspath + '/images/common/loading.png\" alt=\"\"/></div>',\r\n                    domLoad: '<div class=\"dropload-load\"><img src=\"' + wapcsspath + '/images/common/loading.gif\" alt=\"\"/></div>'\r\n                },\r\n                loadDownFn: function (me) {\r\n                    ajax.query({\r\n                        url: `/api/ext/item/cashbackItems?pageSize=10&pageNum=${self.num}&categoryId=${self.cateId}`,\r\n                        success: function (data) {\r\n                            setTimeout(function () {\r\n                                me.resetload();\r\n                            }, 300);\r\n                            if (data.code === 200) {\r\n                                if (!data.data.items.length) {\r\n                                    UI.alertSecond(\"Data is loaded\");\r\n                                    return;\r\n                                }\r\n                                self.listData = self.listData.concat(data.data.items);\r\n                                laz.lazyload();\r\n                            } else {\r\n                                UI.alertSecond(data.message);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            if ($('#null').length > 0) {\r\n                dropload.lock();\r\n            }\r\n        },\r\n        methods:{\r\n            click_more_cate:function(){\r\n                if(!supMore.hasClass('active')){\r\n                    this.scTop = $('body').scrollTop();\r\n                    this.close_layer(\"1\");\r\n                }else{\r\n                    this.close_layer(\"\");\r\n                    setTimeout(()=>{\r\n                        $('body').scrollTop(this.scTop);\r\n                    },50)\r\n                }\r\n            },\r\n            close_layer:function(type){\r\n                if(type!==\"\"){\r\n                    supList.hide();\r\n                    this.isMore=1;\r\n                    supMore.addClass(\"active\");\r\n                    return ;\r\n                }\r\n                this.isMore=0;\r\n                supMore.removeClass(\"active\");\r\n                supList.show();\r\n                $('body').scrollTop(0);\r\n            },\r\n            click_render_cate:function(obj){\r\n                var self = this;\r\n                self.cateId = parseInt(obj.id);\r\n                CateName.html(obj.name);\r\n                setTimeout(()=>{\r\n                    this.close_layer(\"\");\r\n                },50);\r\n                ajax.query({\r\n                    url: `/api/ext/item/cashbackItems?pageSize=10&pageNum=1&categoryId=${self.cateId}`,\r\n                    success: function (data) {\r\n                        if (data.code === 200) {\r\n                            let str = \"\";\r\n                            if (data.data && data.data.items && data.data.items.length > 0) {\r\n                                let items = data.data.items;\r\n                                for (let i = 0, len = items.length; i < len; i++) {\r\n                                    var item = items[i].item;\r\n                                    str += `<li class=\"goods-item\">\r\n                                       <a href=\"/pro/detail?id=${item.id}&pdtype=6\">\r\n                                           <span class=\"goods-item-pic\">\r\n                                                <img gome-src=\"${imgbed(item.mainImage,'180')}\" src=\"${wapcsspath}/images/default_product.png\" alt=\"<%= item.name %>\">\r\n                                           </span>\r\n                                           <div class=\"goods-item-cont\">\r\n                                                <h4 class=\"goods-item-title\">${item.name}</h4>\r\n                                               <p class=\"goods-item-money\">`;\r\n                                    if (item.sellingPrice) {\r\n                                        str += `<strong class=\"current-money\">${item.sellingPrice.alternative}. ${Math.round(item.sellingPrice.amount / 100)}</strong>`\r\n                                    }\r\n                                    if (item.originPrice && item.originPrice.amount !== item.sellingPrice.amount) {\r\n                                        str += `<del class=\"before-money\">${item.originPrice.alternative}. ${Math.round(item.originPrice.amount / 100)}</del>`\r\n                                    }\r\n                                    if(item.discountPercentage>0){\r\n                                        str += `<span class=\"save-money\">${item.discountPercentage}% Off</span></p>`;\r\n                                    }\r\n                                    if (item.expectedCashBack.amount > 100) {\r\n                                        str += `<div class=\"rebate\">\r\n                                                <em class=\"icon-tag\"></em>\r\n                                                <p class=\"rebate-para\">Upto ${item.expectedCashBack.alternative}. ${Math.round(item.expectedCashBack.amount / 100)} Cashback</p>\r\n                                            </div>`\r\n                                    }\r\n                                    if(item.source.url){\r\n                                        str += `<div class=\"from\">\r\n                                                <img gome-src=\"${item.source.url}\" src=\"${wapcsspath}/images/common/default-prolist.png\" alt=\"${item.source.name}\" >\r\n                                            </div>`\r\n                                    }\r\n                                    str += `<a class=\"btn-buy\" href=\"${buy(item.outerUrl)}\"></a>\r\n                                            </div>\r\n                                        </a>\r\n                                    </li>`.trim();\r\n                                }\r\n                            } else {\r\n                                str = `<div class='null'><img src='${wapcsspath}/images/search/no_result.png' alt=''/><p>Sorry, no results</p><p class='col9'>Please change the filter conditions</p></div>`\r\n                                //$('#s_sort').hide();\r\n                            }\r\n                            $('#good-list').html(str);\r\n                            self.num = 2;\r\n                            self.listData = [];\r\n                            $(\"body\").scrollTop(0);\r\n                            laz.lazyload();\r\n                        } else {\r\n                            UI.alertSecond(data.message);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n    function buy(url) {\r\n        let search = /\\?/.test(url);\r\n        if (userId !== \"0\") {\r\n            return url + (search ? \"&\" : \"?\") + \"affExtParam1=\" + userId;\r\n        }\r\n        return \"login?redirect=\" + encodeURIComponent(url) + \"&type=buy\";\r\n    }\r\n    function imgbed(url,size){\r\n        if(typeof url === 'string' && (/\\.(jpg|png|gif)$/i).test(url)){\r\n            var res = url.match(/(.*)(\\.(jpg|png|gif))/);\r\n            return res && Array.isArray(res) ? (res[0] + (size ? ('.' +  size) : '') + res[2]) : url;\r\n        }else{\r\n            return url;\r\n        }\r\n    }\r\n});\r\n"]}