{"version":3,"sources":["mods/buried_point.js"],"names":["define","require","exports","module","$","ajax","cookie","point","SendPoint","defaults","dom","pdPos","pType","num","offset","move","data","options","self","Object","assign","_bindEvents","_touchEnd","length","listTop","parseFloat","position","top","itemHeight","find","eq","height","document","addEventListener","_touchStart","bind","_touchMove","event","touches","clientY","scrollTop","Math","ceil","window","screen","i","item","attr","push","console","log","type","obj"],"mappings":"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","file":"../../js_es6/mods/buried_point.js","sourcesContent":["/*商品列表发送埋点  huangyihai  17/04/01*/\ndefine('mods/buried_point.js', function (require, exports, module) {\n    const $ = require(\"$\"),\n        ajax = require('utils/async/ajax.js'),\n        cookie = require('mods/storage/cookie.js');\n    let point = {};\n    class SendPoint {\n        constructor() {\n            this.defaults = {\n                dom: '#goodsList',\n                pdPos: 0,\n                pType: 0,\n                num:0\n            };\n            this.offset = 0;\n            this.move = 0;\n            this.data = [];\n        }\n\n        init(options) {\n            let self = this;\n            self.defaults = Object.assign(self.defaults, options);\n            self._bindEvents();\n            self._touchEnd();\n        }\n\n        _bindEvents() {\n            let self = this;\n            if(self.defaults.dom.length>0){\n                self.listTop = parseFloat($(self.defaults.dom).position().top);\n                self.itemHeight = $(self.defaults.dom).find('li').eq(0).height();\n            }\n            document.addEventListener('touchstart', self._touchStart.bind(this), false);\n            document.addEventListener('touchmove', self._touchMove.bind(this), false);\n            document.addEventListener('touchend', self._touchEnd.bind(this), false);\n        }\n\n        _touchStart(event) {\n            let self = this;\n            self.offset = event.touches[0].clientY;\n        }\n\n        _touchMove(event) {\n            let self = this;\n            self.move = self.offset - event.touches[0].clientY;\n        }\n\n        _touchEnd() {\n            var self = this;\n            let scrollTop = $('body').scrollTop(),\n                num = Math.ceil((parseFloat(window.screen.height)+scrollTop - self.listTop) / self.itemHeight);\n            if (parseFloat(window.screen.height)+scrollTop - self.listTop > 0 && self.defaults.num < num) {\n                for (let i = self.defaults.num; i < num; i++) {\n                    let item = $(self.defaults.dom).find('li').eq(i).attr('point-data');\n                    if(item){\n                        self.data.push(item);\n                    }\n                }\n                console.log(self.data);\n                /*if(self.data.length>0){\n                    ajax.post({\n                         url:'/api/recom/log',\n                         data:{\n                             data:self.data,\n                             ts:new Date*1,\n                             act:\"display\",\n                             auid:cookie.getCookie('uid'),\n                             agent:window.navigator.userAgent,\n                             pdPos:self._getPos(self.defaults.pdPos),\n                             pType:self._getType(self.defaults.pType)\n                         },\n                         success:function(){\n\n                         }\n                     })\n                }*/\n            }\n            self.defaults.num = num;\n            self.data = [];\n            self.move = 0;\n        }\n\n        _getPos(type) {\n            if (!type) {\n                return \"\";\n            }\n            let obj = {\n                \"0\": \"BaP0001M0004\",//home list\n                \"1\": \"BaP0011M0002\",//分享成功list\n                \"2\": \"BaP0001M0004\"//home手动推荐list\n            };\n            return obj[type];\n        }\n\n        _getType(type) {\n            if (!type) {\n                return \"BaP0001\";\n            }\n            let obj = {\n                \"0\": \"BaP0001\",//home\n                \"1\": \"BaP0003\",//类目结果\n                \"2\": \"BaP0011\",//分享成功条跳转页\n                \"3\": \"BaP0009\",//搜索 list\n                \"4\": \"AcP0009\",//收藏\n                \"5\": \"BaP0005\",//mall 热销\n                \"6\": \"BaP0012\",//mall 超级返利\n                \"7\": \"BaP0006\",//mall 超低折扣\n                \"8\": \"BaP0004\"//mall 白菜价\n            };\n            return obj[type];\n        }\n    }\n    module.exports = new SendPoint();\n});"]}