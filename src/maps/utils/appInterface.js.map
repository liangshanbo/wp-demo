{"version":3,"sources":["utils/appInterface.js"],"names":["define","require","exports","module","AppInterface","url","params","callback","arguments","length","internal","joinurl","do","msg","timeout","call","obj","item","encodeURIComponent","includes","xhr","XMLHttpRequest","open","responseType","onload","status","readyState","res","response","JSON","parse","console","log","send"],"mappings":";;;;;;AAAA;;;;;AAKAA,OAAO,oBAAP,EAA6B,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AAC5DF,YAAQ,qBAAR;;AAD4D,QAGtDG,YAHsD;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAIxD;;;;;;AAJwD,iCAUnDC,GAVmD,EAU9CC,MAV8C,EAUtCC,QAVsC,EAU5B;AACxB,oBAAIC,UAAUC,MAAV,KAAqB,CAAzB,EAA4B;AACxBF,+BAAWD,MAAX;AACAA,6BAAS,EAAT;AACH;AACDD,sBAAMK,SAASC,OAAT,CAAiBN,GAAjB,EAAsBC,MAAtB,CAAN;AACAI,yBAASE,EAAT,CAAYP,GAAZ,EAAiBE,QAAjB;AACH;AAjBuD;AAAA;AAAA,kCAkBlDM,GAlBkD,EAkB7B;AAAA,oBAAhBC,OAAgB,uEAAN,IAAM;;AACvB,qBAAKC,IAAL,CAAU,eAAV,EAA2B;AACvBF,yBAAKA,GADkB;AAEvBC,6BAASA;AAFc,iBAA3B,EAGG,YAAW,CAAE,CAHhB;AAIH;AAvBuD;;AAAA;AAAA;;AA0B5D,QAAIJ,WAAW;AACXC,eADW,mBACHN,GADG,EACEW,GADF,EACO;AACd,gBAAIV,SAAS,kBAAb;AACA,iBAAK,IAAIW,IAAT,IAAiBD,GAAjB,EAAsB;AAClBV,gCAAcW,IAAd,SAAsBC,mBAAmBF,IAAIC,IAAJ,CAAnB,CAAtB;AACH;AACDZ,mBAAO,CAACA,IAAIc,QAAJ,CAAa,GAAb,IAAoB,GAApB,GAA0B,GAA3B,IAAkCb,MAAzC;AACA,mBAAOD,GAAP;AACH,SARU;AASXO,UATW,eASRP,GATQ,EASHE,QATG,EASO;AACd,gBAAIa,MAAM,IAAIC,cAAJ,EAAV;AACAD,gBAAIE,IAAJ,CAAS,KAAT,EAAgBjB,GAAhB,EAAqB,IAArB;AACAe,gBAAIN,OAAJ,GAAc,CAAd;AACAM,gBAAIG,YAAJ,GAAmB,MAAnB;AACAH,gBAAII,MAAJ,GAAa,YAAM;AACf,oBAAIJ,IAAIK,MAAJ,KAAe,GAAf,IAAsBL,IAAIM,UAAJ,KAAmB,CAA7C,EAAgD;AAC5C,wBAAIC,MAAMP,IAAIQ,QAAd;AACAD,0BAAO,OAAOA,GAAP,IAAc,QAAf,GAA2BE,KAAKC,KAAL,CAAWH,GAAX,CAA3B,GAA6CA,GAAnD;AACApB,6BAASoB,GAAT;AACH,iBAJD,MAIO;AACHI,4BAAQC,GAAR,CAAY,iBAAZ;AACH;AACJ,aARD;AASAZ,gBAAIa,IAAJ,CAAS,IAAT;AACH;AAxBU,KAAf;;AA2BA9B,WAAOD,OAAP,GAAiB,IAAIE,YAAJ,EAAjB;AACH,CAtDD","file":"../../js_es6/utils/appInterface.js","sourcesContent":["/**\n * @title: H5与App沟通协议\n * @time:  2017-02-28\n * @author: wangchunpeng\n */\ndefine(\"utils/appInterface\", function(require, exports, module) {\n    require(\"lib/polyfill/string\");\n    \n    class AppInterface {\n        /**\n         * @title: 客户端通信\n         * @param  {[type]}   url      [description] 客户端通信url           [必填]\n         * @param  {[type]}   params   [description] 给客户端传递参数        [选填]\n         * @param  {Function} callback [description] 客户端触发H5的回调函数  [必填]\n         */\n        call(url, params, callback) {\n            if (arguments.length === 2) {\n                callback = params;\n                params = {};\n            }\n            url = internal.joinurl(url, params);\n            internal.do(url, callback);\n        }\n        toast(msg, timeout = 2000) {\n            this.call(\"/common/toast\", {\n                msg: msg,\n                timeout: timeout\n            }, function() {})\n        }\n    }\n\n    let internal = {\n        joinurl(url, obj) {\n            let params = \"_mobile_bridge=1\";\n            for (let item in obj) {\n                params += `&${item}=${encodeURIComponent(obj[item])}`;\n            }\n            url += (url.includes(\"?\") ? \"&\" : \"?\") + params;\n            return url;\n        },\n        do(url, callback) {\n            let xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url, true);\n            xhr.timeout = 0;\n            xhr.responseType = \"json\";\n            xhr.onload = () => {\n                if (xhr.status === 200 && xhr.readyState === 4) {\n                    let res = xhr.response;\n                    res = (typeof res == \"string\") ? JSON.parse(res) : res;\n                    callback(res);\n                } else {\n                    console.log('request is fail');\n                }\n            }\n            xhr.send(null);\n        }\n    }\n\n    module.exports = new AppInterface();\n});\n"]}