{"version":3,"sources":["utils/async/ajax0.js"],"names":["define","require","exports","module","alert","Ajax","options","df","_init","xmlhttp","ops","Object","assign","defaults","open","type","url","responseType","dataType","onload","status","readyState","res","response","alertSecond","message","success","console","log","ontimeout","data","_formatParams","send","params","callback","_request","query","before","after","formdata","FormData","key","append","XMLHttpRequest"],"mappings":";;;;;;;;AAAA;;;;;;AAMAA,OAAO,kBAAP,EAA2B,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmC;AAC7DF,SAAQ,wBAAR;AACA,KAAIG,QAAQH,QAAQ,oBAAR,CAAZ;;AAF6D,KAIvDI,IAJuD;AAK5D,kBAAc;AAAA;AAEb;;AAP2D;AAAA;AAAA,4BAQnDC,OARmD,EAQ1C;AACjB,QAAIC,KAAK,KAAKC,KAAL,EAAT;AAAA,QACCC,UAAUF,GAAGE,OADd;AAAA,QAECC,MAAMC,OAAOC,MAAP,CAAcL,GAAGM,QAAjB,EAA2BP,OAA3B,CAFP;;AAIAG,YAAQK,IAAR,CAAaJ,IAAIK,IAAjB,EAAuBL,IAAIM,GAA3B,EAAgC,IAAhC;AACAP,YAAQQ,YAAR,GAAuBP,IAAIQ,QAA3B;AACA;AACAT,YAAQU,MAAR,GAAiB,YAAM;AACtB,SAAIV,QAAQW,MAAR,KAAmB,GAAnB,IAA0BX,QAAQY,UAAR,KAAuB,CAArD,EAAwD;AACvD,UAAIC,MAAMb,QAAQc,QAAR,IAAoB,EAA9B;AACA,UAAG,QAAOD,GAAP,yCAAOA,GAAP,OAAe,QAAf,IAA2B,UAAUA,GAArC,IAA4CA,IAAI,MAAJ,MAAgB,GAA/D,EAAmE;AAClElB,aAAMoB,WAAN,CAAkBF,IAAIG,OAAtB;AACA;AACDf,UAAIgB,OAAJ,CAAYjB,QAAQc,QAApB;AACA,MAND,MAMO;AACNI,cAAQC,GAAR,CAAY,iBAAZ;AACA;AACD,KAVD;AAWAnB,YAAQoB,SAAR,GAAoB,YAAM;AACzBF,aAAQC,GAAR,CAAY,MAAZ;AACA,KAFD;AAGA,QAAIE,OAAO,KAAKC,aAAL,CAAmBrB,GAAnB,CAAX;AACAD,YAAQuB,IAAR,CAAaF,QAAQ,IAArB;AAEA;AAjC2D;AAAA;AAAA,yBAkCtDd,GAlCsD,EAkCjDiB,MAlCiD,EAkCzCC,QAlCyC,EAkC/B;AAC5B,SAAKC,QAAL,CAAc;AACbnB,UAAKA,GADQ;AAEbc,WAAMG,MAFO;AAGbP,cAASQ;AAHI,KAAd;AAKA;AAxC2D;AAAA;AAAA,wBAyCvDlB,GAzCuD,EAyClDiB,MAzCkD,EAyC1CC,QAzC0C,EAyChC;AAC3B,SAAKE,KAAL,CAAWpB,GAAX,EAAgBiB,MAAhB,EAAwBC,QAAxB;AACA;AA3C2D;AAAA;AAAA,4BA4CnDlB,GA5CmD,EA4C9CiB,MA5C8C,EA4CtCC,QA5CsC,EA4C5BG,MA5C4B,EA4CpBC,KA5CoB,EA4Cb;AAC9C,SAAKF,KAAL,CAAWpB,GAAX,EAAgBiB,MAAhB,EAAwB,UAASH,IAAT,EAAe;AACtCO;AACAH,iBAAYA,SAASJ,IAAT,CAAZ;AACAQ,cAASA,OAAT;AACA,KAJD;AAKA;AAlD2D;AAAA;AAAA,iCAmD9C5B,GAnD8C,EAmDzC;AAClB,QAAI6B,WAAW,IAAIC,QAAJ,EAAf;AACA,SAAK,IAAIC,GAAT,IAAgB/B,IAAIoB,IAApB,EAA0B;AACzBS,cAASG,MAAT,CAAgBD,GAAhB,EAAqB/B,IAAIoB,IAAJ,CAASW,GAAT,CAArB;AACA;AACD,WAAOF,QAAP;AACA;AAzD2D;AAAA;AAAA,2BA0DpD;AACP,WAAO;AACN9B,cAAS,IAAIkC,cAAJ,EADH;AAEN9B,eAAU;AACTE,YAAM,MADG;AAETG,gBAAU,MAFD;AAGTQ,eAAS,mBAAW,CAAE,CAHb;AAITI,YAAM;AAJG;AAFJ,KAAP;AASA;AApE2D;;AAAA;AAAA;;AAuE7D3B,QAAOD,OAAP,GAAiB,IAAIG,IAAJ,EAAjB;AACA,CAxED","file":"../../../js_es6/utils/async/ajax0.js","sourcesContent":["/*\n    name:ajax.js\n    description:ajax请求\n    anthor:luoxiaowei\n    data:2016-11-08\n */\ndefine(\"utils/async/ajax\", function(require, exports, module) {\n\trequire('lib/polyfill/object.js');\n\tlet alert = require('UI/dialog/alert.js');\n\n\tclass Ajax {\n\t\tconstructor() {\n\n\t\t}\n\t\t_request(options) {\n\t\t\tlet df = this._init(),\n\t\t\t\txmlhttp = df.xmlhttp,\n\t\t\t\tops = Object.assign(df.defaults, options);\n\n\t\t\txmlhttp.open(ops.type, ops.url, true);\n\t\t\txmlhttp.responseType = ops.dataType;\n\t\t\t// xmlhttp.timeout = 3000;\n\t\t\txmlhttp.onload = () => {\n\t\t\t\tif (xmlhttp.status === 200 && xmlhttp.readyState === 4) {\n\t\t\t\t\tlet res = xmlhttp.response || {};\n\t\t\t\t\tif(typeof res === 'object' && 'code' in res && res['code'] === 401){\n\t\t\t\t\t\talert.alertSecond(res.message);\n\t\t\t\t\t}\n\t\t\t\t\tops.success(xmlhttp.response);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('request is fail');\n\t\t\t\t}\n\t\t\t}\n\t\t\txmlhttp.ontimeout = () => {\n\t\t\t\tconsole.log('请求超时');\n\t\t\t}\n\t\t\tlet data = this._formatParams(ops);\n\t\t\txmlhttp.send(data || null);\n\n\t\t}\n\t\tquery(url, params, callback) {\n\t\t\tthis._request({\n\t\t\t\turl: url,\n\t\t\t\tdata: params,\n\t\t\t\tsuccess: callback\n\t\t\t});\n\t\t}\n\t\tpost(url, params, callback) {\n\t\t\tthis.query(url, params, callback);\n\t\t}\n\t\tloadmore(url, params, callback, before, after) {\n\t\t\tthis.query(url, params, function(data) {\n\t\t\t\tbefore();\n\t\t\t\tcallback && callback(data);\n\t\t\t\tafter && after();\n\t\t\t});\n\t\t}\n\t\t_formatParams(ops) {\n\t\t\tlet formdata = new FormData();\n\t\t\tfor (let key in ops.data) {\n\t\t\t\tformdata.append(key, ops.data[key]);\n\t\t\t}\n\t\t\treturn formdata;\n\t\t}\n\t\t_init() {\n\t\t\treturn {\n\t\t\t\txmlhttp: new XMLHttpRequest(),\n\t\t\t\tdefaults: {\n\t\t\t\t\ttype: 'post',\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function() {},\n\t\t\t\t\tdata: null\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tmodule.exports = new Ajax();\n})"]}