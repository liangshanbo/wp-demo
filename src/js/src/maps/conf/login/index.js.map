{"version":3,"sources":["conf/login/index.js"],"names":["define","require","exports","module","check","UI","ajax","storage","cookie","log","$","Mobile","password","mobileDel","light","phone","psd","init","removeItem","val","on","show","length","loginHigh","hide","focus","replace","attr","isLogin","obj","mobile","post","url","data","success","code","params","getParams","redirect","decodeURIComponent","type","setCookie","user","id","location","alertSecond","message","error","navigator","onLine","isMobile","trim","removeClass","addClass","search","test","substr","arr","split","i","l","res"],"mappings":";;AAAA;;;;;;;;;;;AAWAA,OAAO,qBAAP,EAA8B,UAAUC,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoC;AAC9D,QAAMC,QAAQH,QAAQ,qBAAR,CAAd;AAAA,QACII,KAAKJ,QAAQ,oBAAR,CADT;AAAA,QAEIK,OAAOL,QAAQ,qBAAR,CAFX;AAAA,QAGIM,UAAUN,QAAQ,sBAAR,CAHd;AAAA,QAIIO,SAASP,QAAQ,qBAAR,CAJb;AAKAA,YAAQ,GAAR;AACAA,YAAQ,sBAAR;AACA,QAAIQ,MAAMC,EAAE,MAAF,CAAV;AACA,QAAIC,SAASD,EAAE,WAAF,CAAb;AACA,QAAIE,WAAWF,EAAE,WAAF,CAAf;AACA,QAAIG,YAAYH,EAAE,kBAAF,CAAhB;;AAEA,QAAMI,QAAQ,EAACC,OAAO,KAAR,EAAeC,KAAK,KAApB,EAAd;AACAC;AACA,aAASA,IAAT,GAAgB;AACZ;AACAV,gBAAQW,UAAR,CAAmB,KAAnB;AACAX,gBAAQW,UAAR,CAAmB,SAAnB;AACAX,gBAAQW,UAAR,CAAmB,KAAnB;AACAX,gBAAQW,UAAR,CAAmB,SAAnB;AACA,YAAIP,OAAOQ,GAAP,OAAiB,EAArB,EAAyB;AACrBL,kBAAMC,KAAN,GAAc,IAAd;AACH;AACDJ,eAAOS,EAAP,CAAU,OAAV,EAAmB,YAAY;AAC3B,gBAAID,MAAMR,OAAOQ,GAAP,EAAV;AACA,gBAAGA,QAAM,EAAT,EAAY;AACRN,0BAAUQ,IAAV;AACH;AACDP,kBAAMC,KAAN,GAAcI,IAAIG,MAAJ,IAAc,CAAd,GAAkB,IAAlB,GAAyB,KAAvC;AACAC;AACH,SAPD;AAQAV,kBAAUO,EAAV,CAAa,OAAb,EAAqB,YAAU;AAC3BT,mBAAOQ,GAAP,CAAW,EAAX;AACAN,sBAAUW,IAAV;AACAb,mBAAOc,KAAP;AACH,SAJD;AAKAb,iBAASQ,EAAT,CAAY,OAAZ,EAAqB,YAAY;AAC7B,gBAAID,MAAMP,SAASO,GAAT,EAAV;AACAP,qBAASO,GAAT,CAAaA,IAAIO,OAAJ,CAAY,UAAZ,EAAuB,EAAvB,CAAb;AACAZ,kBAAME,GAAN,GAAYG,IAAIG,MAAJ,IAAc,CAAd,GAAkB,IAAlB,GAAyB,KAArC;AACAC;AACH,SALD;AAOH;;AAEDd,QAAIW,EAAJ,CAAO,OAAP,EAAgB,YAAY;AACxB,YAAIV,EAAE,MAAF,EAAUiB,IAAV,CAAe,UAAf,KAA8B,MAAlC,EAA0C;AACtC,mBAAO,KAAP;AACA,gBAAI,CAACC,SAAL,EAAgB;AACZ;AACH;AACJ;AACD,YAAIC,MAAM;AACNC,oBAAQnB,OAAOQ,GAAP,EADF;AAENP,sBAAUA,SAASO,GAAT;AAFJ,SAAV;AAIAb,aAAKyB,IAAL,CAAU;AACNC,iBAAK,iBADC;AAENC,kBAAMJ,GAFA;AAGNK,qBAAS,iBAAUD,IAAV,EAAgB;AACrB,oBAAIA,KAAKE,IAAL,KAAc,GAAlB,EAAuB;AACnB,wBAAIC,SAASC,WAAb;AACA;AACA,wBAAGD,UAAUA,OAAOE,QAApB,EAA6B;AACzB,4BAAIA,WAAWC,mBAAmBH,OAAOE,QAA1B,CAAf;AACA,4BAAGF,OAAOI,IAAV,EAAe;AACX,gCAAGJ,OAAOI,IAAP,KAAgB,SAAnB,EAA6B;AACzBhC,uCAAOiC,SAAP,CAAiB,SAAjB,EAA2B,CAA3B,EAA6B,KAAG,KAAG,EAAN,CAA7B;AACH,6BAFD,MAEM,IAAGL,OAAOI,IAAP,KAAgB,KAAnB,EAAyB;AAC3BF,4CAAU,mBAAiBL,KAAKA,IAAL,CAAUS,IAAV,CAAeC,EAA1C;AACH;AACJ;AACDC,iCAASlB,OAAT,CAAiBY,QAAjB;AACH,qBAVD,MAUK;AACDM,iCAASlB,OAAT,CAAiB,GAAjB;AACH;AACJ,iBAhBD,MAgBO,IAAGO,KAAKE,IAAL,KAAc,GAAjB,EAAsB;AACzB9B,uBAAGwC,WAAH,CAAe,qDAAf;AACA,2BAAO,KAAP;AACH,iBAHM,MAGF;AACAxC,uBAAGwC,WAAH,CAAeZ,KAAKa,OAApB;AACA,2BAAO,KAAP;AACJ;AACJ,aA3BK;AA4BNC,mBAAO,eAAUd,IAAV,EAAgB;AACnB5B,mBAAGwC,WAAH,CAAeZ,KAAKa,OAApB;AACA,uBAAO,KAAP;AACH;AA/BK,SAAV;AAiCH,KA5CD;;AA+CA,aAASlB,OAAT,GAAmB;AACf,YAAI,YAAYoB,SAAZ,IAAyB,CAACA,UAAUC,MAAxC,EAAgD;AAC5C5C,eAAGwC,WAAH,CAAe,6CAAf;AACA,mBAAO,KAAP;AACH;AACD;;AAEA,YAAI,CAACzC,MAAM8C,QAAN,CAAevC,OAAOQ,GAAP,GAAagC,IAAb,EAAf,CAAL,EAA0C;AACtC9C,eAAGwC,WAAH,CAAe,qDAAf;AACA,mBAAO,KAAP;AACH;AACD;AACA,YAAI,CAACzC,MAAMQ,QAAN,CAAeA,SAASO,GAAT,GAAegC,IAAf,EAAf,CAAL,EAA4C;AACxC9C,eAAGwC,WAAH,CAAe,qDAAf;AACA,mBAAO,KAAP;AACH;AACD;AACA,eAAO,IAAP;AACH;;AAED,aAAStB,SAAT,GAAqB;AACjB,YAAIT,MAAMC,KAAN,IAAeD,MAAME,GAAzB,EAA8B;AAC1BN,cAAE,MAAF,EAAUiB,IAAV,CAAe,UAAf,EAA2B,KAA3B,EAAkCyB,WAAlC,CAA8C,UAA9C;AACH,SAFD,MAEO;AACH1C,cAAE,MAAF,EAAUiB,IAAV,CAAe,UAAf,EAA2B,IAA3B,EAAiC0B,QAAjC,CAA0C,UAA1C;AAEH;AAEJ;;AAED,aAAShB,SAAT,CAAmBL,GAAnB,EAAwB;AAAE;AACtB,YAAIH,MAAM,EAAV;AACAG,cAAMA,OAAOY,SAASU,MAAtB;AACAtB,cAAM,SAASuB,IAAT,CAAcvB,GAAd,IAAqBA,IAAIwB,MAAJ,CAAW,CAAX,CAArB,GAAqCxB,GAA3C;AACA,YAAIyB,MAAMzB,IAAI0B,KAAJ,CAAU,GAAV,CAAV;AACA,aAAK,IAAIC,IAAI,CAAR,EAAWC,IAAIH,IAAInC,MAAxB,EAAgCqC,IAAIC,CAApC,EAAuCD,GAAvC,EAA4C;AACxC,gBAAIE,MAAMJ,IAAIE,CAAJ,EAAOD,KAAP,CAAa,GAAb,CAAV;AACA7B,gBAAIgC,IAAI,CAAJ,CAAJ,IAAcA,IAAI,CAAJ,CAAd;AACH;AACD,eAAOhC,GAAP;AAEH;AAEJ,CAxID","file":"../../../../conf/login/index.js","sourcesContent":["/**\n * 登录脚本\n * @author guodanying\n * @date 20170216\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/login/index.js\">\n </script>\n */\ndefine('conf/login/index.js', function (require, exports, module) {\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        storage = require('mods/storage/storage'),\n        cookie = require('mods/storage/cookie');\n    require('$');\n    require('/conf/login/fbLog.js');\n    let log = $(\"#log\");\n    let Mobile = $(\"#username\");\n    let password = $(\"#password\");\n    let mobileDel = $('#login-phone-del');\n\n    const light = {phone: false, psd: false};\n    init();\n    function init() {\n        //注册和忘记密码token;\n        storage.removeItem(\"fst\");\n        storage.removeItem(\"fsttime\");\n        storage.removeItem('sst');\n        storage.removeItem('ssttime');\n        if (Mobile.val() !== \"\") {\n            light.phone = true;\n        }\n        Mobile.on('input', function () {\n            let val = Mobile.val();\n            if(val!==\"\"){\n                mobileDel.show();\n            }\n            light.phone = val.length >= 7 ? true : false;\n            loginHigh();\n        });\n        mobileDel.on('click',function(){\n            Mobile.val(\"\");\n            mobileDel.hide();\n            Mobile.focus();\n        });\n        password.on('input', function () {\n            let val = password.val();\n            password.val(val.replace(/[<> \\&]/g,\"\"));\n            light.psd = val.length >= 6 ? true : false;\n            loginHigh();\n        });\n\n    }\n\n    log.on(\"click\", function () {\n        if ($(\"#log\").attr(\"disabled\") == \"true\") {\n            return false;\n            if (!isLogin()) {\n                return;\n            }\n        }\n        let obj = {\n            mobile: Mobile.val(),\n            password: password.val()\n        };\n        ajax.post({\n            url: '/api/user/login',\n            data: obj,\n            success: function (data) {\n                if (data.code === 200) {\n                    let params = getParams();\n                    //type 记录回跳下一个页面。\n                    if(params && params.redirect){\n                        var redirect = decodeURIComponent(params.redirect);\n                        if(params.type){\n                            if(params.type === \"collect\"){\n                                cookie.setCookie(\"collect\",1,1/(24*10));\n                            }else if(params.type === \"buy\"){\n                                redirect+=\"&affExtParam1=\"+data.data.user.id;\n                            }\n                        }\n                        location.replace(redirect);\n                    }else{\n                        location.replace('/');\n                    }\n                } else if(data.code === 422) {\n                    UI.alertSecond(\"User name or password is incorrect, please re-enter\");\n                    return false;\n                }else{\n                     UI.alertSecond(data.message);\n                     return false;\n                }\n            },\n            error: function (data) {\n                UI.alertSecond(data.message);\n                return false;\n            }\n        })\n    })\n\n\n    function isLogin() {\n        if ('onLine' in navigator && !navigator.onLine) {\n            UI.alertSecond('Network connection failed, please try again');\n            return false;\n        }\n        ;\n\n        if (!check.isMobile(Mobile.val().trim())) {\n            UI.alertSecond(\"User name or password is incorrect, please re-enter\");\n            return false;\n        }\n        ;\n        if (!check.password(password.val().trim())) {\n            UI.alertSecond(\"User name or password is incorrect, please re-enter\");\n            return false;\n        }\n        ;\n        return true;\n    }\n\n    function loginHigh() {\n        if (light.phone && light.psd) {\n            $(\"#log\").attr(\"disabled\", false).removeClass(\"disabled\");\n        } else {\n            $(\"#log\").attr(\"disabled\", true).addClass(\"disabled\");\n\n        }\n\n    }\n\n    function getParams(url) { //获取url传递的参数*/\n        var obj = {};\n        url = url || location.search;\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        var arr = url.split(\"&\");\n        for (var i = 0, l = arr.length; i < l; i++) {\n            var res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n        \n    }\n\n});\n"]}