{"version":3,"sources":["conf/login/associated.js"],"names":["define","require","exports","module","check","UI","ajax","sendVerification","storage","phone","$","send","verification","next","isHigh","stoken","bindEvents","on","val","length","text","addClass","removeClass","nextHigh","obj","hasClass","isMobile","alertSecond","checkPhone","token","setItem","Date","getItem","removeItem","mobile","userInfo","console","log","id","name","picture","data","url","fblogSub","children","chilrem","post","success","code","location","replace","message","error"],"mappings":"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","file":"../../../../conf/login/associated.js","sourcesContent":["/**\n * 第三方注册绑定手机号\n * @author lixuefeng\n * @date 20170228\n * 页面引用\n * <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/login/associated.js\">\n </script>\n*/\n\ndefine('conf/login/associated.js', function (require, exports, module) {\n    'use strict';\n    const check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js'),\n        ajax = require('utils/async/ajax.js'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage');\n    require('$');\n    let phone = $('#username'),\n        send = $('#send'),\n        verification = $('#verification'),\n        next = $('#next'),\n        isHigh = { phone: false, verification: false },\n        stoken = void 0;\n    bindEvents();\n    function bindEvents() {\n        phone.on('input', function () {\n            var val = phone.val();\n            if (val.length >= 10 && send.text()=== \"Send\") {\n                isHigh.phone = true;\n                send.addClass('verification-active'); //bgcolor:#FFF\n            } else {\n                isHigh.phone = false;\n                send.removeClass('verification-active');\n            }\n            nextHigh();\n        });\n        verification.on('input', function () {\n            let val = verification.val();\n            if (val.length >= 6) {\n                isHigh.verification = true;\n            } else {\n                isHigh.verification = false;\n            }\n            nextHigh();\n        });\n        send.on('click', function () {\n            const obj = {\n                \"mobile\": phone.val(),\n                \"type\": \"BINDPHONE\"\n            };\n            if (!send.hasClass('verification-active')) {\n                return;\n            };\n            if (!check.isMobile(phone.val())) {\n                UI.alertSecond('Phone number format error');\n                return;\n            };\n            send.removeClass('verification-active');\n            sendVerification.checkPhone(send, obj, 60, function (token) {\n                stoken = token;\n                storage.setItem(\"asc\" + phone.val(), token); \n                storage.setItem(\"asctime\", new Date() * 1); \n            });\n        });\n        next.on('click', function () {\n            if (new Date() * 1 - storage.getItem('asctime') <= 600000 && storage.getItem('asc' + phone.val())) {\n                stoken = storage.getItem(\"asc\" + phone.val());\n            } else {\n                storage.removeItem(\"asc\" + phone.val());\n                storage.removeItem(\"asctime\");\n            }\n            let mobile = phone.val();\n            let userInfo = storage.getItem('ascUserInfo');\n            console.log(userInfo);\n            const obj = {\n                \"mobile\": mobile,\n                \"smsCode\": verification.val(),\n                \"smsToken\": stoken,\n                \"thirdParty\":{\n                    \"type\":\"FACEBOOK\",\n                    \"id\":userInfo.id,\n                    \"name\":userInfo.name,\n                    \"facePicUrl\":userInfo.picture.data.url\n                }\n            };\n            if (!check.isMobile(mobile)) {\n                UI.alertSecond('Phone number format error');\n                return;\n            }\n            fblogSub(obj);\n        });\n    }\n\n    //下一步按钮高亮\n    function nextHigh() {\n        if (isHigh.phone && isHigh.verification) {\n            next.children('a').removeClass('disabled');\n        } else {\n            next.chilrem('a').addClass('disabled');\n        }\n    }\n    //提交注册信息\n    function fblogSub(obj){\n        console.log(obj);\n        ajax.post({\n            url:'/api/user/thirdPartyAccountRegister',\n            data: obj,\n            success: function success(data) {\n                console.log(data);\n                if (data.code === 200) {\n                    UI.alertSecond('Associated success', function () {\n                        location.replace('/');\n                    }, 1000);\n                } else {\n                    UI.alertSecond(data.message);\n                }\n            },\n            error: function error() {}\n        })\n    }\n});"]}