{"version":3,"sources":["conf/register/index.js"],"names":["define","require","exports","module","$","ajax","check","UI","sendVerification","storage","regist","phone","verification","agree","pwd","send","register","stoken","init","bindEvents","on","val","length","html","addClass","removeClass","registerHigh","replace","hasClass","obj","isMobile","alertSecond","checkPhone","token","setItem","Date","children","checkVerification","getItem","removeItem","smsCode","smsToken","mobile","password","post","url","data","success","code","location","assign","message","error"],"mappings":"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","file":"../../../../conf/register/index.js","sourcesContent":["/**\n * 注册脚本\n * @author 黄奕海\n * @date 20170215\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/register/index.js\">\n </script>\n */\ndefine('conf/register/index.js', function (require, exports, module) {\n    const $ = require('$'),\n        ajax = require('utils/async/ajax.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert'),\n        sendVerification = require('mods/send_verification'),\n        storage = require('mods/storage/storage.js');\n    const regist = {phone: false, verification: false, agree: true, pwd: false};\n    let send = $('#send'),\n        phone = $('#username'),\n        verification = $('#verification'),\n        pwd = $('#password'),\n        agree = $('#agree'),\n        register = $('#register'),\n        stoken;\n    init();\n    function init() {\n        bindEvents();\n    }\n\n    function bindEvents() {\n        phone.on('input', function () {\n            let val = phone.val();\n            if(val.length >= 10){\n                regist.phone =  true;\n                if(send.html() == \"Send\"){\n                    send.addClass('verification-active');\n                }\n            }else{\n                regist.phone =  false;\n                send.removeClass('verification-active');\n            }\n            registerHigh();\n        });\n        verification.on('input', function () {\n            let val = verification.val();\n            regist.verification = val.length >= 6 ? true : false;\n            registerHigh();\n        });\n        pwd.on('input', function () {\n            let val = pwd.val();\n            pwd.val(val.replace(/[<> \\&]/g,\"\"));\n            regist.pwd = val.length >= 6 ? true : false;\n            registerHigh();\n        });\n        agree.on('click', function () {\n            if(agree.hasClass('register-agreement-active')){\n                agree.removeClass('register-agreement-active');\n                regist.agree = true;\n            }else{\n                agree.addClass('register-agreement-active');\n                regist.agree = false;\n            }\n            registerHigh();\n        });\n        send.on('click', function () {\n            const obj = {\n                \"mobile\" : phone.val(),\n                \"type\" : \"REGIST\"\n            };\n            if (!send.hasClass('verification-active')) {\n                return;\n            }\n            if(!check.isMobile(phone.val())){\n                UI.alertSecond('Phone number format error');\n                return;\n            }\n            send.removeClass('verification-active');\n            sendVerification.checkPhone(send, obj, 60,function(token){\n                stoken = token;//获取手机验证码token;\n                storage.setItem(\"rst\"+phone.val(),token);//register stoken\n                storage.setItem(\"rsttime\",new Date()*1);//register time\n            });\n        });\n        register.on('click',function(){\n            if(register.children(\"a\").hasClass('disabled')){\n                return ;\n            }\n            checkVerification();\n        })\n    }\n\n    //注册按钮高亮\n    function registerHigh() {\n        if (regist.phone && regist.pwd && regist.verification && regist.agree) {\n            register.children(\"a\").removeClass('disabled');\n        } else {\n            register.children(\"a\").addClass('disabled');\n        }\n    }\n    //验证手机验证码和密码\n    function checkVerification(){\n        if(new Date() * 1 - storage.getItem('rsttime') <= 600000 && storage.getItem('rst'+phone.val())){\n            stoken = storage.getItem('rst'+phone.val());\n        }else{\n            storage.removeItem(\"rst\"+phone.val());\n            storage.removeItem(\"rsttime\");\n        }\n        let obj = {};\n            obj.smsCode = verification.val();\n            obj.smsToken = stoken;\n            obj.mobile = phone.val();\n            obj.password = pwd.val();\n        if(!check.isMobile(obj.mobile)){\n            UI.alertSecond('Phone number format error');\n            return;\n        }\n        if(!check.password(obj.password)){\n            UI.alertSecond('Please enter a password for 6-20 bit letters, numbers, or symbols');\n            return;\n        }\n        ajax.post({\n            url:'/api/user/user',\n            data:obj,\n            success:function(data){\n                if(data.code == 200){\n                    UI.alertSecond(\"login was successful\",function(){\n                        storage.removeItem(\"rst\"+phone.val());\n                        storage.removeItem(\"rsttime\");\n                        location.assign('/');\n                    },500)\n                }else{\n                    verification.val(\"\");\n                    UI.alertSecond(data.message);\n                }\n            },\n            error:function(){\n\n            }\n        });\n    }\n});"]}