{"version":3,"sources":["conf/invite/regist.js"],"names":["define","require","exports","module","$","Vue","ajax","check","UI","storage","el","data","phone","getParams","location","search","verification","agree","stoken","timer","init","val","addClass","methods","hideTS","dom","$this","currentTarget","attr","showTS","type","isNext","send","length","html","removeClass","_nextHigh","isAgree","hasClass","getCode","obj","_this","isMobile","alertSecond","post","url","success","code","token","smsToken","setItem","Date","_countDown","message","error","nextStep","invitationCode","getItem","removeItem","mobile","smsCode","put","href","time","times","setInterval","clearTimer","clearInterval","test","substr","arr","split","i","l","res"],"mappings":"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","file":"../../../../conf/invite/regist.js","sourcesContent":["/**\n * 邀请好友\n * @author wangming\n * @date 20170314\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/invite/regist.js\">\n </script>\n */\ndefine('conf/invite/regist.js', function (require, exports, module) {\n    const $ = require('$'),\n        Vue = require(\"vue\"),\n        ajax = require('utils/async/ajax.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert'),\n        storage = require('mods/storage/storage.js');\n\n    new Vue({\n        el: \"body\",\n        data: {\n            phone: getParams(location.search).phone ? true : false,\n            verification: false,\n            agree: true,\n            stoken: \"\",\n            timer: \"\"\n        },\n        init: function() {\n            let phone = getParams(location.search).phone;\n            if(phone && phone >= 10) {\n                $(\"#username\").val(phone);\n                $(\"#send\").addClass('verification-active');\n            }\n        },\n        methods: {\n            hideTS: function (dom) {\n                let $this = $(dom.currentTarget);\n                $this.attr(\"placeholder\", \"\");\n            },\n            showTS: function (dom, type) { // type: 1、手机号   2、验证码\n                let $this = $(dom.currentTarget);\n                if(type === 1) {\n                    $this.attr(\"placeholder\", \"Mobile No (Only India mobile number)\");\n                } else {\n                    $this.attr(\"placeholder\", \"SMS verification code)\");\n                }\n            },\n            isNext: function(dom, type) {\n                let $this = $(dom.currentTarget),\n                    val = $this.val(),\n                    send = $(\"#send\");\n                if(type === 1) {\n                    if(val.length >= 10) {\n                        this.phone = true;\n                        if(send.html() == \"Send\") {\n                            send.addClass('verification-active');\n                        }\n                    } else {\n                        this.phone =  false;\n                        send.removeClass('verification-active');\n                    }\n                } else {\n                    this.verification = val.length >= 6 ? true : false;\n                }\n                this._nextHigh();\n            },\n            isAgree: function(dom) {\n                let $this = $(dom.currentTarget);\n                if($this.hasClass(\"register-agreement-active\")) {\n                    $this.removeClass(\"register-agreement-active\");\n                    this.agree = true;\n                } else {\n                    $this.addClass(\"register-agreement-active\");\n                    this.agree = false;\n                }\n                this._nextHigh();\n            },\n            getCode: function(dom) {\n                const phone = $(\"#username\").val(),\n                    obj = {\n                        \"mobile\" : phone,\n                        \"type\" : \"REGIST\"\n                    },\n                    $this = $(dom.currentTarget),\n                    _this = this;\n                if (!$this.hasClass('verification-active')) {\n                    return;\n                }\n                if(!check.isMobile(phone)){\n                    UI.alertSecond('Phone number format error');\n                    return;\n                }\n                ajax.post({\n                    url: '/api/user/sms',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code,\n                            token = data.data.smsToken;\n                        if (code === 200) {\n                            $this.removeClass('verification-active');\n                            _this.stoken = token;//获取手机验证码token;\n                            storage.setItem(\"inv\"+phone,token);//register stoken\n                            storage.setItem(\"invtime\",new Date()*1);//register time\n                            _this._countDown($this, 60);\n                        } else {\n                            $this.addClass('verification-active');\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })\n            },\n            nextStep: function(dom) {\n                let $this = $(dom.currentTarget),\n                    phone = $(\"#username\").val(),\n                    verification = $(\"#verification\").val(),\n                    invitationCode = getParams(location.search).invitationCode;\n                if(!$this.hasClass(\"active\")) {\n                    return;\n                }\n                if(!check.isMobile(phone)){\n                    UI.alertSecond('Phone number format error');\n                    return;\n                }\n                if(new Date() * 1 - storage.getItem('invtime') <= 600000 && storage.getItem('inv'+phone)){\n                    this.stoken = storage.getItem('inv'+phone);\n                } else {\n                    storage.removeItem(\"inv\"+phone);\n                    storage.removeItem(\"invtime\");\n                }\n                let obj = {\n                    mobile: phone,\n                    smsCode: verification,\n                    smsToken: this.stoken\n                };\n                ajax.put({\n                    url: '/api/user/sms',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code,\n                            token = data.data.smsToken;\n                        if (code === 200) {\n                            storage.setItem('invitetime', new Date() * 1);\n                            storage.setItem('invitesst', token);\n                            location.href = \"/invite/setPassword?invitationCode=\" + invitationCode + \"&phone=\" + phone;\n                        } else {\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })\n            },\n            _nextHigh: function() {\n                if(this.phone && this.verification &&  this.agree) {\n                    $('#register').addClass(\"active\");\n                } else {\n                    $('#register').removeClass(\"active\");\n                }\n            },\n            _countDown: function(dom, time) {\n                let times = time,\n                    _this = this;\n                dom.html(times);\n                _this.timer = setInterval(function () {\n                    times--;\n                    dom.html(times);\n                    if (times <= 0) {\n                        _this.clearTimer();\n                        dom.html(\"Send\");\n                        dom.addClass('verification-active');\n                        times = time;\n                    }\n                }, 1000)\n            },\n            clearTimer: function(){\n                let _this = this;\n                clearInterval(_this.timer);\n            }\n        }\n    });\n\n    function getParams(url) {\n        let obj = {};\n        url = url || location.search;\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        let arr = url.split(\"&\");\n        for (let i = 0, l = arr.length; i < l; i++) {\n            let res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n    }\n\n});\n"]}