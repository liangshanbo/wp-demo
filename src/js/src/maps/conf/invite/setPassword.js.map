{"version":3,"sources":["conf/invite/setPassword.js"],"names":["define","require","exports","module","ajax","Vue","storage","check","UI","el","data","password","agree","init","phone","getParams","location","search","$","val","substr","methods","hideTS","dom","$this","currentTarget","attr","showTS","isNext","replace","length","_nextHigh","isAgree","hasClass","removeClass","addClass","nextStep","pwd","invitationCode","stoken","obj","Date","getItem","removeItem","alertSecond","accessToken","refereeUserId","post","url","success","code","assign","message","error","goback","params","href","test","arr","split","i","l","res"],"mappings":"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","file":"../../../../conf/invite/setPassword.js","sourcesContent":["/**\n * 邀请好友 设置密码\n * @author wangming\n * @date 20170315\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/invite/setPassword.js\">\n </script>\n */\n\ndefine('conf/invite/setPassword.js', function (require, exports, module) {\n\trequire(\"$\")\n    const ajax = require(\"utils/async/ajax\"),\n        Vue = require(\"vue\"),\n        storage = require('mods/storage/storage.js'),\n        check = require('mods/check/input.js'),\n        UI = require('UI/dialog/alert.js');\n\n    new Vue({\n    \tel: \"body\",\n    \tdata: {\n    \t\tpassword: false,\n    \t\tagree: true\n    \t},\n    \tinit: function(){\n    \t\tlet phone = getParams(location.search).phone;\n    \t\tif(phone) {\n                $(\"#username\").val(phone.substr(0,3) + \"****\" + phone.substr(7,4));\n            }\n    \t},\n    \tmethods: {\n    \t\thideTS: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget);\n    \t\t\t$this.attr(\"placeholder\", \"\");\n    \t\t},\n    \t\tshowTS: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget);\n    \t\t\t$this.attr(\"placeholder\", \"New  Password\");\n    \t\t},\n    \t\tisNext: function(dom) {\n    \t\t\tlet $this = $(dom.currentTarget),\n    \t\t\t\tval = $this.val();\n    \t\t\t$this.val(val.replace(/[<> \\&]/g,\"\"));\n    \t\t\tif(val.length >= 6) {\n    \t\t\t\tthis.password = true;\n    \t\t\t} else {\n    \t\t\t\tthis.password = false;\n    \t\t\t}\n    \t\t\tthis._nextHigh();\n    \t\t},\n            isAgree: function(dom) {\n                let $this = $(dom.currentTarget);\n                if($this.hasClass(\"register-agreement-active\")) {\n                    $this.removeClass(\"register-agreement-active\");\n                    this.agree = true;\n                } else {\n                    $this.addClass(\"register-agreement-active\");\n                    this.agree = false;\n                }\n                this._nextHigh();\n            },\n            nextStep: function(dom) {\n            \tconst pwd = $(\"#password\").val(),\n            \t\tphone = getParams(location.search).phone,\n            \t\tinvitationCode = getParams(location.search).invitationCode,\n            \t\t$this = $(dom.currentTarget);\n            \tlet stoken, obj = {};\n            \tif(new Date() * 1 - storage.getItem('invitetime') <= 600000){\n\t\t            stoken = storage.getItem('invitesst');\n\t\t        }else{\n\t\t            storage.removeItem(\"invitesst\");\n\t\t            storage.removeItem(\"invitetime\");\n        \t\t}\n            \tif(!$this.hasClass(\"active\")) {\n                    return;\n                }\n                if(!check.password(pwd)){\n\t\t            UI.alertSecond('Please enter a password for 6-20 bit letters, numbers, or symbols');\n\t\t            return;\n\t\t        }\n\t\t        obj = {\n\t\t        \tpassword: pwd,\n\t\t        \taccessToken: stoken\n\t\t        };\n                if(invitationCode != \"undefined\") {\n                    obj.refereeUserId = invitationCode;\n                }\n\t\t        ajax.post({\n                    url: '/api/user/register',\n                    data: obj,\n                    success: function (data) {\n                        let code = data.code;\n                        if (code === 200) {\n                            UI.alertSecond(\"login was successful\",function(){\n\t\t                        storage.removeItem(\"rst\"+phone);\n\t\t                        storage.removeItem(\"rsttime\");\n\t\t                        location.assign('/');\n\t\t                    },500);\n                        } else {\n                            UI.alertSecond(data.message);\n                        }\n                    },\n                    error: function (data) {\n\n                    }\n                })\n            },\n            goback: function() {\n            \tlet params = getParams(location.search),\n                    phone = params.phone,\n                    invitationCode = params.invitationCode;\n            \tlocation.href = \"/invite/regist?phone=\" + phone + \"&invitationCode=\" + invitationCode;\n            },\n            _nextHigh: function() {\n                if(this.password &&  this.agree) {\n                    $('#register').addClass(\"active\");\n                } else {\n                    $('#register').removeClass(\"active\");\n                }\n            }\n    \t}\n    });\n\n    function getParams(url) {\n\t\tlet obj = {};\n        url = url || location.search;\n        url = /^\\?.*/i.test(url) ? url.substr(1) : url;\n        let arr = url.split(\"&\");\n        for (let i = 0, l = arr.length; i < l; i++) {\n            let res = arr[i].split(\"=\");\n            obj[res[0]] = res[1]\n        }\n        return obj;\n\t}\n});"]}