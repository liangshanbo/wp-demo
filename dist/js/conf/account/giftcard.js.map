{"version":3,"sources":["webpack:///account/giftcard.js","webpack:///webpack/bootstrap 8b2b675c3aac98533b55?b3c4************","webpack:///./src/js/conf/account/giftcard.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","3","__WEBPACK_AMD_DEFINE_RESULT__","undefined","require","$","e","Error","code","Vue","UI","ajax","storage","commonMod","bindCopyEvents","script","document","createElement","async","src","getElementsByTagName","appendChild","onload","copyButtons","querySelectorAll","Clipboard","on","alertSecond","clearSelection","states","renderCompleted","cardListRes","data","totalExchange","amount","myGiftCards","showHelpLayer","targetCardId","targetUseStatus","vm","el","computed","sortedListData","getCompareFunc","tarAttr","i1","i2","valueOf","arr","this","filter","exchangeStatus","useStatus","r1","r2","r3","_r1","sort","_r2","_r3","concat","methods","fetchGiftCardsData","query","url","pageNum","pageSize","success","res","$nextTick","checkIfShouldShowTutorial","scrollIntoTargetSelector","error","attachLongPressEvt","fn","startTimeStamp","endTimeStamp","startX","startY","$body","evt","targetTouches","clientX","clientY","Date","$tar","target","fingerDidNotMove","Math","abs","changedTouches","pressedTimeEnough","children","show","find","hide","sendSwitchUseStatusReq","put","cardId","toString","getItem","not","length","body","scrollTop","showTutorial","setItem","init","setFilters","created","ready"],"mappings":"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","file":"account\\giftcard.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 3);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 3:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\nvar __WEBPACK_AMD_DEFINE_RESULT__;\n\n/**\n * 我的礼品卡 - h5\n * @author 张恩铭\n * @date 20170324\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/account/giftcard.js\">\n </script>\n */\n\n!(__WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, module) {\n    var $ = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"$\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n    var Vue = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"vue\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n    var UI = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"UI/dialog/alert\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n    var ajax = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"utils/async/ajax.js\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n    var storage = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"mods/storage/storage\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n\n    var commonMod = __webpack_require__(!(function webpackMissingModule() { var e = new Error(\"Cannot find module \\\"conf/account/_common.js\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e; }()));\n\n    $(function () {\n\n        var states = {\n            // 公共方法\n            commonMod: commonMod,\n            // 复制方法\n            bindCopyEvents: bindCopyEvents,\n            // 首次渲染完成\n            renderCompleted: false,\n            // 我的礼品卡列表数据\n            cardListRes: {\n                data: {\n                    totalExchange: {\n                        amount: 0\n                    },\n                    myGiftCards: []\n                }\n            },\n            // 展示帮助浮层\n            showHelpLayer: false,\n            // 目标卡id\n            targetCardId: '',\n            // 目标卡使用状态\n            targetUseStatus: null\n        };\n\n        var vm = new Vue({\n            el: 'body',\n            data: function data() {\n                return states;\n            },\n\n            computed: {\n                sortedListData: function sortedListData() {\n                    var getCompareFunc = function getCompareFunc(tarAttr) {\n                        return function (i1, i2) {\n                            return -(i1[tarAttr].valueOf() - i2[tarAttr].valueOf());\n                        };\n                    };\n                    /*\n                    先去除已解绑的卡和旧版本的卡（后者理论上不会出现）\n                    然后按 未使用 > 未激活 > 已使用 排序\n                    */\n                    var arr = this.cardListRes.data.myGiftCards.filter(function (i) {\n                        return i.exchangeStatus !== 'UNBIND' && i.useStatus !== 'NO_USERED';\n                    });\n                    var r1 = arr.filter(function (i) {\n                        return i.useStatus === 'UNUSED' && i.exchangeStatus === 'ALREADY_EXCHANGE';\n                    });\n                    var r2 = arr.filter(function (i) {\n                        return i.exchangeStatus === 'ALREADY_BIND';\n                    });\n                    var r3 = arr.filter(function (i) {\n                        return i.useStatus === 'USED';\n                    });\n                    // console.log('all\\n', this.cardListRes.data.myGiftCards);\n                    // console.log('r1\\n', r1);\n                    // console.log('r2\\n', r2);\n                    // console.log('r3\\n', r3);\n                    // console.log('arr', arr);\n                    var _r1 = r1.sort(getCompareFunc('exchangeDate')),\n                        _r2 = r2.sort(getCompareFunc('distributeDate')),\n                        _r3 = r3.sort(getCompareFunc('exchangeDate'));\n                    return _r1.concat(_r2).concat(_r3);\n                }\n            },\n            methods: {\n                /*\n                更新礼品卡列表数据，成功后绑定复制事件，判断是否展示使用说明\n                */\n                fetchGiftCardsData: function fetchGiftCardsData() {\n                    // this.renderCompleted = false;\n                    ajax.query({\n                        url: '/api/trade/myGiftCards',\n                        data: {\n                            pageNum: 0,\n                            pageSize: 0\n                        },\n                        success: function success(res) {\n                            if (res.code === 200) {\n                                vm.cardListRes = res;\n                                vm.$nextTick(function () {\n                                    vm.checkIfShouldShowTutorial();\n                                    vm.bindCopyEvents();\n                                });\n                            }\n                            vm.renderCompleted = true;\n                            if (vm.targetCardId !== '') {\n                                commonMod.scrollIntoTargetSelector('[data-is-scroll-target]');\n                            }\n                        },\n                        error: function error() {\n                            vm.renderCompleted = true;\n                        }\n                    });\n                },\n\n                /*\n                ‘长按’事件的触发\n                */\n                attachLongPressEvt: function attachLongPressEvt(fn) {\n                    var startTimeStamp = void 0,\n                        endTimeStamp = void 0,\n                        startX = void 0,\n                        startY = void 0;\n                    var $body = $('body');\n                    $body.on('touchstart', '.cards-li', function (evt) {\n                        startX = evt.targetTouches[0].clientX;\n                        startY = evt.targetTouches[0].clientY;\n                        startTimeStamp = new Date().valueOf();\n                        // 如果目标有card-id属性，说明事件发生在改使用状态的按钮上\n                        // 保存该id，并设置vm.targetUseStatus与data-use-status相反\n                        var $tar = $(evt.target);\n                        vm.targetCardId = $tar.data('card-id') || '';\n                        vm.targetUseStatus = $tar.data('use-status') === 'USED' ? 'UNUSED' : 'USED';\n                    }).on('touchend', '.cards-li', function (evt) {\n                        // 如果事件目标的id存在且与已保存的id相同，说明该按钮上产生了点击事件。触发fn；\n                        if ($(evt.target).data('card-id') === vm.targetCardId) {\n                            fn();\n                            // 否则按以下2个条件判断是否发生了‘长按’事件\n                        } else {\n                            endTimeStamp = new Date().valueOf();\n                            // - 水平和垂直的偏移量均小于10\n                            var fingerDidNotMove = Math.abs(evt.changedTouches[0].clientY - startY) < 10 && Math.abs(evt.changedTouches[0].clientX - startX) < 10;\n                            // - 持续时间大于500\n                            var pressedTimeEnough = endTimeStamp - startTimeStamp > 200;\n                            if (fingerDidNotMove && pressedTimeEnough) {\n                                $(this).children('.mark-wrap').show();\n                            } else {\n                                $body.find('.mark-wrap').hide();\n                            }\n                        }\n                    });\n                },\n\n                /*\n                发送更改使用状态的请求。返回成功则更新礼品卡列表数据\n                */\n                sendSwitchUseStatusReq: function sendSwitchUseStatusReq() {\n                    ajax.put({\n                        url: '/api/trade/myGiftCard',\n                        data: {\n                            cardId: vm.targetCardId.toString(),\n                            useStatus: vm.targetUseStatus\n                        },\n                        success: function success(res) {\n                            if (res.code === 200) {\n                                vm.fetchGiftCardsData();\n                            } else {\n                                UI.alertSecond(\"Change use status failed\");\n                            }\n                        },\n                        error: function error() {}\n                    });\n                },\n\n                /*\n                初次出现非.disabled的.cards-li元素时展示使用说明，关闭说明后在ls中保存，之后不再出现\n                */\n                checkIfShouldShowTutorial: function checkIfShouldShowTutorial() {\n                    if (storage.getItem('hadSeenTutorial') === null) {\n                        if ($('body').find('.cards-li').not('.disabled').length > 0) {\n                            document.body.scrollTop = 0;\n                            commonMod.showTutorial('.cards-li', 'Long press to mark the usage of Gift Card.', function () {\n                                storage.setItem('hadSeenTutorial', true);\n                            });\n                        };\n                    }\n                }\n            },\n            /*\n            注册过滤器\n            */\n            init: function init() {\n                commonMod.setFilters();\n            },\n\n            /*\n            更新数据\n            */\n            created: function created() {\n                this.fetchGiftCardsData();\n            },\n\n            /*\n            注册长按事件\n            */\n            ready: function ready() {\n                this.attachLongPressEvt(this.sendSwitchUseStatusReq);\n            }\n        });\n\n        function bindCopyEvents() {\n            // H5站暂时用cdn上的clipboard.js\n            var script = document.createElement('script');\n            script.async = \"async\";\n            script.src = 'https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js';\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\n            script.onload = function () {\n                // require('utils/clipboard.js');\n                var copyButtons = document.querySelectorAll('.copy-btn');\n                var c = new Clipboard(copyButtons);\n                c.on('success', function (e) {\n                    UI.alertSecond(\"Copied\");\n                    e.clearSelection();\n                });\n                c.on('error', function (e) {\n                    UI.alertSecond(\"Auto-copy failed. Please copy manually.\");\n                });\n            };\n        }\n    });\n}.call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceMappingURL=../../../maps/conf/account/giftcard.js.map\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// account/giftcard.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8b2b675c3aac98533b55","'use strict';\n\n/**\n * 我的礼品卡 - h5\n * @author 张恩铭\n * @date 20170324\n * 页面引用\n *  <script src=\"__PUBLIC__/js/lithe.js\"\n data-config=\"config.js\"\n data-debug=\"true\"\n data-main=\"conf/account/giftcard.js\">\n </script>\n */\ndefine('conf/account/giftcard.js', function (require, exports, module) {\n    var $ = require('$');\n    var Vue = require('vue');\n    var UI = require('UI/dialog/alert');\n    var ajax = require('utils/async/ajax.js');\n    var storage = require('mods/storage/storage');\n\n    var commonMod = require('conf/account/_common.js');\n\n    $(function () {\n\n        var states = {\n            // 公共方法\n            commonMod: commonMod,\n            // 复制方法\n            bindCopyEvents: bindCopyEvents,\n            // 首次渲染完成\n            renderCompleted: false,\n            // 我的礼品卡列表数据\n            cardListRes: {\n                data: {\n                    totalExchange: {\n                        amount: 0\n                    },\n                    myGiftCards: []\n                }\n            },\n            // 展示帮助浮层\n            showHelpLayer: false,\n            // 目标卡id\n            targetCardId: '',\n            // 目标卡使用状态\n            targetUseStatus: null\n        };\n\n        var vm = new Vue({\n            el: 'body',\n            data: function data() {\n                return states;\n            },\n\n            computed: {\n                sortedListData: function sortedListData() {\n                    var getCompareFunc = function getCompareFunc(tarAttr) {\n                        return function (i1, i2) {\n                            return -(i1[tarAttr].valueOf() - i2[tarAttr].valueOf());\n                        };\n                    };\n                    /*\n                    先去除已解绑的卡和旧版本的卡（后者理论上不会出现）\n                    然后按 未使用 > 未激活 > 已使用 排序\n                    */\n                    var arr = this.cardListRes.data.myGiftCards.filter(function (i) {\n                        return i.exchangeStatus !== 'UNBIND' && i.useStatus !== 'NO_USERED';\n                    });\n                    var r1 = arr.filter(function (i) {\n                        return i.useStatus === 'UNUSED' && i.exchangeStatus === 'ALREADY_EXCHANGE';\n                    });\n                    var r2 = arr.filter(function (i) {\n                        return i.exchangeStatus === 'ALREADY_BIND';\n                    });\n                    var r3 = arr.filter(function (i) {\n                        return i.useStatus === 'USED';\n                    });\n                    // console.log('all\\n', this.cardListRes.data.myGiftCards);\n                    // console.log('r1\\n', r1);\n                    // console.log('r2\\n', r2);\n                    // console.log('r3\\n', r3);\n                    // console.log('arr', arr);\n                    var _r1 = r1.sort(getCompareFunc('exchangeDate')),\n                        _r2 = r2.sort(getCompareFunc('distributeDate')),\n                        _r3 = r3.sort(getCompareFunc('exchangeDate'));\n                    return _r1.concat(_r2).concat(_r3);\n                }\n            },\n            methods: {\n                /*\n                更新礼品卡列表数据，成功后绑定复制事件，判断是否展示使用说明\n                */\n                fetchGiftCardsData: function fetchGiftCardsData() {\n                    // this.renderCompleted = false;\n                    ajax.query({\n                        url: '/api/trade/myGiftCards',\n                        data: {\n                            pageNum: 0,\n                            pageSize: 0\n                        },\n                        success: function success(res) {\n                            if (res.code === 200) {\n                                vm.cardListRes = res;\n                                vm.$nextTick(function () {\n                                    vm.checkIfShouldShowTutorial();\n                                    vm.bindCopyEvents();\n                                });\n                            }\n                            vm.renderCompleted = true;\n                            if (vm.targetCardId !== '') {\n                                commonMod.scrollIntoTargetSelector('[data-is-scroll-target]');\n                            }\n                        },\n                        error: function error() {\n                            vm.renderCompleted = true;\n                        }\n                    });\n                },\n\n                /*\n                ‘长按’事件的触发\n                */\n                attachLongPressEvt: function attachLongPressEvt(fn) {\n                    var startTimeStamp = void 0,\n                        endTimeStamp = void 0,\n                        startX = void 0,\n                        startY = void 0;\n                    var $body = $('body');\n                    $body.on('touchstart', '.cards-li', function (evt) {\n                        startX = evt.targetTouches[0].clientX;\n                        startY = evt.targetTouches[0].clientY;\n                        startTimeStamp = new Date().valueOf();\n                        // 如果目标有card-id属性，说明事件发生在改使用状态的按钮上\n                        // 保存该id，并设置vm.targetUseStatus与data-use-status相反\n                        var $tar = $(evt.target);\n                        vm.targetCardId = $tar.data('card-id') || '';\n                        vm.targetUseStatus = $tar.data('use-status') === 'USED' ? 'UNUSED' : 'USED';\n                    }).on('touchend', '.cards-li', function (evt) {\n                        // 如果事件目标的id存在且与已保存的id相同，说明该按钮上产生了点击事件。触发fn；\n                        if ($(evt.target).data('card-id') === vm.targetCardId) {\n                            fn();\n                            // 否则按以下2个条件判断是否发生了‘长按’事件\n                        } else {\n                            endTimeStamp = new Date().valueOf();\n                            // - 水平和垂直的偏移量均小于10\n                            var fingerDidNotMove = Math.abs(evt.changedTouches[0].clientY - startY) < 10 && Math.abs(evt.changedTouches[0].clientX - startX) < 10;\n                            // - 持续时间大于500\n                            var pressedTimeEnough = endTimeStamp - startTimeStamp > 200;\n                            if (fingerDidNotMove && pressedTimeEnough) {\n                                $(this).children('.mark-wrap').show();\n                            } else {\n                                $body.find('.mark-wrap').hide();\n                            }\n                        }\n                    });\n                },\n\n                /*\n                发送更改使用状态的请求。返回成功则更新礼品卡列表数据\n                */\n                sendSwitchUseStatusReq: function sendSwitchUseStatusReq() {\n                    ajax.put({\n                        url: '/api/trade/myGiftCard',\n                        data: {\n                            cardId: vm.targetCardId.toString(),\n                            useStatus: vm.targetUseStatus\n                        },\n                        success: function success(res) {\n                            if (res.code === 200) {\n                                vm.fetchGiftCardsData();\n                            } else {\n                                UI.alertSecond(\"Change use status failed\");\n                            }\n                        },\n                        error: function error() {}\n                    });\n                },\n\n                /*\n                初次出现非.disabled的.cards-li元素时展示使用说明，关闭说明后在ls中保存，之后不再出现\n                */\n                checkIfShouldShowTutorial: function checkIfShouldShowTutorial() {\n                    if (storage.getItem('hadSeenTutorial') === null) {\n                        if ($('body').find('.cards-li').not('.disabled').length > 0) {\n                            document.body.scrollTop = 0;\n                            commonMod.showTutorial('.cards-li', 'Long press to mark the usage of Gift Card.', function () {\n                                storage.setItem('hadSeenTutorial', true);\n                            });\n                        };\n                    }\n                }\n            },\n            /*\n            注册过滤器\n            */\n            init: function init() {\n                commonMod.setFilters();\n            },\n\n            /*\n            更新数据\n            */\n            created: function created() {\n                this.fetchGiftCardsData();\n            },\n\n            /*\n            注册长按事件\n            */\n            ready: function ready() {\n                this.attachLongPressEvt(this.sendSwitchUseStatusReq);\n            }\n        });\n\n        function bindCopyEvents() {\n            // H5站暂时用cdn上的clipboard.js\n            var script = document.createElement('script');\n            script.async = \"async\";\n            script.src = 'https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js';\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\n            script.onload = function () {\n                // require('utils/clipboard.js');\n                var copyButtons = document.querySelectorAll('.copy-btn');\n                var c = new Clipboard(copyButtons);\n                c.on('success', function (e) {\n                    UI.alertSecond(\"Copied\");\n                    e.clearSelection();\n                });\n                c.on('error', function (e) {\n                    UI.alertSecond(\"Auto-copy failed. Please copy manually.\");\n                });\n            };\n        }\n    });\n});\n//# sourceMappingURL=../../../maps/conf/account/giftcard.js.map\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/conf/account/giftcard.js"],"sourceRoot":""}